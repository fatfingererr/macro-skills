[
  {
    "id": "zeberg-salomon-rotator",
    "name": "zeberg-salomon-rotator",
    "displayName": "澤伯格–所羅門景氣循環",
    "description": "用領先和即時指標建構景氣模型，並判讀兩種景氣階段：景氣擴張與景氣收縮期，並根據理論給出\"撞冰山\"與\"下沉\"事件訊號",
    "emoji": "🚢",
    "version": "0.1.2",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "景氣循環",
      "領先指標",
      "同時指標",
      "景氣擴張",
      "景氣收縮",
      "FRED",
      "宏觀經濟",
      "Zeberg",
      "Salomon"
    ],
    "category": "business-cycles",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": true,
    "installCount": 0,
    "content": "<essential_principles>\r\n\r\n<principle name=\"two_state_model\">\r\n**兩態切換模型核心**\r\n\r\nZeberg–Salomon 模型將市場簡化為兩種狀態：\r\n- **RISK_ON**: 持有股票（SPY），景氣擴張期\r\n- **RISK_OFF**: 持有長債（TLT），景氣收縮期\r\n\r\n切換邏輯基於「領先指標先轉弱，同時指標後確認」的景氣循環規律。\r\n</principle>\r\n\r\n<principle name=\"leading_coincident\">\r\n**領先 vs 同時指標**\r\n\r\n| 類型       | 作用 | 典型成分                     | 領先時間 |\r\n|------------|------|------------------------------|----------|\r\n| Leading    | 預警 | 殖利率曲線、新訂單、房市許可 | 6-12 月  |\r\n| Coincident | 確認 | 就業、工業生產、實質收入     | 同步     |\r\n\r\n**合成方式**：\r\n1. 各序列做 transform（yoy/mom/diff）\r\n2. 統一方向（direction +1/-1）\r\n3. Rolling z-score 標準化\r\n4. EMA 平滑\r\n5. 加權合成\r\n</principle>\r\n\r\n<principle name=\"iceberg_sinking\">\r\n**冰山事件 vs 下沉事件**\r\n\r\n```\r\nIceberg Event: LeadingIndex < iceberg_threshold\r\n  → 預警：景氣開始轉弱\r\n  → 搭配「領先指標下降」+ 可選「市場亢奮」濾鏡\r\n\r\nSinking Event: CoincidentIndex < sinking_threshold\r\n  → 確認：實體經濟收縮\r\n  → 通常在 Iceberg 之後數月發生\r\n```\r\n\r\n**狀態機邏輯**：\r\n- RISK_ON → RISK_OFF：Iceberg 連續確認 + 斜率為負\r\n- RISK_OFF → RISK_ON：領先指標回升超過 (threshold + hysteresis)\r\n</principle>\r\n\r\n<principle name=\"data_access\">\r\n**資料取得方式**\r\n\r\n本 skill 使用**無需 API key** 的資料來源：\r\n- **FRED CSV**: `https://fred.stlouisfed.org/graph/fredgraph.csv?id={SERIES_ID}`\r\n- **Yahoo Finance**: `yfinance` 套件抓取 SPY, TLT, VIX\r\n\r\n腳本位於 `scripts/` 目錄，可直接執行。\r\n</principle>\r\n\r\n</essential_principles>\r\n\r\n<objective>\r\n實作 Zeberg–Salomon 兩態輪動策略：\r\n\r\n1. **建構指標**：從 FRED 數據合成 LeadingIndex 與 CoincidentIndex\r\n2. **偵測事件**：識別「冰山」（領先轉弱）與「下沉」（同時確認）\r\n3. **切換訊號**：產生 RISK_ON ↔ RISK_OFF 切換事件\r\n4. **回測績效**：計算累積報酬、MaxDD、CAGR、與 benchmark 比較\r\n\r\n輸出：切換事件清單、指標時間序列、回測摘要、診斷資訊。\r\n</objective>\r\n\r\n<quick_start>\r\n\r\n**最快的方式：執行預設回測**\r\n\r\n```bash\r\ncd skills/zeberg-salomon-rotator\r\npip install pandas numpy yfinance pandas-datareader  # 首次使用\r\npython scripts/rotator.py --quick\r\n```\r\n\r\n輸出範例：\r\n```json\r\n{\r\n  \"state\": \"RISK_ON\",\r\n  \"latest_indices\": {\"LeadingIndex\": 0.41, \"CoincidentIndex\": 0.22},\r\n  \"iceberg_event\": false,\r\n  \"sinking_event\": false,\r\n  \"last_switch\": {\"date\": \"2023-06-30\", \"action\": \"EXIT_LONG_BOND_ENTER_EQUITY\"}\r\n}\r\n```\r\n\r\n**完整回測**：\r\n```bash\r\npython scripts/rotator.py --start 2000-01-01 --end 2026-01-01 --output result.json\r\n```\r\n\r\n</quick_start>\r\n\r\n<intake>\r\n需要進行什麼操作？\r\n\r\n1. **快速檢查** - 查看目前的景氣狀態與最新指標\r\n2. **完整回測** - 執行完整的歷史回測與績效分析\r\n3. **視覺化圖表** - 生成多面板回測結果圖表\r\n4. **監控模式** - 設定持續監控與切換警報\r\n5. **方法論學習** - 了解 Zeberg-Salomon 模型的邏輯\r\n\r\n**請選擇或直接提供分析參數。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                      | Action                                      |\r\n|-------------------------------|---------------------------------------------|\r\n| 1, \"快速\", \"quick\", \"check\"   | 執行 `python scripts/rotator.py --quick`    |\r\n| 2, \"回測\", \"backtest\", \"full\" | 閱讀 `workflows/backtest.md` 並執行         |\r\n| 3, \"視覺化\", \"chart\", \"plot\"  | 閱讀 `workflows/visualize.md` 並執行        |\r\n| 4, \"監控\", \"monitor\", \"alert\" | 閱讀 `workflows/monitor.md` 並執行          |\r\n| 5, \"學習\", \"方法論\", \"why\"    | 閱讀 `references/methodology.md`            |\r\n| 提供參數 (如日期範圍)         | 閱讀 `workflows/backtest.md` 並使用參數執行 |\r\n\r\n**路由後，閱讀對應文件並執行。**\r\n</routing>\r\n\r\n<directory_structure>\r\n```\r\nzeberg-salomon-rotator/\r\n├── SKILL.md                           # 本文件（路由器）\r\n├── skill.yaml                         # 前端展示元數據\r\n├── manifest.json                      # 技能元數據\r\n├── workflows/\r\n│   ├── backtest.md                    # 完整回測工作流\r\n│   ├── visualize.md                   # 視覺化工作流\r\n│   ├── monitor.md                     # 持續監控工作流\r\n│   └── analyze.md                     # 深度分析工作流\r\n├── references/\r\n│   ├── data-sources.md                # FRED 系列代碼與資料來源\r\n│   ├── methodology.md                 # Zeberg-Salomon 方法論解析\r\n│   └── input-schema.md                # 完整輸入參數定義\r\n├── templates/\r\n│   ├── output-json.md                 # JSON 輸出模板\r\n│   └── output-markdown.md             # Markdown 報告模板\r\n└── scripts/\r\n    ├── rotator.py                     # 主輪動腳本\r\n    ├── visualize.py                   # 視覺化繪圖工具\r\n    └── fetch_data.py                  # 數據抓取工具\r\n```\r\n</directory_structure>\r\n\r\n<reference_index>\r\n\r\n**方法論**: references/methodology.md\r\n- Zeberg-Salomon 模型概念\r\n- 冰山/下沉事件定義\r\n- 兩態切換邏輯\r\n\r\n**資料來源**: references/data-sources.md\r\n- FRED 系列代碼（領先/同時）\r\n- Yahoo Finance 資產代碼\r\n- 數據頻率與對齊\r\n\r\n**輸入參數**: references/input-schema.md\r\n- 完整參數定義\r\n- 預設值與建議範圍\r\n\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow     | Purpose        | 使用時機         |\r\n|--------------|----------------|------------------|\r\n| backtest.md  | 完整歷史回測   | 需要績效分析時   |\r\n| visualize.md | 生成視覺化圖表 | 需要圖表展示時   |\r\n| monitor.md   | 持續監控狀態   | 日常監控或警報   |\r\n| analyze.md   | 深度指標分析   | 理解當前市場狀態 |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose           |\r\n|--------------------|-------------------|\r\n| output-json.md     | JSON 輸出結構定義 |\r\n| output-markdown.md | Markdown 報告模板 |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script        | Command                       | Purpose          |\r\n|---------------|-------------------------------|------------------|\r\n| rotator.py    | `--quick`                     | 快速檢查當前狀態 |\r\n| rotator.py    | `--start DATE --end DATE`     | 完整回測         |\r\n| visualize.py  | `-i result.json -o chart.png` | 生成視覺化圖表   |\r\n| fetch_data.py | `--series T10Y3M,PAYEMS`      | 抓取 FRED 資料   |\r\n</scripts_index>\r\n\r\n<input_schema_summary>\r\n\r\n**核心參數**\r\n\r\n| 參數         | 類型   | 預設值     | 說明         |\r\n|--------------|--------|------------|--------------|\r\n| start_date   | string | 2000-01-01 | 回測起始日   |\r\n| end_date     | string | today      | 回測結束日   |\r\n| freq         | string | M          | 頻率（M=月） |\r\n| equity_proxy | string | SPY        | 風險資產代理 |\r\n| bond_proxy   | string | TLT        | 長債代理     |\r\n\r\n**門檻參數**\r\n\r\n| 參數              | 類型   | 預設值 | 說明         |\r\n|-------------------|--------|--------|--------------|\r\n| iceberg_threshold | number | -0.3   | 領先指標門檻 |\r\n| sinking_threshold | number | -0.5   | 同時指標門檻 |\r\n| confirm_periods   | int    | 2      | 連續確認期數 |\r\n| hysteresis        | number | 0.15   | 進出場間距   |\r\n\r\n完整參數定義見 `references/input-schema.md`。\r\n\r\n</input_schema_summary>\r\n\r\n<output_schema_summary>\r\n```json\r\n{\r\n  \"skill\": \"zeberg-salomon-rotator\",\r\n  \"as_of\": \"2026-01-14\",\r\n  \"state\": \"RISK_ON\",\r\n  \"latest_indices\": {\r\n    \"LeadingIndex\": 0.41,\r\n    \"CoincidentIndex\": 0.22,\r\n    \"iceberg_event\": false,\r\n    \"sinking_event\": false\r\n  },\r\n  \"switch_events\": [...],\r\n  \"backtest_summary\": {\r\n    \"cagr\": 0.123,\r\n    \"max_drawdown\": -0.27,\r\n    \"turnovers\": 10\r\n  }\r\n}\r\n```\r\n\r\n完整輸出結構見 `templates/output-json.md`。\r\n</output_schema_summary>\r\n\r\n<success_criteria>\r\n執行成功時應產出：\r\n\r\n- [ ] 當前狀態（RISK_ON 或 RISK_OFF）\r\n- [ ] LeadingIndex 與 CoincidentIndex 數值\r\n- [ ] 冰山/下沉事件判定\r\n- [ ] 切換事件清單（含日期、原因）\r\n- [ ] 回測績效摘要（CAGR, MaxDD, 換手次數）\r\n- [ ] 與 benchmark 比較（買入持有、60/40）\r\n- [ ] 診斷資訊（各指標貢獻）\r\n- [ ] 視覺化圖表（可選，輸出至 `output/` 目錄）\r\n</success_criteria>",
    "path": "skills/zeberg-salomon-rotator/SKILL.md",
    "directoryStructure": "zeberg-salomon-rotator/\n├── manifest.json\n├── references\n│   ├── data-sources.md\n│   ├── input-schema.md\n│   └── methodology.md\n├── scripts\n│   ├── fetch_data.py\n│   ├── rotator.py\n│   ├── visualize.py\n│   └── __pycache__\n│       └── fetch_data.cpython-312.pyc\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── output-json.md\n│   └── output-markdown.md\n└── workflows\n    ├── analyze.md\n    ├── backtest.md\n    ├── monitor.md\n    └── visualize.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "基於 Zeberg-Salomon 景氣循環模型，目前的景氣狀態是？",
        "expectedResult": "當前景氣狀態：RISK_OFF（景氣收縮期）\n\n根據 Zeberg-Salomon 模型分析結果（數據截至 2026-01-31）：\n┌────────────────────────────┬───────┬─────────────────────────┐\n│            指標            │ 數值  │          狀態           │\n├────────────────────────────┼───────┼─────────────────────────┤\n│ 領先指數 (LeadingIndex)    │ -0.38 │ ⚠️ 低於冰山門檻 (-0.3)  │\n├────────────────────────────┼───────┼─────────────────────────┤\n│ 同時指數 (CoincidentIndex) │ -0.19 │ 尚未觸及下沉門檻 (-0.5) │\n└────────────────────────────┴───────┴─────────────────────────┘\n事件判定\n┌──────────┬───────────┬──────────────────────────┐\n│   事件   │   狀態    │           意義           │\n├──────────┼───────────┼──────────────────────────┤\n│ 冰山事件 │ ✅ 已觸發 │ 領先指標預警景氣轉弱     │\n├──────────┼───────────┼──────────────────────────┤\n│ 下沉事件 │ ❌ 未觸發 │ 實體經濟尚未完全確認收縮 │\n└──────────┴───────────┴──────────────────────────┘\n模型建議\n\nRISK_OFF → 持有長債（TLT），避開股票（SPY）\n\n解讀\n\n目前處於「冰山已現、但尚未下沉」的階段：\n- 領先指標（殖利率曲線、新訂單、房市許可等）已經轉弱\n- 同時指標（就業、工業生產、實質收入）還沒完全惡化\n- 這是典型的景氣週期晚期預警信號\n"
      },
      {
        "question": "基於 Zeberg-Salomon 景氣循環輪換策略，回測到今天的投資績效，並輸出回測圖表",
        "imagePath": "images/zeberg-salomon-2026-01-15.png",
        "expectedResult": "Zeberg-Salomon 景氣循環輪換策略回測結果\n\n當前狀態（截至 2026-01-31）\n┌──────────────────┬────────────┬──────────────────────────┐\n│       項目       │    數值    │           狀態           │\n├──────────────────┼────────────┼──────────────────────────┤\n│ 當前狀態         │ RISK_OFF   │ 景氣收縮期               │\n├──────────────────┼────────────┼──────────────────────────┤\n│ 持續自           │ 2021-10-31 │ 已持續 ~4 年             │\n├──────────────────┼────────────┼──────────────────────────┤\n│ Leading Index    │ -0.38      │ 低於冰山門檻 (-0.3)      │\n├──────────────────┼────────────┼──────────────────────────┤\n│ Coincident Index │ -0.19      │ 尚未觸及下沉門檻 (-0.5)  │\n├──────────────────┼────────────┼──────────────────────────┤\n│ 冰山事件         │ 已觸發     │ 領先指標預警景氣轉弱     │\n├──────────────────┼────────────┼──────────────────────────┤\n│ 下沉事件         │ 未觸發     │ 實體經濟尚未完全確認收縮 │\n└──────────────────┴────────────┴──────────────────────────┘\n---\n回測績效 (2000-01 至 2026-01)\n┌─────────────────┬─────────────────────┬──────────────┬──────────────┐\n│      指標       │ Zeberg-Salomon 策略 │ SPY 買入持有 │ TLT 買入持有 │\n├─────────────────┼─────────────────────┼──────────────┼──────────────┤\n│ 累積報酬        │ 222.8%              │ 685.2%       │ 138.1%       │\n├─────────────────┼─────────────────────┼──────────────┼──────────────┤\n│ 年化報酬 (CAGR) │ 4.6%                │ 8.2%         │ 3.4%         │\n├─────────────────┼─────────────────────┼──────────────┼──────────────┤\n│ 最大回撤        │ -46.8%              │ -50.8%       │ -47.6%       │\n├─────────────────┼─────────────────────┼──────────────┼──────────────┤\n│ 夏普比率        │ 0.33                │ 0.55         │ 0.26         │\n├─────────────────┼─────────────────────┼──────────────┼──────────────┤\n│ Calmar 比率     │ 0.10                │ -            │ -            │\n└─────────────────┴─────────────────────┴──────────────┴──────────────┘\n---\n切換事件（共 5 次）\n┌────────────┬─────────────┬──────────┬──────────┬──────────┐\n│    日期    │    動作     │ 領先指數 │ 同時指數 │ 觸發條件 │\n├────────────┼─────────────┼──────────┼──────────┼──────────┤\n│ 2006-05-31 │ 股票 → 長債 │ -1.06    │ 0.96     │ 冰山事件 │\n├────────────┼─────────────┼──────────┼──────────┼──────────┤\n│ 2009-12-31 │ 長債 → 股票 │ 0.41     │ -1.57    │ 景氣復甦 │\n├────────────┼─────────────┼──────────┼──────────┼──────────┤\n│ 2017-09-30 │ 股票 → 長債 │ -0.38    │ 0.43     │ 冰山事件 │\n├────────────┼─────────────┼──────────┼──────────┼──────────┤\n│ 2021-04-30 │ 長債 → 股票 │ 1.55     │ 2.02     │ 景氣復甦 │\n├────────────┼─────────────┼──────────┼──────────┼──────────┤\n│ 2021-10-31 │ 股票 → 長債 │ -0.46    │ 0.78     │ 冰山事件 │\n└────────────┴─────────────┴──────────┴──────────┴──────────┘\n---\n關鍵觀察\n\n1. 策略在 2008 金融危機表現出色：成功在 2006 年中轉為 RISK_OFF，避開了 2007-2009 的股市大跌\n2. 2020 疫情期間持有 TLT 獲得顯著正報酬\n3. 2021 年後持續持有 TLT 遭遇長債熊市，策略累積報酬從高點回落\n4. 換手次數極低（5 次/26 年），平均每個狀態持續 62.6 個月\n\n---\n圖表說明\n\n圖表已保存至：output/zeberg-salomon-2026-01-15.png\n\n- 上圖：景氣指標面板，藍線為領先指數，紫線為同時指數\n- 中圖：累積報酬對比，黑線為策略，藍/紫虛線為 SPY/TLT 基準\n- 下圖：狀態條帶，綠色=RISK_ON(股票)，紅色=RISK_OFF(長債)\n"
      }
    ],
    "qualityScore": {
      "overall": 75,
      "badge": "白銀",
      "metrics": {
        "architecture": 85,
        "maintainability": 80,
        "content": 85,
        "community": 20,
        "security": 95,
        "compliance": 85
      },
      "details": "**架構（85/100）**\n- 清晰的兩態切換邏輯\n- 領先/同時指標分離設計\n- 可配置的濾鏡機制\n\n**可維護性（80/100）**\n- 參數定義完整\n- 多指標來源支援\n- 工作流程分離\n\n**內容（85/100）**\n- 完整的方法論文檔\n- Zeberg 模型邏輯解析\n- 實用的回測工具\n\n**社區（20/100）**\n- 新技能，尚無社區貢獻\n\n**安全（95/100）**\n- 僅讀取公開經濟數據\n- 無需 API key\n\n**規範符合性（85/100）**\n- 遵循 Claude Code 規範\n- 完整的文件結構\n"
    },
    "bestPractices": [
      {
        "title": "領先指標要領先",
        "description": "領先指標（殖利率曲線、新訂單、房市）應比景氣高峰提前 6-12 個月轉折"
      },
      {
        "title": "使用確認期避免假訊號",
        "description": "連續 2-3 期確認可大幅降低抖動交易頻率"
      },
      {
        "title": "Hysteresis 防止來回切換",
        "description": "進出場門檻間距（如 0.15）可避免在邊界來回觸發"
      },
      {
        "title": "回測假設要保守",
        "description": "使用 next_month_open 執行、加入交易成本與滑價"
      }
    ],
    "pitfalls": [
      {
        "title": "過度擬合歷史數據",
        "description": "調整門檻到完美貼合歷史會導致樣本外失效",
        "consequence": "實際交易績效遠差於回測"
      },
      {
        "title": "忽略指標發布延遲",
        "description": "宏觀數據有 1-2 個月的發布延遲",
        "consequence": "訊號可能比想像中更滯後"
      },
      {
        "title": "只看領先不看同時",
        "description": "領先指標可能假警報，需同時指標確認",
        "consequence": "過多錯誤切換"
      }
    ],
    "faq": [
      {
        "question": "什麼是「冰山事件」？",
        "answer": "Zeberg 模型中，「撞冰山」指領先指標跌破門檻，\n預示景氣即將轉弱，但實體經濟（同時指標）尚未惡化。\n這是 Risk-Off 的預警訊號。\n"
      },
      {
        "question": "什麼是「下沉事件」？",
        "answer": "「下沉」指同時指標也跌破門檻，\n確認實體經濟進入收縮。\n此時應已完成 Risk-Off 切換。\n"
      },
      {
        "question": "這個模型跟 Zeberg 的模型完全一樣嗎？",
        "answer": "本模型是使用公開數據近似複製 Zeberg–Salomon 方法論。\n由於原版使用專有數據，本技能使用 FRED 公開替代數據。\n邏輯框架相同，但具體數值可能略有差異。\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 參考來源\n\n- Zeberg Letter: https://swissblock.net/products/reports/zeberg-letter\n\n## 數據來源\n\n**FRED（免費，無需 API key）**\n- 殖利率曲線：T10Y3M, T10Y2Y\n- 領先指標：PERMIT, ACDGNO, UMCSENT\n- 同時指標：PAYEMS, INDPRO, W875RX1\n- 使用 CSV endpoint 直接下載\n\n**Yahoo Finance**\n- SPY, TLT 價格數據\n- VIX 用於濾鏡\n"
    },
    "methodology": "# Zeberg-Salomon 方法論 (Methodology)\r\n\r\n## 模型概述\r\n\r\nZeberg-Salomon 模型是一個**兩態景氣輪動系統**，基於以下核心假設：\r\n\r\n1. **景氣循環可預測**：領先指標會比實體經濟提前 6-12 個月轉折\r\n2. **兩態簡化**：市場可簡化為 Risk-On（股票）與 Risk-Off（長債）兩種狀態\r\n3. **漸進惡化**：衰退不會突然發生，而是「先撞冰山（領先轉弱）→ 再下沉（同時確認）」\r\n\r\n## 參考來源\r\n\r\n- **Zeberg Letter**: https://swissblock.net/products/reports/zeberg-letter\r\n- **@SystematicPeter**: https://x.com/SystematicPeter/status/2011460563096760388\r\n\r\n## 核心概念\r\n\r\n### 1. 領先指標 vs 同時指標\r\n\r\n| 類型 | 經濟意義 | 代表序列 | 作用 |\r\n|------|----------|----------|------|\r\n| **Leading** | 預測未來景氣 | 殖利率曲線、新訂單、房市 | 預警 |\r\n| **Coincident** | 反映當前景氣 | 就業、工業生產、實質收入 | 確認 |\r\n\r\n**為什麼要分開**：\r\n- 領先指標可能「假警報」（曲線倒掛但未衰退）\r\n- 同時指標確認後才行動，可降低錯誤切換\r\n- 但也不能只看同時，那樣會太滯後\r\n\r\n### 2. 冰山事件 (Iceberg Event)\r\n\r\n**定義**：LeadingIndex 跌破 `iceberg_threshold`\r\n\r\n**比喻**：鐵達尼號撞上冰山，船體已受損，但乘客尚未感知。\r\n\r\n**訊號特徵**：\r\n- 殖利率曲線倒掛或壓縮\r\n- 新訂單/房市許可轉負\r\n- 消費者信心開始下滑\r\n- 但就業、生產仍維持\r\n\r\n**建議反應**：\r\n- 提高警戒\r\n- 若連續確認 + 斜率為負 + 市場亢奮 → 考慮 Risk-Off\r\n\r\n### 3. 下沉事件 (Sinking Event)\r\n\r\n**定義**：CoincidentIndex 跌破 `sinking_threshold`\r\n\r\n**比喻**：船開始下沉，所有人都感受到了。\r\n\r\n**訊號特徵**：\r\n- 就業開始惡化\r\n- 工業生產收縮\r\n- 實質收入下滑\r\n- 零售銷售轉弱\r\n\r\n**建議反應**：\r\n- 此時應已在 Risk-Off\r\n- 若尚未切換，需立即行動\r\n- 但注意：此時切換可能已較晚\r\n\r\n### 4. 復甦訊號 (Recovery Signal)\r\n\r\n**定義**：LeadingIndex 回升超過 `iceberg_threshold + hysteresis`\r\n\r\n**訊號特徵**：\r\n- 殖利率曲線正常化\r\n- 新訂單回升\r\n- 消費者信心觸底回升\r\n- 房市活動恢復\r\n\r\n**建議反應**：\r\n- 連續確認後 → Risk-On\r\n\r\n## 合成指標計算\r\n\r\n### Step 1: 數據轉換 (Transform)\r\n\r\n將各原始序列轉換為可比較的形式：\r\n\r\n| 轉換 | 公式 | 適用 |\r\n|------|------|------|\r\n| level | 原值 | 殖利率曲線、情緒指標 |\r\n| yoy | (x_t - x_{t-12}) / x_{t-12} | 數量型指標 |\r\n| mom | (x_t - x_{t-1}) / x_{t-1} | 月變化 |\r\n| diff | x_t - x_{t-1} | 絕對變化 |\r\n| logdiff | ln(x_t) - ln(x_{t-1}) | 對數報酬 |\r\n\r\n### Step 2: 方向統一 (Direction)\r\n\r\n確保「上升 = 景氣好」：\r\n\r\n```python\r\nx = direction * x\r\n# direction = +1: 上升為好（多數指標）\r\n# direction = -1: 下降為好（如失業率）\r\n```\r\n\r\n### Step 3: 標準化 (Standardization)\r\n\r\nRolling z-score 將不同量綱統一：\r\n\r\n```python\r\ndef rolling_zscore(x, window):\r\n    mean = x.rolling(window).mean()\r\n    std = x.rolling(window).std()\r\n    return (x - mean) / std\r\n```\r\n\r\n**建議 window**：120 期（月頻 = 10 年）\r\n\r\n### Step 4: 平滑 (Smoothing)\r\n\r\nEMA 降低雜訊：\r\n\r\n```python\r\ndef ema(x, span):\r\n    return x.ewm(span=span, adjust=False).mean()\r\n```\r\n\r\n**建議 span**：3-6 期（月頻）\r\n\r\n### Step 5: 加權合成 (Weighted Sum)\r\n\r\n```python\r\ndef build_index(series_defs, data, z_win, smooth_win):\r\n    z_list = []\r\n    for sdef in series_defs:\r\n        x = transform(data[sdef[\"id\"]], sdef[\"transform\"])\r\n        x = sdef[\"direction\"] * x\r\n        z = rolling_zscore(x, z_win)\r\n        z = ema(z, smooth_win)\r\n        z_list.append(sdef[\"weight\"] * z)\r\n    return sum(z_list)\r\n```\r\n\r\n## 兩態切換邏輯\r\n\r\n### 狀態定義\r\n\r\n```\r\nRISK_ON:  持有 equity_proxy (SPY)\r\nRISK_OFF: 持有 bond_proxy (TLT)\r\n```\r\n\r\n### RISK_ON → RISK_OFF 條件\r\n\r\n```python\r\ncond_off = (\r\n    iceberg.loc[t] and           # A: 冰山事件發生\r\n    (dL < 0) and                  # B: 領先指標下降\r\n    eup.loc[t]                    # C: 亢奮濾鏡（可選）\r\n)\r\n\r\nif cond_off 連續 confirm_periods 期:\r\n    action = \"EXIT_EQUITY_ENTER_LONG_BOND\"\r\n    state = \"RISK_OFF\"\r\n```\r\n\r\n### RISK_OFF → RISK_ON 條件\r\n\r\n```python\r\ncond_on = (\r\n    (L.loc[t] > iceberg_threshold + hysteresis) and  # A: 領先回升超過門檻+間距\r\n    (dL > 0) and                                      # B: 領先指標上升\r\n    doubt.loc[t]                                      # C: 懷疑濾鏡（可選）\r\n)\r\n\r\nif cond_on 連續 confirm_periods 期:\r\n    action = \"EXIT_LONG_BOND_ENTER_EQUITY\"\r\n    state = \"RISK_ON\"\r\n```\r\n\r\n### Hysteresis 的作用\r\n\r\n防止在門檻邊界來回切換：\r\n\r\n```\r\niceberg_threshold = -0.3\r\nhysteresis = 0.15\r\n\r\nRisk-Off 觸發：L < -0.3\r\nRisk-On 恢復：L > -0.3 + 0.15 = -0.15\r\n```\r\n\r\n## 濾鏡系統（可選）\r\n\r\n### Euphoria Filters（亢奮濾鏡）\r\n\r\n當市場處於亢奮狀態時，更容易觸發 Risk-Off：\r\n\r\n```python\r\neuphoria_filters = [\r\n    # 信用利差低且開始上升\r\n    {\"type\": \"credit_spread_reversal\", \"series_id\": \"BAA10Y\", \"z_below\": -1.0, \"turn_up\": True},\r\n    # VIX 低且開始上升\r\n    {\"type\": \"vix_turn_up\", \"ticker\": \"VIXCLS\", \"level_below\": 15, \"turn_up\": True}\r\n]\r\n```\r\n\r\n**邏輯**：「大家都很樂觀，但領先指標已轉弱」→ 危險訊號\r\n\r\n### Recovery Doubt Filters（復甦懷疑濾鏡）\r\n\r\n當市場仍懷疑復甦時，更容易觸發 Risk-On：\r\n\r\n```python\r\nrecovery_doubt_filters = [\r\n    # 領先指標動量為正\r\n    {\"type\": \"leading_momentum\", \"above\": 0}\r\n]\r\n```\r\n\r\n**邏輯**：「大家還在懷疑，但領先指標已回升」→ 進場機會\r\n\r\n## 回測假設\r\n\r\n### 執行時點 (Rebalance On)\r\n\r\n| 選項 | 說明 | 保守程度 |\r\n|------|------|----------|\r\n| signal_close | 訊號當日收盤執行 | 最不保守 |\r\n| next_open | 訊號次日開盤執行 | 中等 |\r\n| next_month_open | 訊號次月開盤執行 | 最保守（建議） |\r\n\r\n### 交易成本\r\n\r\n```python\r\ntransaction_cost_bps = 5   # 單邊 5 bps\r\nslippage_bps = 0           # 滑價（可調整）\r\n```\r\n\r\n### 績效指標\r\n\r\n| 指標 | 計算方式 |\r\n|------|----------|\r\n| CAGR | (終值/初值)^(1/年數) - 1 |\r\n| Max Drawdown | max(1 - 價值/歷史高點) |\r\n| Sharpe | (年化報酬 - 無風險利率) / 年化波動 |\r\n| Turnovers | 切換次數 |\r\n\r\n## 模型限制\r\n\r\n1. **近似性**：本模型使用公開數據近似 Zeberg 原版，可能有差異\r\n2. **發布延遲**：宏觀數據有 1-2 個月延遲，實際訊號會滯後\r\n3. **樣本內偏差**：參數調整可能導致過度擬合\r\n4. **尾部風險**：模型無法預測黑天鵝事件\r\n5. **交易執行**：回測假設可能過於理想化\r\n",
    "downloadUrl": "downloads/zeberg-salomon-rotator-0.1.2.zip"
  },
  {
    "id": "evaluate-exponential-trend-deviation-regimes",
    "name": "evaluate-exponential-trend-deviation-regimes",
    "displayName": "評估行情與指數趨勢偏離程度",
    "description": "計算資產價格相對長期指數成長趨勢線的偏離度，衡量當前是否處於歷史極端區間，並可選擇性地進行宏觀因子分析以判斷行情體質。",
    "emoji": "📈",
    "version": "0.1.0",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "趨勢",
      "偏離度",
      "歷史峰值",
      "指數成長",
      "技術分析",
      "宏觀分析"
    ],
    "category": "business-cycles",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": true,
    "installCount": 0,
    "content": "<essential_principles>\n**資產趨勢偏離度分析 核心原則**\n\n<principle name=\"exponential_trend_fitting\">\n**指數趨勢線擬合**\n多數資產在長期（數十年）尺度上遵循指數成長路徑。透過對數價格線性回歸（y = a + b*t where y = log(price)）擬合趨勢線，trend = exp(a + b*t)。偏離度 = (price / trend - 1) × 100%。\n</principle>\n\n<principle name=\"historical_context\">\n**歷史極端對照**\n透過計算當前偏離度在歷史分布中的分位數，以及與歷史峰值/谷值的比較，提供市場位置的脈絡。使用者可指定特定日期作為參考點，或由系統自動識別歷史極端值。\n</principle>\n\n<principle name=\"regime_classification\">\n**行情體質判定（選用）**\n針對特定資產（如黃金、股指），可結合宏觀因子進行行情體質分析。不同資產有不同的體質分類框架，使用者可自定義判定規則與因子權重。\n</principle>\n\n<principle name=\"universal_applicability\">\n**通用適用性**\n本技能適用於任何具有長期指數成長特性的資產：商品（黃金、原油）、股票指數、加密貨幣、房地產等。核心邏輯不預設特定資產或歷史峰值。\n</principle>\n</essential_principles>\n\n<intake>\n**您想要執行什麼操作？**\n\n1. **單資產偵測** - 計算單一資產的趨勢偏離度與歷史分位數\n2. **歷史對照分析** - 將當前偏離度與使用者指定的歷史日期或自動識別的極端值進行比較\n3. **宏觀因子分解** - 詳細拆解各宏觀代理指標對行情體質判定的貢獻（適用於支援的資產類別）\n\n**等待回應後再繼續。**\n</intake>\n\n<routing>\n| Response                           | Workflow              | Description |\n|------------------------------------|-----------------------|-------------|\n| 1, \"detect\", \"single\", \"偵測\"      | workflows/detect.md   | 單資產趨勢偏離度偵測與體質判定 |\n| 2, \"compare\", \"historical\", \"對照\" | workflows/compare.md  | 歷史峰值詳細對照分析 |\n| 3, \"macro\", \"breakdown\", \"因子\"    | workflows/macro.md    | 宏觀因子分解與貢獻度分析 |\n\n**讀取工作流程後，請完全遵循其步驟。**\n</routing>\n\n<quick_start>\n**快速開始**\n\n```bash\n# 安裝依賴\npip install pandas numpy yfinance pandas-datareader statsmodels\n\n# 快速偵測（範例：黃金期貨）\ncd skills/evaluate-exponential-trend-deviation-regimes\npython scripts/trend_deviation.py --symbol GC=F --quick\n\n# 分析其他資產（範例：S&P 500）\npython scripts/trend_deviation.py --symbol ^GSPC --start 1950-01-01\n\n# 完整分析（含宏觀因子，目前支援黃金）\npython scripts/trend_deviation.py --symbol GC=F --start 1970-01-01 --include-macro\n\n# 指定歷史參考日期\npython scripts/trend_deviation.py --symbol GC=F --compare-peaks \"2011-09-06,2020-08-07\"\n\n# 生成視覺化圖表（輸出 PNG + JSON）\npython scripts/generate_chart.py --output ./output/\n```\n</quick_start>\n\n<reference_index>\n**參考文件** (`references/`)\n\n| 文件 | 內容 |\n|------|------|\n| input-schema.md | 輸入參數詳細定義與驗證規則 |\n| methodology.md | 指數趨勢擬合與偏離度計算方法論 |\n| regime-rules.md | 1970s-like vs 2000s-like 體質判定規則 |\n| data-sources.md | 數據來源與替代方案說明 |\n</reference_index>\n\n<workflows_index>\n| Workflow | Purpose |\n|----------|---------|\n| detect.md | 單資產趨勢偏離度偵測與體質判定 |\n| compare.md | 歷史峰值詳細對照分析 |\n| macro.md | 宏觀因子分解與貢獻度分析 |\n</workflows_index>\n\n<templates_index>\n| Template | Purpose |\n|----------|---------|\n| output-json.md | JSON 輸出結構定義 |\n| output-markdown.md | Markdown 報告輸出模板 |\n</templates_index>\n\n<scripts_index>\n| Script | Purpose |\n|--------|---------|\n| trend_deviation.py | 主要分析腳本：趨勢擬合、偏離度計算、體質判定 |\n| generate_chart.py | 視覺化圖表生成：偏離度歷史圖表與峰值標註 |\n</scripts_index>\n\n<examples_index>\n**範例輸出** (`examples/`)\n\n| 文件 | 內容 |\n|------|------|\n| gold-deviation-2026.json | 2026 年黃金趨勢偏離度分析範例 |\n</examples_index>\n\n<success_criteria>\nSkill 成功執行時：\n- [ ] 成功擬合黃金價格的指數趨勢線\n- [ ] 計算出當前偏離度百分比與歷史分位數\n- [ ] 與 2011/1980 峰值進行有效比較\n- [ ] 綜合宏觀代理指標得出 regime 判定（1970s-like / 2000s-like）\n- [ ] 輸出完整的 JSON 或 Markdown 報告\n- [ ] （選用）生成視覺化圖表（PNG）標註歷史峰值與當前位置\n</success_criteria>",
    "path": "skills/evaluate-exponential-trend-deviation-regimes/SKILL.md",
    "directoryStructure": "evaluate-exponential-trend-deviation-regimes/\n├── examples\n│   ├── gold-deviation-2026.json\n│   └── gold-trend-deviation.md\n├── images\n├── manifest.json\n├── methodology.md\n├── references\n│   ├── data-sources.md\n│   ├── input-schema.md\n│   ├── methodology.md\n│   └── regime-rules.md\n├── scripts\n│   ├── generate_chart.py\n│   └── trend_deviation.py\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── output-json.md\n│   └── output-markdown.md\n└── workflows\n    ├── compare.md\n    ├── detect.md\n    └── macro.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "黃金目前的指數趨勢偏離度是多少？是否已超過 2011 年峰值？",
        "imagePath": "images/gold-deviation-analysis-2026-01-15.png",
        "expectedResult": "黃金指數趨勢偏離度分析結果\n\n當前狀態（截至 2025 年 12 月）\n┌────────────┬───────────┐\n│    指標    │   數值    │\n├────────────┼───────────┤\n│ 當前金價   │ $4,318.59 │\n├────────────┼───────────┤\n│ 趨勢線價格 │ $2,161.81 │\n├────────────┼───────────┤\n│ 當前偏離度 │ 99.8%     │\n├────────────┼───────────┤\n│ 歷史分位數 │ 94.8%     │\n└────────────┴───────────┘\n歷史峰值比較\n┌──────────────┬────────┬──────────────────────┐\n│   峰值時期   │ 偏離度 │      與當前差距      │\n├──────────────┼────────┼──────────────────────┤\n│ 1980 年 1 月 │ 288.5% │ -188.7 ppt（未超過） │\n├──────────────┼────────┼──────────────────────┤\n│ 2011 年 8 月 │ 83.1%  │ +16.7 ppt（已超過）  │\n└──────────────┴────────┴──────────────────────┘\n---\n結論\n\n是的，黃金已超越 2011 年峰值偏離度。\n當前黃金偏離指數趨勢線 99.8%，超過 2011 年峰值（83.1%）約 16.7 個百分點。這意味著以趨勢偏離度衡量，黃金的「泡沫程度」已超過 2011 年那波行情。\n然而，與 1980 年那種 blow-off 式的峰值（288.5%）相比，當前偏離度仍有相當距離。若行情體質類似 1970 年代（高通膨、負實質利率），理論上仍有延伸空間。\n"
      },
      {
        "question": "分析 S&P 500 的指數趨勢偏離度",
        "imagePath": "images/sp500-trend-deviation-2026-01-15.png",
        "expectedResult": "S&P 500 指數趨勢偏離度分析報告\n\n分析日期: 2026-01-15\n數據範圍: 1950-01-31 至 2026-01-31（76 年，913 個月）\n\n---\n趨勢擬合參數\n┌────────────┬────────────────────────────────────┐\n│    參數    │                數值                │\n├────────────┼────────────────────────────────────┤\n│ 年化成長率 │ 7.34%                              │\n├────────────┼────────────────────────────────────┤\n│ 趨勢公式   │ trend = exp(3.0619 + 0.005899 × t) │\n└────────────┴────────────────────────────────────┘\n---\n當前狀態\n┌────────────┬──────────┬────────────────────────────────────────┐\n│    指標    │   數值   │                  解讀                  │\n├────────────┼──────────┼────────────────────────────────────────┤\n│ 當前價格   │ 6,926.60 │ -                                      │\n├────────────┼──────────┼────────────────────────────────────────┤\n│ 趨勢價值   │ 4,637.36 │ 長期指數趨勢的「公允值」               │\n├────────────┼──────────┼────────────────────────────────────────┤\n│ 偏離度     │ +49.4%   │ 價格高於趨勢近 50%                     │\n├────────────┼──────────┼────────────────────────────────────────┤\n│ 歷史分位數 │ 94.9%    │ 在 76 年歷史中僅有 5% 時間比現在更偏離 │\n└────────────┴──────────┴────────────────────────────────────────┘\n---\n歷史分布統計\n┌───────────────┬───────────────────┐\n│    分位數     │      偏離度       │\n├───────────────┼───────────────────┤\n│ 25%           │ -16.0%            │\n├───────────────┼───────────────────┤\n│ 50%（中位數） │ -0.4%             │\n├───────────────┼───────────────────┤\n│ 75%           │ +23.2%            │\n├───────────────┼───────────────────┤\n│ 90%           │ +38.8%            │\n├───────────────┼───────────────────┤\n│ 95%           │ +49.4% ← 當前位置 │\n├───────────────┼───────────────────┤\n│ 99%           │ +88.5%            │\n└───────────────┴───────────────────┘\n---\n歷史極端值對照\n┌─────────────────────┬────────────┬─────────┬────────────────┐\n│        事件         │    日期    │ 偏離度  │   與當前比較   │\n├─────────────────────┼────────────┼─────────┼────────────────┤\n│ 2000 年網路泡沫頂點 │ 2000-03-31 │ +101.2% │ 當前僅達其 49% │\n├─────────────────────┼────────────┼─────────┼────────────────┤\n│ 1982 年沃克緊縮谷底 │ 1982-07-31 │ -49.8%  │ 歷史最悲觀時刻 │\n└─────────────────────┴────────────┴─────────┴────────────────┘\n---\n關鍵洞察\n\n1. 極端但未達歷史峰值\n當前 +49.4% 的偏離度位於歷史第 95 分位，屬於「偏高但非極端」區間。2000 年網路泡沫時偏離度達 +101.2%，是當前的兩倍。\n2. 長期趨勢穩健\nS&P 500 在 76 年間維持約 7.3% 的年化複合成長率，這反映了美國經濟與企業盈利的長期成長。\n3. 當前定價隱含樂觀預期\n價格高於趨勢 49%，暗示市場正在計入：\n  - AI 革命帶來的生產力躍升\n  - 企業盈利持續超預期成長\n  - 流動性環境相對寬鬆\n4. 風險提示\n歷史上當偏離度超過 +40% 後，未來 3-5 年的回報率通常低於長期平均。這不是「崩盤訊號」，而是「預期回報降低」的警示。\n\n---\n結論\n\nS&P 500 當前處於 歷史高偏離區間（95 分位），但距離 2000 年的泡沫極端值仍有相當距離。這表明市場定價偏向樂觀，但尚未進入「非理性繁榮」的極端狀態。\n\n---\n圖表說明：\n\n上圖 - 價格與趨勢線\n- 藍線：S&P 500 實際價格（對數尺度）\n- 紅色虛線：長期指數趨勢線（年化 7.3%）\n- 可見價格圍繞趨勢線上下波動，目前明顯高於趨勢\n\n下圖 - 偏離度\n- 紅色區域：高於趨勢的時期\n- 綠色區域：低於趨勢的時期\n- 紅色虛線：95 分位（約 +50%）\n- 綠色虛線：5 分位（約 -40%）\n\n關鍵觀察：\n1. 2000 年網路泡沫 創下 +101.2% 的歷史最高偏離度\n2. 1982 年 是歷史最悲觀時刻（-49.8%）\n3. 當前 +49.4% 正好位於 95 分位線上，偏離度較高但遠未達到泡沫極端\n"
      }
    ],
    "qualityScore": {
      "overall": 75,
      "badge": "白銀",
      "metrics": {
        "architecture": 80,
        "maintainability": 75,
        "content": 85,
        "community": 20,
        "security": 95,
        "compliance": 80
      },
      "details": "**架構（80/100）**\n- 清晰的指數趨勢擬合方法論\n- 歷史對照機制完整\n- 宏觀因子整合設計合理\n\n**可維護性（75/100）**\n- 參數定義完整\n- 多數據來源支援\n- 工作流程分離\n\n**內容（85/100）**\n- 1970s vs 2000s 行情體質分類有理論依據\n- 歷史峰值對照（2011/1980）有實際意義\n- 宏觀代理指標選擇合理\n\n**社區（20/100）**\n- 新技能，尚無社區貢獻\n\n**安全（95/100）**\n- 僅讀取公開價格數據\n- 無需 API key\n\n**規範符合性（80/100）**\n- 遵循 Claude Code 規範\n- 完整的文件結構\n"
    },
    "bestPractices": [
      {
        "title": "使用足夠長的歷史數據",
        "description": "建議至少 10-20 年歷史數據，以捕捉完整的週期。不同資產需要不同的起始日期"
      },
      {
        "title": "月頻數據降低噪音",
        "description": "長期趨勢分析建議使用月頻數據，日頻噪音太大。腳本會自動轉換"
      },
      {
        "title": "不預設歷史峰值",
        "description": "讓系統自動識別歷史極端值，或由使用者根據資產特性指定有意義的參考日期"
      },
      {
        "title": "理解偏離度的含義",
        "description": "偏離度是風險評估工具，不是交易訊號。高偏離可能持續很久，也可能快速回歸"
      }
    ],
    "pitfalls": [
      {
        "title": "把偏離度當作交易訊號",
        "description": "偏離度是風險評估工具，不是做多做空訊號",
        "consequence": "過早逆勢操作可能遭遇趨勢延續的虧損"
      },
      {
        "title": "使用固定的歷史參考點",
        "description": "不同資產有不同的週期特性，不應套用其他資產的歷史峰值",
        "consequence": "參考點失去意義，誤導決策"
      },
      {
        "title": "趨勢線擬合區間選擇不當",
        "description": "若只用近期數據擬合，趨勢斜率會被近期行情扭曲",
        "consequence": "偏離度計算失真"
      },
      {
        "title": "忽略結構性變化",
        "description": "資產的長期成長率可能因市場結構、制度變化而改變",
        "consequence": "簡單的全樣本擬合可能不適用於有結構性轉折的資產"
      }
    ],
    "faq": [
      {
        "question": "什麼是「指數趨勢偏離度」？",
        "answer": "指數趨勢偏離度衡量當前價格與長期指數成長趨勢線的距離，以百分比表示。\n\n計算方式：\n1. 對歷史價格取對數：y = log(price)\n2. 對時間做線性回歸：y = a + b*t\n3. 趨勢價格：trend = exp(a + b*t)\n4. 偏離度：(price / trend - 1) × 100%\n\n正偏離表示價格高於趨勢，負偏離表示低於趨勢。\n"
      },
      {
        "question": "這個工具適用於哪些資產？",
        "answer": "適用於具有長期指數成長特性的資產：\n\n**商品**：黃金、白銀、原油、銅等\n**股票指數**：S&P 500、納斯達克、全球指數等\n**加密貨幣**：比特幣、以太坊等（需注意歷史較短）\n**ETF**：各類 ETF\n**房地產指數**：房價指數、REIT 等\n\n核心要求：有足夠長的歷史數據（建議 ≥ 10 年）\n"
      },
      {
        "question": "如何選擇歷史參考日期？",
        "answer": "有兩種方式：\n\n**1. 自動識別**（推薦）：\n- 讓系統自動找出歷史最大偏離度\n- 不需要預先知道資產的歷史\n\n**2. 手動指定**：\n- 根據資產特性指定有意義的歷史峰值/谷值\n- 例如：黃金可參考 1980、2011；股市可參考 2000、2008、2020\n\n**黃金範例**：`--compare-peaks \"2011-09-06,1980-01-21\"`\n**股市範例**：`--compare-peaks \"2000-03-24,2007-10-09,2020-02-19\"`\n"
      },
      {
        "question": "宏觀因子分析支援哪些資產？",
        "answer": "目前宏觀因子分析主要針對黃金設計（1970s-like vs 2000s-like 體質）。\n\n其他資產的宏觀分析需要自定義因子和判定規則。\n\n若不使用 `--include-macro` 參數，工具會純粹計算偏離度，\n適用於所有資產。\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 參考來源\n\n- 靈感來自 Twitter/X 上關於「% distance from exponential growth trendline」的討論\n- 適用於多種資產類別的指數趨勢偏離度分析\n\n## 數據來源\n\n**Yahoo Finance（免費，無需 API key）**\n- 支援：股票、期貨、ETF、指數、加密貨幣等\n- 使用 yfinance 套件抓取\n\n**FRED（免費，無需 API key，選用）**\n- 宏觀因子：實質利率、通膨預期、美元指數等\n- 使用 pandas-datareader 套件抓取\n\n**Stooq（替代來源）**\n- 各類資產歷史數據\n- CSV 下載\n\n## 適用場景\n\n- 長期投資配置決策\n- 評估資產是否處於歷史極端區間\n- 風險管理與倉位調整\n- 多資產比較分析\n\n## 黃金專用功能\n\n針對黃金，可使用 `--include-macro` 參數進行：\n- 1970s-like vs 2000s-like 行情體質判定\n- 基於實質利率、通膨、地緣風險、美元的多因子分析\n\n參考範例：`examples/gold-deviation-2026.json`\n"
    },
    "methodology": "### 資產長期遵循指數成長\n\n許多資產在長期（數十年）尺度上遵循指數成長路徑，主要原因：\n\n1. **經濟成長**：全球經濟、貨幣供應量長期以指數方式增長\n2. **複利效應**：任何穩定的成長率在長期都會表現為指數形式\n3. **通膨因素**：名目價格會隨著通膨而增長\n\n**適用資產範例**：\n- **商品**：黃金、白銀、原油（受貨幣供應與購買力影響）\n- **股票指數**：S&P 500、NASDAQ（受經濟成長與盈利成長驅動）\n- **加密貨幣**：比特幣、以太坊（受採用率與網絡效應驅動）\n- **房地產**：房價指數（受收入成長與都市化影響）\n\n### 偏離度的意義\n\n偏離度衡量當前價格與「公允長期趨勢」的距離：\n\n- **正偏離**：價格高於趨勢，可能反映過度樂觀或極端事件\n- **負偏離**：價格低於趨勢，可能反映過度悲觀或錯誤定價\n",
    "downloadUrl": "downloads/evaluate-exponential-trend-deviation-regimes-0.1.0.zip"
  },
  {
    "id": "detect-atr-squeeze-regime",
    "name": "detect-atr-squeeze-regime",
    "displayName": "波動擠壓行情偵測",
    "description": "以 14 日指數平滑 ATR 偵測市場是否從秩序型趨勢轉為波動主導的擠壓（squeeze）行情，並輸出對技術位、停損、交易持有期的可行性評估。",
    "emoji": "💥",
    "version": "0.1.0",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "ATR",
      "波動率",
      "擠壓行情",
      "停損管理",
      "風險控制",
      "技術分析",
      "反身性",
      "市場微結構"
    ],
    "category": "indicator-monitoring",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": true,
    "installCount": 0,
    "content": "<essential_principles>\r\n\r\n<principle name=\"atr_percent_normalization\">\r\n**ATR% 標準化核心**\r\n\r\n傳統 ATR 是絕對值（價格單位），不同價位資產無法比較。\r\n將 ATR 轉換為百分比（ATR / Close * 100）後：\r\n- 可跨資產比較波動強度\r\n- 能建立「常態基準」（3 年移動均值）\r\n- 用「倍率」判定是否進入異常波動區\r\n\r\n```\r\nATR% = (14-day EMA of True Range) / Close * 100\r\nRatio = Current ATR% / 3-year Rolling Mean ATR%\r\n```\r\n</principle>\r\n\r\n<principle name=\"three_regime_classification\">\r\n**三行情分類**\r\n\r\n| 行情                           | ATR% 條件   | Ratio 條件 | 市場特徵                           |\r\n|--------------------------------|-------------|------------|------------------------------------|\r\n| `orderly_market`               | 常態區間    | < 1.2      | 技術位有效、停損精準、趨勢追蹤可靠 |\r\n| `elevated_volatility_trend`    | 偏高        | 1.2 - 2.0  | 技術位減效、需放寬停損、仍有方向性 |\r\n| `volatility_dominated_squeeze` | >= 高波門檻 | >= 2.0     | 技術位失靈、停損頻被掃、反身性主導 |\r\n\r\n**擠壓行情**的判定需要**同時**滿足：\r\n1. ATR% >= `high_vol_threshold_pct`（預設 6%）\r\n2. Ratio >= `spike_threshold_x`（預設 2.0）\r\n</principle>\r\n\r\n<principle name=\"reflexivity_mechanics\">\r\n**反身性機制解讀**\r\n\r\n當進入 `volatility_dominated_squeeze` 行情：\r\n\r\n**價格運動被「被迫流」主導**：\r\n- 保證金調整 / 槓桿去化\r\n- 期權 Delta/Gamma 避險\r\n- 空頭回補\r\n- 被動風險平價再平衡\r\n\r\n**技術位可靠度下降**：\r\n- 突破/跌破更常是流動性與風控觸發的結果\r\n- 不代表基本面改變或趨勢確認\r\n\r\n**停損脆弱性**：\r\n- 同一口波動可掃過多層 stops\r\n- 低時間尺度的 conviction trading「結構性受損」\r\n- 宏觀看對也難撐：短期雜訊大到足以讓方向正確的部位先被洗掉\r\n</principle>\r\n\r\n<principle name=\"actionable_adjustments\">\r\n**可操作的調整建議**\r\n\r\n當偵測到擠壓行情時：\r\n\r\n| 調整項目   | 秩序市場    | 擠壓行情       |\r\n|------------|-------------|----------------|\r\n| 停損倍數   | 1.0-1.5 ATR | 2.0-3.0 ATR    |\r\n| 倉位縮放   | 正常        | 降至 1/ATR%    |\r\n| 時間框架   | 日內/短線   | 切換到較長週期 |\r\n| 工具選擇   | 裸倉位      | 期權/價差結構  |\r\n| 技術位信任 | 高          | 低（視為雜訊） |\r\n</principle>\r\n\r\n</essential_principles>\r\n\r\n<objective>\r\n偵測資產是否進入「波動主導的擠壓行情」：\r\n\r\n1. **計算 ATR%**：14 日 EMA 平滑的真實波幅百分比\r\n2. **建立基準**：3 年滾動均值作為「常態」參照\r\n3. **判定行情**：比較當前值與基準的倍率\r\n4. **輸出建議**：停損調整、倉位縮放、技術位信任度\r\n\r\n輸出：行情判定、ATR% 數值、倍率、可操作的風控建議。\r\n</objective>\r\n\r\n<quick_start>\r\n\r\n**最快的方式：偵測白銀（SI=F）**\r\n\r\n```bash\r\ncd skills/detect-atr-squeeze-regime\r\npip install pandas numpy yfinance pandas_ta  # 首次使用\r\npython scripts/atr_squeeze.py --symbol SI=F --quick\r\n```\r\n\r\n輸出範例：\r\n```json\r\n{\r\n  \"symbol\": \"SI=F\",\r\n  \"as_of\": \"2026-01-14\",\r\n  \"regime\": \"volatility_dominated_squeeze\",\r\n  \"atr_pct\": 7.23,\r\n  \"atr_ratio_to_baseline\": 2.41,\r\n  \"tech_level_reliability\": \"low\",\r\n  \"tech_level_reliability_score\": 28,\r\n  \"suggested_stop_atr_mult\": 2.5,\r\n  \"position_scale\": 0.41\r\n}\r\n```\r\n\r\n**完整分析**：\r\n```bash\r\npython scripts/atr_squeeze.py --symbol XAGUSD --start 2020-01-01 --end 2026-01-01 --output result.json\r\n```\r\n\r\n**生成視覺化儀表盤**：\r\n```bash\r\npip install matplotlib  # 首次使用\r\npython scripts/plot_atr_squeeze.py --symbol SI=F --output output/\r\n```\r\n\r\n儀表盤包含：\r\n- 價格走勢圖\r\n- ATR% 波動率時間序列\r\n- ATR 倍率儀表盤\r\n- 當前狀態與風控建議面板\r\n\r\n</quick_start>\r\n\r\n<intake>\r\n需要進行什麼操作？\r\n\r\n1. **快速偵測** - 檢查單一資產的當前行情狀態\r\n2. **多資產掃描** - 掃描多個資產尋找擠壓行情\r\n3. **歷史回測** - 回溯識別過去的擠壓期間\r\n4. **持續監控** - 設定警報當行情切換時通知\r\n5. **方法論學習** - 了解 ATR 擠壓行情的理論基礎\r\n\r\n**請選擇或直接提供資產代碼開始分析。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                         | Action                                       |\r\n|----------------------------------|----------------------------------------------|\r\n| 1, \"快速\", \"quick\", \"check\"      | 執行 `python scripts/atr_squeeze.py --quick` |\r\n| 2, \"掃描\", \"scan\", \"multiple\"    | 閱讀 `workflows/monitor.md` 並執行           |\r\n| 3, \"回測\", \"backtest\", \"history\" | 閱讀 `workflows/backtest.md` 並執行          |\r\n| 4, \"監控\", \"monitor\", \"alert\"    | 閱讀 `workflows/monitor.md` 並執行           |\r\n| 5, \"學習\", \"方法論\", \"why\"       | 閱讀 `references/methodology.md`             |\r\n| 提供 symbol (如 SI=F, GC=F)      | 閱讀 `workflows/detect.md` 並使用參數執行    |\r\n\r\n**路由後，閱讀對應文件並執行。**\r\n</routing>\r\n\r\n<directory_structure>\r\n```\r\ndetect-atr-squeeze-regime/\r\n├── SKILL.md                           # 本文件（路由器）\r\n├── skill.yaml                         # 前端展示元數據\r\n├── manifest.json                      # 技能元數據\r\n├── workflows/\r\n│   ├── detect.md                      # 單資產偵測工作流\r\n│   ├── monitor.md                     # 多資產監控工作流\r\n│   └── backtest.md                    # 歷史回測工作流\r\n├── references/\r\n│   ├── methodology.md                 # ATR 擠壓行情方法論\r\n│   ├── input-schema.md                # 完整輸入參數定義\r\n│   └── data-sources.md                # 資料來源說明\r\n├── templates/\r\n│   ├── output-json.md                 # JSON 輸出模板\r\n│   └── output-markdown.md             # Markdown 報告模板\r\n├── scripts/\r\n│   ├── atr_squeeze.py                 # 主偵測腳本\r\n│   └── plot_atr_squeeze.py            # 視覺化儀表盤腳本\r\n└── examples/\r\n    └── xagusd-squeeze-2024.json       # 範例輸出\r\n```\r\n</directory_structure>\r\n\r\n<reference_index>\r\n\r\n**方法論**: references/methodology.md\r\n- ATR% 標準化原理\r\n- 三行情分類邏輯\r\n- 反身性機制解讀\r\n- Ole Hansen 白銀擠壓案例\r\n\r\n**資料來源**: references/data-sources.md\r\n- Yahoo Finance 期貨代碼\r\n- Stooq 替代來源\r\n- 數據頻率與對齊\r\n\r\n**輸入參數**: references/input-schema.md\r\n- 完整參數定義\r\n- 預設值與建議範圍\r\n\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow    | Purpose    | 使用時機         |\r\n|-------------|------------|------------------|\r\n| detect.md   | 單資產偵測 | 需要檢查特定資產 |\r\n| monitor.md  | 多資產監控 | 日常掃描或警報   |\r\n| backtest.md | 歷史回測   | 驗證識別準確性   |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose           |\r\n|--------------------|-------------------|\r\n| output-json.md     | JSON 輸出結構定義 |\r\n| output-markdown.md | Markdown 報告模板 |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script              | Command                          | Purpose          |\r\n|---------------------|----------------------------------|------------------|\r\n| atr_squeeze.py      | `--symbol SI=F --quick`          | 快速檢查當前狀態 |\r\n| atr_squeeze.py      | `--symbol SI=F --start DATE`     | 完整歷史分析     |\r\n| atr_squeeze.py      | `--scan SI=F,GC=F,CL=F`          | 多資產掃描       |\r\n| plot_atr_squeeze.py | `--symbol SI=F --output output/` | 生成視覺化儀表盤 |\r\n</scripts_index>\r\n\r\n<input_schema_summary>\r\n\r\n**核心參數**\r\n\r\n| 參數       | 類型   | 預設值     | 說明       |\r\n|------------|--------|------------|------------|\r\n| symbol     | string | (required) | 資產代碼   |\r\n| start_date | string | today-5y   | 取樣開始日 |\r\n| end_date   | string | today      | 取樣結束日 |\r\n| timeframe  | string | 1d         | 價格頻率   |\r\n\r\n**ATR 參數**\r\n\r\n| 參數            | 類型   | 預設值 | 說明                 |\r\n|-----------------|--------|--------|----------------------|\r\n| atr_period      | int    | 14     | ATR 週期             |\r\n| atr_smoothing   | string | ema    | 平滑法（ema/wilder） |\r\n| use_percent_atr | bool   | true   | 是否轉為百分比       |\r\n\r\n**行情判定參數**\r\n\r\n| 參數                   | 類型   | 預設值 | 說明                    |\r\n|------------------------|--------|--------|-------------------------|\r\n| baseline_window_days   | int    | 756    | 長期基準窗口（約 3 年） |\r\n| spike_threshold_x      | number | 2.0    | 倍率門檻                |\r\n| high_vol_threshold_pct | number | 6.0    | 絕對 ATR% 高波動門檻    |\r\n\r\n完整參數定義見 `references/input-schema.md`。\r\n\r\n</input_schema_summary>\r\n\r\n<output_schema_summary>\r\n```json\r\n{\r\n  \"skill\": \"detect-atr-squeeze-regime\",\r\n  \"symbol\": \"SI=F\",\r\n  \"as_of\": \"2026-01-14\",\r\n  \"regime\": \"volatility_dominated_squeeze\",\r\n  \"atr_pct\": 7.23,\r\n  \"atr_ratio_to_baseline\": 2.41,\r\n  \"baseline_atr_pct\": 3.0,\r\n  \"tech_level_reliability\": \"low\",\r\n  \"tech_level_reliability_score\": 28,\r\n  \"risk_adjustments\": {\r\n    \"suggested_stop_atr_mult\": 2.5,\r\n    \"position_scale\": 0.41,\r\n    \"recommended_timeframe\": \"weekly\",\r\n    \"instrument_suggestion\": \"options_or_spreads\"\r\n  },\r\n  \"interpretation\": {\r\n    \"regime_explanation\": \"...\",\r\n    \"tactics\": [\"...\", \"...\"]\r\n  }\r\n}\r\n```\r\n\r\n完整輸出結構見 `templates/output-json.md`。\r\n</output_schema_summary>\r\n\r\n<success_criteria>\r\n執行成功時應產出：\r\n\r\n- [ ] 當前行情判定（orderly / elevated / squeeze）\r\n- [ ] ATR% 數值與對基準的倍率\r\n- [ ] 技術位可靠度評分（0-100）\r\n- [ ] 建議停損倍數\r\n- [ ] 建議倉位縮放係數\r\n- [ ] 行情解釋與戰術建議\r\n- [ ] 時間序列資料（可選，用於視覺化）\r\n- [ ] 視覺化儀表盤 PNG（可選，使用 plot_atr_squeeze.py）\r\n</success_criteria>",
    "path": "skills/detect-atr-squeeze-regime/SKILL.md",
    "directoryStructure": "detect-atr-squeeze-regime/\n├── examples\n│   └── xagusd-squeeze-2024.json\n├── manifest.json\n├── references\n│   ├── data-sources.md\n│   ├── input-schema.md\n│   └── methodology.md\n├── scripts\n│   ├── atr_squeeze.py\n│   └── plot_atr_squeeze.py\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── output-json.md\n│   └── output-markdown.md\n└── workflows\n    ├── backtest.md\n    ├── detect.md\n    └── monitor.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "銀價目前是否處於擠壓行情？幫我偵測並給出交易建議",
        "imagePath": "images/atr-squeeze-SIF-2026-01-15.png",
        "expectedResult": "白銀（SI=F）波動擠壓行情偵測結果（數據截至 2026-01-14）\n\n┌─────────────────────────────┬────────┬─────────────────────────────┐\n│            指標             │  數值  │            狀態             │\n├─────────────────────────────┼────────┼─────────────────────────────┤\n│ 當前 ATR%                   │ 7.23%  │ 高於高波動門檻（6.0%）      │\n├─────────────────────────────┼────────┼─────────────────────────────┤\n│ ATR% 對基準倍率             │ 2.41x  │ 高於擠壓門檻（2.0x）        │\n├─────────────────────────────┼────────┼─────────────────────────────┤\n│ 3 年基準 ATR%               │ 3.00%  │ 常態參照值                  │\n└─────────────────────────────┴────────┴─────────────────────────────┘\n\n行情判定：volatility_dominated_squeeze（波動主導的擠壓行情）\n\n技術位可靠度評分：28/100（低）\n\n┌───────────────────────────────────────────────────────────────────┐\n│                        可操作的調整建議                          │\n├───────────────────────────────────────────────────────────────────┤\n│ 停損倍數：建議 2.5x ATR（原本 1.0-1.5x）                         │\n│ 倉位縮放：降至 0.41x（目標風險固定 → size ∝ 1/ATR）             │\n│ 時間框架：切換到週線或更長週期                                   │\n│ 工具選擇：偏向期權結構（defined risk）或價差策略                 │\n└───────────────────────────────────────────────────────────────────┘\n\n行情解讀\n\n當前白銀市場處於「波動主導的擠壓行情」：\n- 螢幕上的波動更多反映「被迫流」：保證金調整、期權避險、空頭回補\n- 技術位可靠度下降：突破/跌破更常是流動性觸發的結果\n- 停損脆弱：同一口波動可掃過多層 stops\n- 宏觀方向對也難撐：短期雜訊大到足以讓正確部位先被洗掉\n\n戰術建議\n\n1. 偏向較長週期決策，降低被日內噪音主導的風險\n2. 若要參與趨勢，優先考慮 defined-risk（期權/價差）結構\n3. 避免緊停損的短線交易，結構性受損\n"
      },
      {
        "question": "掃描貴金屬和原油的擠壓行情狀態",
        "expectedResult": "我已完成貴金屬和原油的擠壓行情掃描。以下是分析結果：\n\n📊 多資產 ATR 擠壓行情掃描結果（數據截至 2026-01-14）\n\n┌────────┬────────┬────────┬─────────────────────────────┬──────────┐\n│ Symbol │ ATR%   │ Ratio  │ Regime                      │ 信任度   │\n├────────┼────────┼────────┼─────────────────────────────┼──────────┤\n│ SI=F   │ 5.73%  │ 2.83x  │ elevated_volatility_trend   │ 0        │\n├────────┼────────┼────────┼─────────────────────────────┼──────────┤\n│ GC=F   │ 1.39%  │ 1.15x  │ orderly_market              │ 91       │\n├────────┼────────┼────────┼─────────────────────────────┼──────────┤\n│ CL=F   │ 3.12%  │ 1.02x  │ orderly_market              │ 94       │\n└────────┴────────┴────────┴─────────────────────────────┴──────────┘\n\n🔍 關鍵發現\n\n1. 白銀（SI=F）- ⚠️ 波動偏高的趨勢\n- ATR% 達 5.73%，是 3 年基準（2.03%）的 2.83 倍\n- 雖未達「擠壓行情」門檻（需 ATR% ≥ 6.0%），但已非常接近\n- RSI 72.3 顯示超買狀態\n- 技術位可靠度極低（0 分）\n\n建議：\n- 停損倍數：2.0x ATR（原本 1.0-1.5x）\n- 倉位縮放：降至 0.7x\n- 時間框架：日線以上\n- 工具選擇：裸倉位或期權結構\n\n2. 黃金（GC=F）- ✅ 秩序市場\n- ATR% 僅 1.39%，波動在正常範圍內\n- 倍率 1.15x，略高於基準但仍屬健康\n- 技術位高度可靠（91 分）\n- 正常交易策略可用\n\n3. 原油（CL=F）- ✅ 秩序市場\n- ATR% 3.12%，波動穩定\n- 倍率 1.02x，非常接近歷史常態\n- 技術位高度可靠（94 分）\n- 正常交易策略可用\n\n📋 總結\n\n- 0 個資產處於擠壓行情\n- 1 個資產波動偏高（SI=F，需警惕）\n- 2 個資產處於秩序市場（GC=F、CL=F）\n\n💡 交易建議\n\n1. 白銀（SI=F）：波動顯著升高，技術分析可靠度極低。建議降低槓桿、放寬停損。若要參與，考慮期權策略以限制風險。\n2. 黃金（GC=F）：市場秩序良好，標準交易策略可用，技術位可靠。\n3. 原油（CL=F）：市場最穩定，波動接近歷史常態，適合正常交易執行。\n"
      }
    ],
    "qualityScore": {
      "overall": 70,
      "badge": "白銀",
      "metrics": {
        "architecture": 80,
        "maintainability": 75,
        "content": 80,
        "community": 20,
        "security": 95,
        "compliance": 80
      },
      "details": "**架構（80/100）**\n- 清晰的三行情分類邏輯\n- ATR% 標準化設計\n- 可配置的門檻參數\n\n**可維護性（75/100）**\n- 參數定義完整\n- 多資料來源支援\n- 工作流程分離\n\n**內容（80/100）**\n- Ole Hansen 案例解讀\n- 反身性機制說明\n- 實用的風控建議\n\n**社區（20/100）**\n- 新技能，尚無社區貢獻\n\n**安全（95/100）**\n- 僅讀取公開價格數據\n- 無需 API key\n\n**規範符合性（80/100）**\n- 遵循 Claude Code 規範\n- 完整的文件結構\n"
    },
    "bestPractices": [
      {
        "title": "使用百分比 ATR 而非絕對值",
        "description": "ATR% 可跨資產比較，適合判斷波動是否「異常」"
      },
      {
        "title": "建立足夠長的基準期",
        "description": "至少 3 年（756 交易日）才能捕捉到週期性波動模式"
      },
      {
        "title": "雙條件判定擠壓行情",
        "description": "同時要求 ATR% 超過絕對門檻和倍率超過相對門檻，避免假陽性"
      },
      {
        "title": "調整策略而非強行交易",
        "description": "擠壓行情下應降槓桿、放寬停損、改用期權，而非試圖精準擇時"
      }
    ],
    "pitfalls": [
      {
        "title": "只看絕對值不看倍率",
        "description": "某些資產天生高波動，ATR% 高不代表異常",
        "consequence": "永遠處於「擠壓」判定，失去參考價值"
      },
      {
        "title": "基準期太短",
        "description": "如只用 1 年數據，可能剛好落在高波動週期",
        "consequence": "基準被污染，判定不準"
      },
      {
        "title": "忽略行情延續性",
        "description": "擠壓行情可能持續數週甚至數月",
        "consequence": "過早恢復激進交易，再次被洗掉"
      },
      {
        "title": "把擠壓行情當作交易訊號",
        "description": "擠壓行情是風控提示，不是做多做空訊號",
        "consequence": "方向判斷錯誤，虧損放大"
      }
    ],
    "faq": [
      {
        "question": "什麼是「擠壓行情」？",
        "answer": "當市場波動率（以 ATR% 衡量）遠超過歷史常態（通常是 3 年均值的 2 倍以上），\n且達到絕對高水平（如 6%），市場就進入「波動主導的擠壓行情」。\n\n此時價格運動不再主要反映基本面或技術面，\n而是被「被迫流」主導：保證金調整、槓桿去化、期權避險、空頭回補等。\n"
      },
      {
        "question": "為什麼擠壓行情下技術位會失靈？",
        "answer": "在擠壓行情下，價格突破/跌破支撐壓力位往往是流動性事件的結果，\n而非市場共識的改變。大量停損單被觸發、保證金追繳強制平倉、\n期權避險的 gamma 效應等，都會讓價格在短時間內大幅波動。\n\n這種波動是「噪音」而非「訊號」，技術分析的前提條件被破壞。\n"
      },
      {
        "question": "如何在擠壓行情下保護自己？",
        "answer": "1. **降槓桿**：倉位規模與 ATR% 成反比（固定風險）\n2. **放寬停損**：至少 2-3 倍 ATR，或改用時間/結構停損\n3. **拉長週期**：從日線切到週線，減少噪音影響\n4. **改用期權**：defined risk 結構，最大虧損可控\n5. **接受不確定性**：有時最好的策略是觀望\n"
      },
      {
        "question": "ATR 週期 14 天是固定的嗎？",
        "answer": "14 天是業界標準，也是 Ole Hansen 使用的週期。\n可以調整，但建議保持在 10-20 天範圍。\n太短會過度敏感，太長會反應滯後。\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 參考來源\n\n- Ole Hansen (Saxo Bank): https://x.com/Ole_S_Hansen/status/2011453253557289286\n- \"Volatility-Dominated Squeeze\" 概念\n\n## 數據來源\n\n**Yahoo Finance（免費，無需 API key）**\n- 期貨：SI=F（白銀）, GC=F（黃金）, CL=F（原油）\n- 使用 yfinance 套件抓取\n\n**Stooq（替代來源）**\n- CSV 下載\n- 部分外匯對與貴金屬現貨\n\n## 適用場景\n\n- 商品期貨（貴金屬、能源、農產品）\n- 外匯（特別是新興市場貨幣）\n- 股票指數（如 VIX 飆升期間的 SPY）\n- 任何可能出現「反身性高波動」的資產\n"
    },
    "methodology": "# 波動擠壓行情偵測方法論\r\n\r\n## 概念來源\r\n\r\n本方法論基於 Saxo Bank 商品策略主管 Ole Hansen 對白銀市場的分析觀點。\r\n\r\n**核心洞察**：當資產的波動率（以 14 日 ATR% 衡量）顯著超過歷史常態時，市場進入「波動主導的擠壓行情」，此時：\r\n\r\n- 技術位（支撐/壓力）的可靠度下降\r\n- 停損容易被「噪音」掃掉\r\n- 價格運動更多反映「被迫流」而非基本面\r\n\r\n## ATR 百分比（ATR%）\r\n\r\n### 為何使用百分比？\r\n\r\n傳統 ATR 是絕對值（以價格單位計算），無法：\r\n- 跨資產比較（$30 的白銀 vs $2000 的黃金）\r\n- 建立「常態」基準\r\n- 判斷波動是否「異常」\r\n\r\n**解決方案**：將 ATR 轉換為收盤價的百分比\r\n\r\n```\r\nATR% = ATR / Close * 100\r\n```\r\n\r\n例如：\r\n- 白銀 ATR = $2.17，Close = $30.00 → ATR% = 7.23%\r\n- 黃金 ATR = $57.00，Close = $2000.00 → ATR% = 2.85%\r\n\r\n### ATR 計算方法\r\n\r\n**True Range（真實波幅）**：\r\n\r\n```\r\nTR = max(High - Low, |High - Prev_Close|, |Low - Prev_Close|)\r\n```\r\n\r\n**14 日 EMA 平滑**：\r\n\r\n```python\r\n# EMA 平滑（預設）\r\nATR = TR.ewm(span=14, adjust=False).mean()\r\n\r\n# Wilder 平滑（替代）\r\nATR = TR.ewm(alpha=1/14, adjust=False).mean()\r\n```\r\n\r\n## 基準期選擇\r\n\r\n### 為何選擇 3 年（756 交易日）？\r\n\r\n- **涵蓋週期**：3 年足以涵蓋多數資產的波動週期\r\n- **統計穩定**：樣本量足夠計算有意義的均值\r\n- **實用性**：不會因太長而對當前市場失去敏感度\r\n\r\n### 基準計算\r\n\r\n```python\r\nbaseline_atr_pct = atr_pct.rolling(756).mean()\r\nratio = current_atr_pct / baseline_atr_pct\r\n```\r\n\r\n## 三行情分類\r\n\r\n### 1. 秩序市場（Orderly Market）\r\n\r\n**條件**：ratio < 1.2\r\n\r\n**特徵**：\r\n- 波動在歷史常態範圍內\r\n- 技術分析有效\r\n- 停損可精準設置\r\n- 趨勢追蹤策略可靠\r\n\r\n**建議**：\r\n- 正常交易策略\r\n- 標準停損（1.0-1.5 ATR）\r\n- 任意時間框架\r\n\r\n### 2. 波動偏高趨勢（Elevated Volatility Trend）\r\n\r\n**條件**：1.2 <= ratio < 2.0\r\n\r\n**特徵**：\r\n- 波動高於常態但仍有結構\r\n- 技術位有效性下降\r\n- 方向性仍可辨識\r\n- 需要適應性調整\r\n\r\n**建議**：\r\n- 適度放寬停損（1.5-2.0 ATR）\r\n- 降低倉位規模\r\n- 偏向較長時間框架\r\n\r\n### 3. 波動主導的擠壓行情（Volatility-Dominated Squeeze）\r\n\r\n**條件**：ratio >= 2.0 AND atr_pct >= 6.0%\r\n\r\n**特徵**：\r\n- 波動遠超常態\r\n- 技術位失靈\r\n- 「被迫流」主導價格\r\n- 停損頻繁被掃\r\n\r\n**建議**：\r\n- 大幅放寬停損（2.0-3.0 ATR）\r\n- 顯著降低倉位\r\n- 切換到週線以上\r\n- 使用期權/價差結構\r\n\r\n## 反身性機制\r\n\r\n### 什麼是「被迫流」？\r\n\r\n在擠壓行情下，價格運動不再主要反映：\r\n- 基本面變化\r\n- 技術面突破\r\n- 市場共識改變\r\n\r\n而是被以下「被迫流」主導：\r\n\r\n1. **保證金調整**\r\n   - 波動上升 → 保證金要求提高\r\n   - 無法追加保證金的部位被強制平倉\r\n\r\n2. **槓桿去化**\r\n   - 高槓桿投機者被迫減倉\r\n   - 連鎖反應放大波動\r\n\r\n3. **期權避險**\r\n   - Delta/Gamma 避險需求\r\n   - 價格接近執行價時避險量激增\r\n   - 正反饋循環\r\n\r\n4. **空頭回補**\r\n   - 空頭停損觸發\r\n   - 「軋空」放大上漲\r\n\r\n5. **被動再平衡**\r\n   - 風險平價/目標波動率策略\r\n   - 波動上升時自動減倉\r\n   - 加劇賣壓\r\n\r\n### 為何技術位失靈？\r\n\r\n技術分析的前提是：\r\n> 支撐/壓力位反映市場參與者的共識\r\n\r\n但在擠壓行情下：\r\n> 價格突破更多是流動性事件的結果，而非共識改變\r\n\r\n例如：\r\n- 白銀跌破 $28 支撐\r\n- 不是因為市場轉空\r\n- 而是因為大量停損單在該位置被觸發\r\n- 價格可能在數小時內收回\r\n\r\n## 技術位可靠度評分\r\n\r\n### 計算公式\r\n\r\n```python\r\ndef calculate_reliability_score(regime: str, ratio: float) -> int:\r\n    if regime == \"volatility_dominated_squeeze\":\r\n        # 2.0x -> 50分, 4.5x -> 0分\r\n        score = max(0, int(50 - (ratio - 2.0) * 20))\r\n    elif regime == \"elevated_volatility_trend\":\r\n        # 1.2x -> 100分, 2.0x -> 50分\r\n        score = int(50 + (2.0 - ratio) * 50 / 0.8)\r\n    else:\r\n        # 0.8x -> 100分, 1.2x -> 90分\r\n        score = int(100 - (ratio - 0.8) * 25)\r\n\r\n    return max(0, min(100, score))\r\n```\r\n\r\n### 解讀\r\n\r\n| 分數   | 等級 | 意義                 |\r\n|--------|------|----------------------|\r\n| 80-100 | 高   | 技術分析高度可靠     |\r\n| 50-79  | 中   | 需謹慎使用，放寬容忍 |\r\n| 20-49  | 低   | 技術位參考價值有限   |\r\n| 0-19   | 極低 | 視技術位為噪音       |\r\n\r\n## 實際案例\r\n\r\n### 白銀 2020 年 3 月（COVID-19）\r\n\r\n- ATR% 峰值：12.45%\r\n- Ratio 峰值：4.15x\r\n- 持續：37 天\r\n- 特徵：恐慌性拋售 + 流動性枯竭\r\n\r\n### 白銀 2024 年 8 月（日圓套利平倉）\r\n\r\n- ATR% 峰值：8.92%\r\n- Ratio 峰值：2.97x\r\n- 持續：37 天\r\n- 特徵：跨資產去槓桿連鎖反應\r\n\r\n## 局限性\r\n\r\n1. **滯後性**：ATR 是滯後指標，擠壓開始時才會偵測到\r\n2. **閾值敏感**：2.0x 和 6.0% 的門檻是經驗值，非普適\r\n3. **基準污染**：若基準期本身包含異常期間，判定會失準\r\n4. **資產差異**：不同資產的「正常」波動水平不同\r\n\r\n## 參考資料\r\n\r\n- Ole Hansen, Saxo Bank Commodity Strategy\r\n- True Range: J. Welles Wilder, \"New Concepts in Technical Trading Systems\" (1978)\r\n- 反身性理論: George Soros, \"The Alchemy of Finance\" (1987)\r\n",
    "downloadUrl": "downloads/detect-atr-squeeze-regime-0.1.0.zip"
  },
  {
    "id": "us-cpi-pce-comparator",
    "name": "us-cpi-pce-comparator",
    "displayName": "美國 CPI/PCE 通膨比較",
    "description": "自動比較 CPI（固定權重）與 PCE（動態權重）的通膨訊號，識別低波動高權重桶位的 PCE 上行風險。用於分析 Fed 關注的 PCE 是否正在 re-accelerate，即使 CPI 看似降溫。",
    "emoji": "📊",
    "version": "0.1.0",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "CPI",
      "PCE",
      "通膨",
      "Fed",
      "權重差異",
      "FRED",
      "BLS",
      "風險訊號",
      "宏觀經濟"
    ],
    "category": "inflation-analytics",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": false,
    "installCount": 0,
    "content": "<essential_principles>\r\n\r\n<principle name=\"weight_difference\">\r\n**CPI vs PCE 權重差異是核心**\r\n\r\n- **CPI（固定權重）**: BLS Relative Importance，每年或每兩年更新，反映「固定籃子」\r\n- **PCE（動態/鏈結權重）**: BEA 名目支出占比，每月隨實際消費行為調整\r\n\r\n關鍵洞見：當消費者把錢花在「價格較不波動」的品項時，若這些品項的通膨走高，PCE 會比 CPI 更敏感地反映這個上行壓力。\r\n</principle>\r\n\r\n<principle name=\"volatility_matters\">\r\n**低波動 + 高權重 = PCE 上行風險訊號**\r\n\r\n識別邏輯：\r\n1. 找出 PCE 權重較高的消費桶（consumer spending buckets）\r\n2. 在這些桶中，篩選價格波動度較低者\r\n3. 若這些桶的通膨近期轉正或加速，標記為 PCE upside risk\r\n</principle>\r\n\r\n<principle name=\"scope_difference\">\r\n**CPI 與 PCE 的範圍差異**\r\n\r\nPCE 涵蓋項目比 CPI 更廣：\r\n- 第三方支付的醫療費用（employer-paid healthcare）\r\n- 非營利機構對家庭的服務\r\n- 某些金融服務的隱含費用\r\n\r\n這些 scope 差異也會造成 CPI/PCE 分歧。詳見 `references/cpi-pce-methodology.md`。\r\n</principle>\r\n\r\n<principle name=\"data_access\">\r\n**資料取得方式**\r\n\r\n本 skill 使用**無需 API key** 的資料來源：\r\n- **FRED CSV**: `https://fred.stlouisfed.org/graph/fredgraph.csv?id={SERIES_ID}`\r\n- **BLS Public API**: `https://api.bls.gov/publicAPI/v2/timeseries/data/`\r\n\r\n腳本位於 `scripts/` 目錄，可直接執行。\r\n</principle>\r\n\r\n</essential_principles>\r\n\r\n<objective>\r\n比較 CPI 與 PCE 通膨訊號的分歧，並識別「低波動、高 PCE 權重」的消費桶是否正在推升 Fed 關注的 PCE 通膨路徑。\r\n\r\n輸出三層訊號：\r\n1. **Headline level**: CPI vs PCE divergence（bps）\r\n2. **Attribution**: 哪些 buckets 在推升 PCE（weighted contribution）\r\n3. **Risk framing**: 觀察點與延續性風險評估\r\n</objective>\r\n\r\n<quick_start>\r\n\r\n**最快的方式：執行快速檢查**\r\n\r\n```bash\r\ncd skills/us-cpi-pce-comparator\r\npip install pandas numpy requests  # 首次使用\r\npython scripts/cpi_pce_analyzer.py --quick\r\n```\r\n\r\n輸出範例：\r\n```json\r\n{\r\n  \"headline\": {\"cpi_yoy\": 2.65, \"pce_yoy\": 2.79, \"gap_bps\": 14},\r\n  \"core\": {\"cpi_core_yoy\": 2.65, \"pce_core_yoy\": 2.83, \"gap_bps\": 18},\r\n  \"momentum\": {\"cpi_3m_saar\": 2.07, \"pce_3m_saar\": 2.82}\r\n}\r\n```\r\n\r\n**完整分析**：\r\n```bash\r\npython scripts/cpi_pce_analyzer.py --start 2020-01-01 --measure yoy\r\n```\r\n\r\n</quick_start>\r\n\r\n<intake>\r\n需要進行什麼分析？\r\n\r\n1. **快速檢查** - 查看最新的 CPI/PCE 分歧數據\r\n2. **完整分析** - 執行完整的三步驟分析工作流\r\n3. **方法論學習** - 了解 CPI/PCE 差異的深層原因\r\n\r\n**請選擇或直接提供分析參數。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                     | Action                                            |\r\n|------------------------------|---------------------------------------------------|\r\n| 1, \"快速\", \"quick\", \"check\"  | 執行 `python scripts/cpi_pce_analyzer.py --quick` |\r\n| 2, \"完整\", \"full\", \"analyze\" | 閱讀 `workflows/analyze.md` 並執行                |\r\n| 3, \"學習\", \"方法論\", \"why\"   | 閱讀 `references/cpi-pce-methodology.md`          |\r\n| 提供參數 (如日期範圍)        | 閱讀 `workflows/analyze.md` 並使用參數執行        |\r\n\r\n**路由後，閱讀對應文件並執行。**\r\n</routing>\r\n\r\n<directory_structure>\r\n```\r\nus-cpi-pce-comparator/\r\n├── SKILL.md                           # 本文件（路由器）\r\n├── skill.yaml                         # 前端展示元數據\r\n├── workflows/\r\n│   ├── analyze.md                     # 完整分析工作流\r\n│   └── quick-check.md                 # 快速檢查工作流\r\n├── references/\r\n│   ├── data-sources.md                # FRED/BLS 系列代碼與資料來源\r\n│   ├── cpi-pce-methodology.md         # CPI/PCE 方法論深度解析\r\n│   └── implementation.md              # 計算公式與程式碼範例\r\n├── templates/\r\n│   ├── output-json.md                 # JSON 輸出模板\r\n│   └── output-markdown.md             # Markdown 報告模板\r\n└── scripts/\r\n    ├── fetch_fred_data.py             # FRED 資料抓取（無需 API key）\r\n    ├── fetch_bls_data.py              # BLS 資料抓取\r\n    └── cpi_pce_analyzer.py            # 主分析腳本\r\n```\r\n</directory_structure>\r\n\r\n<reference_index>\r\n\r\n**方法論**: references/cpi-pce-methodology.md\r\n- CPI vs PCE 的五大差異（權重、範圍、公式、住房、人口）\r\n- 分歧模式與交易含義\r\n- Fed 如何解讀兩指標\r\n\r\n**資料來源**: references/data-sources.md\r\n- FRED CSV endpoint（無需 API key）\r\n- FRED 系列代碼對照表\r\n- 桶位定義與近似計算\r\n\r\n**實作指南**: references/implementation.md\r\n- 通膨計算公式（YoY, MoM SAAR, QoQ SAAR）\r\n- 權重效應計算\r\n- 波動度分析\r\n\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow       | Purpose        | 使用時機           |\r\n|----------------|----------------|--------------------|\r\n| analyze.md     | 完整三步驟分析 | 需要深度分析時     |\r\n| quick-check.md | 快速檢查分歧   | 日常監控或快速回答 |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose           |\r\n|--------------------|-------------------|\r\n| output-json.md     | JSON 輸出結構定義 |\r\n| output-markdown.md | Markdown 報告模板 |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script              | Command                      | Purpose           |\r\n|---------------------|------------------------------|-------------------|\r\n| cpi_pce_analyzer.py | `--quick`                    | 快速檢查最新分歧  |\r\n| cpi_pce_analyzer.py | `--start DATE --measure yoy` | 完整分析          |\r\n| fetch_fred_data.py  | `--series CPIAUCSL,PCEPI`    | 抓取 FRED 資料    |\r\n| fetch_bls_data.py   | `--full`                     | 抓取 BLS CPI 資料 |\r\n</scripts_index>\r\n\r\n<input_schema>\r\n\r\n<parameter name=\"start_date\" required=\"true\">\r\n**Type**: string (ISO YYYY-MM-DD)\r\n**Description**: 分析起始日\r\n</parameter>\r\n\r\n<parameter name=\"end_date\" required=\"false\" default=\"today\">\r\n**Type**: string (ISO YYYY-MM-DD)\r\n**Description**: 分析結束日\r\n</parameter>\r\n\r\n<parameter name=\"measure\" required=\"false\" default=\"yoy\">\r\n**Type**: string\r\n**Options**: `yoy` | `mom_saar` | `qoq_saar`\r\n</parameter>\r\n\r\n<parameter name=\"baseline\" required=\"false\">\r\n**Type**: string\r\n**Format**: `YYYY-MM-DD:YYYY-MM-DD`\r\n**Description**: 基準期範圍，用於計算偏離度\r\n</parameter>\r\n\r\n</input_schema>\r\n\r\n<output_schema>\r\n參見 `templates/output-json.md` 的完整結構定義。\r\n\r\n**摘要**：\r\n```json\r\n{\r\n  \"headline\": {\"cpi_yoy\": 2.65, \"pce_yoy\": 2.79, \"gap_bps\": 14},\r\n  \"low_vol_high_weight_buckets\": [{\"bucket\": \"...\", \"signal\": \"upside\"}],\r\n  \"attribution\": {\"top_contributors\": [...], \"weight_effect_bps\": 12},\r\n  \"interpretation\": [\"...\"],\r\n  \"caveats\": [\"...\"]\r\n}\r\n```\r\n</output_schema>\r\n\r\n<success_criteria>\r\n分析成功時應產出：\r\n\r\n- [ ] Headline level 的 CPI/PCE 分歧數值（bps）\r\n- [ ] 識別出低波動、高 PCE 權重的桶位\r\n- [ ] 各桶位的加權通膨貢獻（attribution）\r\n- [ ] 若有 baseline，產出「less baseline」偏離度\r\n- [ ] 可操作的解讀與風險提示\r\n- [ ] 明確標註資料限制與近似處理\r\n</success_criteria>",
    "path": "skills/us-cpi-pce-comparator/SKILL.md",
    "directoryStructure": "us-cpi-pce-comparator/\n├── manifest.json\n├── references\n│   ├── cpi-pce-methodology.md\n│   ├── data-sources.md\n│   └── implementation.md\n├── scripts\n│   ├── cpi_pce_analyzer.py\n│   ├── fetch_bls_data.py\n│   ├── fetch_fred_data.py\n│   └── __pycache__\n│       ├── fetch_bls_data.cpython-312.pyc\n│       └── fetch_fred_data.cpython-312.pyc\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── output-json.md\n│   └── output-markdown.md\n└── workflows\n    ├── analyze.md\n    └── quick-check.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "分析當前 CPI 與 PCE 的分歧情況",
        "expectedResult": "此分析器會：\n1. 從 FRED 抓取最新 CPI 和 PCE 數據\n2. 計算 headline 層級的 YoY 分歧（bps）\n3. 識別低波動高權重桶位的風險訊號\n4. 輸出結構化 JSON 結果\n"
      },
      {
        "question": "為什麼 PCE 比 CPI 更高？Fed 關注哪個指標？",
        "expectedResult": "解釋 CPI/PCE 五大差異：\n- 權重方法（固定 vs 動態）\n- 涵蓋範圍（PCE 更廣）\n- 公式差異\n- 住房計算\n- 人口覆蓋\n"
      }
    ],
    "qualityScore": {
      "overall": 75,
      "badge": "白銀",
      "metrics": {
        "architecture": 80,
        "maintainability": 80,
        "content": 85,
        "community": 20,
        "security": 95,
        "compliance": 85
      },
      "details": "**架構（80/100）**\n- 清晰的三層訊號架構\n- 模組化腳本設計\n- 無需 API key 的數據獲取\n\n**可維護性（80/100）**\n- 工作流程分離清晰\n- 參數定義完整\n- 多數據源支援\n\n**內容（85/100）**\n- 完整的方法論文檔\n- CPI/PCE 差異深度解析\n- 實用的 CLI 工具\n\n**社區（20/100）**\n- 新技能，尚無社區貢獻\n\n**安全（95/100）**\n- 僅讀取公開經濟數據\n- 無需 API key\n\n**規範符合性（85/100）**\n- 遵循 Claude Code 規範\n- 完整的文件結構\n"
    },
    "bestPractices": [
      {
        "title": "關注 Core 而非 Headline",
        "description": "Core CPI/PCE 排除食品與能源，更能反映趨勢性通膨"
      },
      {
        "title": "使用 3M SAAR 觀察動量",
        "description": "YoY 有滯後性，3 個月 SAAR 更能捕捉拐點"
      },
      {
        "title": "理解權重效應",
        "description": "PCE 動態權重會自動降低高通膨項目的權重（替代效應）"
      },
      {
        "title": "結合兩個指標",
        "description": "CPI 反映消費者體感，PCE 是 Fed 目標，兩者都重要"
      }
    ],
    "pitfalls": [
      {
        "title": "只看 Headline",
        "description": "Headline 受能源價格波動影響大",
        "consequence": "錯過核心通膨趨勢"
      },
      {
        "title": "忽略權重差異",
        "description": "CPI/PCE 在醫療、住房等項目權重差異顯著",
        "consequence": "無法解釋分歧來源"
      },
      {
        "title": "過度解讀單月數據",
        "description": "月度數據波動大，容易被噪音誤導",
        "consequence": "錯誤判斷通膨趨勢"
      }
    ],
    "faq": [
      {
        "question": "Fed 主要看哪個通膨指標？",
        "answer": "Fed 的 2% 目標是針對 **Core PCE YoY**。\n但 Fed 也關注 CPI，因為它是市場預期的錨定點。\n"
      },
      {
        "question": "為什麼 PCE 通常比 CPI 低？",
        "answer": "主要原因：\n1. PCE 動態權重會因替代效應自動降低高通膨項目權重\n2. PCE 包含第三方支付的醫療，這部分通膨通常較溫和\n3. PCE 住房權重較低（約 15% vs CPI 約 33%）\n"
      },
      {
        "question": "如何判斷 PCE 是否在 re-accelerate？",
        "answer": "觀察指標：\n1. 3M SAAR 是否高於 YoY\n2. 低波動高權重桶位是否出現加速\n3. Core Services ex-Housing 是否持續偏高\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 數據來源\n\n**FRED（免費，無需 API key）**\n- CPI: CPIAUCSL, CPILFESL\n- PCE: PCEPI, PCEPILFE\n- 使用 CSV endpoint 直接下載\n\n**BLS Public API**\n- 詳細 CPI 分項數據\n- 權重與相對重要性\n"
    },
    "downloadUrl": "downloads/us-cpi-pce-comparator-0.1.0.zip"
  },
  {
    "id": "nickel-concentration-risk-analyzer",
    "name": "nickel-concentration-risk-analyzer",
    "displayName": "分析鎳供給集中度風險",
    "description": "以全球鎳供給結構為核心，量化各國的主導程度（例如印尼）、主要礦區供給量、以及政策配額/減產情境對全球供需平衡與價格非對稱的影響。",
    "emoji": "🪨",
    "version": "0.1.1",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "鎳",
      "供給集中度",
      "原物料",
      "採礦",
      "地緣政治",
      "情境分析",
      "USGS",
      "INSG"
    ],
    "category": "event-scenario",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": false,
    "installCount": 0,
    "content": "<essential_principles>\r\n**鎳供給集中度分析 核心原則**\r\n\r\n<principle name=\"unit_enforcement\">\r\n**口徑先行（Unit Enforcement）**\r\n\r\n所有分析必須先確定口徑，不同口徑會導致數量級差異：\r\n\r\n| 口徑            | 說明                        | 典型數值差異 |\r\n|-----------------|-----------------------------|--------------|\r\n| `t_Ni_content`  | 鎳金屬含量（本 Skill 預設） | 基準值       |\r\n| `t_ore_wet`     | 礦石濕噸                    | 可達 50-100x |\r\n| `t_NPI_product` | NPI 產品噸                  | 約 10-15% Ni |\r\n| `t_matte`       | 鎳鋶噸                      | 約 75% Ni    |\r\n\r\n**強制規則**：\r\n- 若輸入數據口徑不明確，必須標記為 `model_estimate`\r\n- 同一分析中不得混用不同口徑數據\r\n- 輸出必須包含 `unit` 欄位\r\n</principle>\r\n\r\n<principle name=\"supply_type_clarity\">\r\n**供給類型區分（Supply Type Clarity）**\r\n\r\n鎳供給鏈各階段必須分開計算：\r\n\r\n```\r\nMine Production (mined) → Intermediate (NPI/Matte/MHP) → Refined (class1/class2)\r\n```\r\n\r\n- **mined**: 礦場產量（鎳金屬含量）\r\n- **refined**: 精煉產量（含冶煉）\r\n- 「印尼 60% 市佔」通常指 **mined nickel content**\r\n</principle>\r\n\r\n<principle name=\"data_tiering\">\r\n**數據分層策略（Data Tiering）**\r\n\r\n| Tier | 特性                 | 來源           | 用途               |\r\n|------|----------------------|----------------|--------------------|\r\n| 0    | 免費、穩定、口徑一致 | USGS MCS, INSG | Baseline 主幹      |\r\n| 1    | 免費但分散、需整合   | 公司年報、財報 | Mine-level 錨點    |\r\n| 2    | 付費、更即時完整     | S&P Global MI  | 精度驗證、對齊口徑 |\r\n| 3    | 政策/配額近期訊息    | 新聞、官方公告 | 情境輸入           |\r\n\r\n**優先順序**：Tier 0 建立 baseline → Tier 1 補充 mine-level → Tier 2 驗證精度\r\n</principle>\r\n\r\n<principle name=\"execution_probability\">\r\n**政策執行機率（Execution Probability）**\r\n\r\n政策減產不需 100% 執行即可造成衝擊。預設模型：\r\n\r\n```python\r\nexpected_cut = cut_value * execution_prob  # 預設 execution_prob = 0.5\r\n```\r\n\r\n三層輸出：\r\n- **Hard cut**: 政策完全落地\r\n- **Half success**: 執行 50%（或指定值）\r\n- **Soft landing**: 只延遲投產/只砍新增產能\r\n</principle>\r\n\r\n<principle name=\"concentration_metrics\">\r\n**集中度指標定義**\r\n\r\n| 指標            | 公式                         | 解讀                     |\r\n|-----------------|------------------------------|--------------------------|\r\n| Country Share   | `country_prod / global_prod` | 單國佔比                 |\r\n| CR_n            | `Σ top_n_share`              | 前 N 國/礦集中度         |\r\n| HHI             | `Σ share²`                   | 市場集中度（0-10000）    |\r\n| Policy Leverage | `cut_amount / global_prod`   | 政策可撬動的全球供給比例 |\r\n\r\nHHI 判讀：< 1500 低集中、1500-2500 中等、> 2500 高集中\r\n</principle>\r\n</essential_principles>\r\n\r\n<intake>\r\n**您想要執行什麼操作？**\r\n\r\n1. **Analyze** - 分析全球鎳供給結構與集中度指標（CR_n, HHI, country share）\r\n2. **Scenario** - 模擬政策/減產情境對供給的衝擊（RKAB配額、出口限制等）\r\n3. **Validate** - 驗證市場說法的數據口徑與來源可靠度\r\n4. **Ingest** - 從各數據源擷取並標準化鎳供給數據\r\n\r\n**等待回應後再繼續。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                                                | Workflow                      | Description          |\r\n|---------------------------------------------------------|-------------------------------|----------------------|\r\n| 1, \"analyze\", \"concentration\", \"share\", \"hhi\", \"集中度\" | workflows/analyze.md          | 供給結構與集中度分析 |\r\n| 2, \"scenario\", \"policy\", \"cut\", \"減產\", \"情境\", \"RKAB\"  | workflows/scenario-engine.md  | 政策情境衝擊模擬     |\r\n| 3, \"validate\", \"verify\", \"check\", \"驗證\", \"來源\"        | workflows/validate-sources.md | 數據來源與口徑驗證   |\r\n| 4, \"ingest\", \"fetch\", \"data\", \"抓取\", \"擷取\"            | workflows/ingest.md           | 數據擷取與標準化     |\r\n\r\n**讀取工作流程後，請完全遵循其步驟。**\r\n</routing>\r\n\r\n<reference_index>\r\n**參考文件** (`references/`)\r\n\r\n| 文件                          | 內容                       |\r\n|-------------------------------|----------------------------|\r\n| data-sources.md               | 所有數據來源詳細說明與 URL |\r\n| unit-conversion.md            | 單位轉換規則與假設         |\r\n| concentration-metrics.md      | 集中度指標詳細計算方法     |\r\n| indonesia-supply-structure.md | 印尼鎳供給結構與關鍵園區   |\r\n| mine-level-anchors.md         | 主要礦區/園區產量錨點      |\r\n| failure-modes.md              | 失敗模式與緩解策略         |\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow            | Purpose                                  |\r\n|---------------------|------------------------------------------|\r\n| analyze.md          | 供給結構與集中度分析（CR_n, HHI, share） |\r\n| scenario-engine.md  | 政策情境衝擊模擬                         |\r\n| validate-sources.md | 數據來源與口徑驗證                       |\r\n| ingest.md           | 數據擷取與標準化                         |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose           |\r\n|--------------------|-------------------|\r\n| output-json.md     | JSON 輸出結構模板 |\r\n| output-markdown.md | Markdown 報告模板 |\r\n| config.yaml        | 分析參數配置模板  |\r\n| data-schema.yaml   | 數據 Schema 定義  |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script                   | Purpose                |\r\n|--------------------------|------------------------|\r\n| nickel_pipeline.py       | 核心數據管線           |\r\n| ingest_sources.py        | 數據來源擷取           |\r\n| compute_concentration.py | 集中度指標計算         |\r\n| scenario_impact.py       | 情境衝擊模擬           |\r\n| visualize_concentration.py | 集中度分析視覺化圖表 |\r\n| visualize_scenario.py    | 情境衝擊視覺化圖表     |\r\n</scripts_index>\r\n\r\n<quick_start>\r\n**CLI 快速開始：**\r\n\r\n```bash\r\n# 分析當前全球鎳供給集中度\r\npython scripts/nickel_pipeline.py analyze --asof=2026-01-16 --scope=mined\r\n\r\n# 生成集中度視覺化圖表（輸出到 output/ 目錄，檔名包含日期）\r\npython scripts/visualize_concentration.py\r\n\r\n# 模擬印尼減產 20% 的情境衝擊\r\npython scripts/nickel_pipeline.py scenario --cut=20 --target=Indonesia --exec-prob=0.5\r\n\r\n# 生成情境衝擊視覺化圖表\r\npython scripts/visualize_scenario.py\r\n\r\n# 驗證「印尼 60% 市佔」的數據來源\r\npython scripts/nickel_pipeline.py validate --claim=\"Indonesia 60% share\"\r\n```\r\n\r\n**Library 快速開始：**\r\n\r\n```python\r\nfrom nickel_pipeline import NickelConcentrationAnalyzer\r\n\r\nanalyzer = NickelConcentrationAnalyzer(\r\n    asof_date=\"2026-01-16\",\r\n    scope={\"supply_type\": \"mined\", \"unit\": \"t_Ni_content\"},\r\n    data_level=\"free_nolimit\"\r\n)\r\n\r\n# 計算集中度指標\r\nresult = analyzer.compute_concentration()\r\nprint(f\"Indonesia share: {result['indonesia_share_2024']:.1%}\")\r\nprint(f\"HHI: {result['hhi_2024']:.0f}\")\r\n```\r\n</quick_start>\r\n\r\n<success_criteria>\r\nSkill 成功執行時：\r\n- [ ] 正確識別數據口徑（mined/refined/nickel content）\r\n- [ ] 輸出包含 unit 欄位標註\r\n- [ ] 集中度指標計算正確（share, CR_n, HHI）\r\n- [ ] 情境分析輸出三層結果（hard/half/soft）\r\n- [ ] 數據來源可追溯（source_id, confidence）\r\n- [ ] 單位警告正確觸發（ore vs content）\r\n</success_criteria>\r\n\r\n<input_schema>\r\n**輸入參數定義**\r\n\r\n```yaml\r\n# 必要參數\r\nasof_date: string (ISO)  # 分析基準日\r\nhorizon:\r\n  history_start_year: int\r\n  history_end_year: int\r\n  forecast_end_year: int\r\n\r\n# 範圍參數\r\nscope:\r\n  supply_type: string  # mined | refined | nickel_content (必填)\r\n  product_group: string  # class1 | class2 | NPI | matte | MHP | mixed (選填)\r\n  countries: array[string]  # 預設: Indonesia, Philippines, Russia, Canada, Australia, Other\r\n\r\n# 情境參數 (scenario workflow 專用)\r\npolicy_scenarios:\r\n  - name: string\r\n    target_country: string  # 預設: Indonesia\r\n    policy_variable: string  # ore_quota_RKAB | mine_permit | export_rule | smelter_capacity\r\n    cut_type: string  # pct_global | pct_country | absolute\r\n    cut_value: number\r\n    start_year: int\r\n    end_year: int\r\n    execution_prob: number  # 0-1, 預設 0.5\r\n\r\n# 數據等級\r\ndata_level: string  # free_nolimit | free_limit | paid_low | paid_high\r\n```\r\n</input_schema>\r\n\r\n<data_pipeline_architecture>\r\n**數據流水線架構**\r\n\r\n```\r\n[Data Sources]\r\n     |\r\n     v\r\n+-------------------+\r\n|   ingest_sources  |  --> Tier 0: USGS, INSG\r\n+-------------------+      Tier 1: Company reports\r\n     |                     Tier 2: S&P Global (optional)\r\n     v\r\n+-------------------+\r\n|   normalize       |  --> 統一 schema + 單位標註\r\n+-------------------+      (year, country, supply_type, value, unit, source_id)\r\n     |\r\n     v\r\n+-------------------+\r\n| compute_concentration | --> share, CR_n, HHI\r\n+-------------------+\r\n     |\r\n     v\r\n+-------------------+\r\n|   scenario_impact |  --> expected_cut, global_hit_pct\r\n+-------------------+\r\n     |\r\n     v\r\n+-------------------+\r\n|   generate_output |  --> JSON + Markdown\r\n+-------------------+\r\n     |\r\n     v\r\n[Analysis Result]\r\n```\r\n\r\n**標準化欄位 Schema：**\r\n\r\n| 欄位          | 類型   | 說明                                     |\r\n|---------------|--------|------------------------------------------|\r\n| year          | int    | 年度                                     |\r\n| country       | string | 國家                                     |\r\n| supply_type   | string | mined/refined                            |\r\n| product_group | string | NPI/matte/MHP/class1...                  |\r\n| value         | float  | 數值                                     |\r\n| unit          | string | t_Ni_content / t_ore_wet / t_NPI_product |\r\n| source_id     | string | USGS/INSG/S&P/Company/Other              |\r\n| confidence    | float  | 來源品質評分 (0-1)                       |\r\n</data_pipeline_architecture>",
    "path": "skills/nickel-concentration-risk-analyzer/SKILL.md",
    "directoryStructure": "nickel-concentration-risk-analyzer/\n├── examples\n│   ├── analysis_report.md\n│   ├── concentration_analysis.json\n│   └── scenario_result.json\n├── manifest.json\n├── methodology.md\n├── README.md\n├── references\n│   ├── concentration-metrics.md\n│   ├── data-sources.md\n│   ├── failure-modes.md\n│   ├── indonesia-supply-structure.md\n│   ├── mine-level-anchors.md\n│   └── unit-conversion.md\n├── scripts\n│   ├── compute_concentration.py\n│   ├── ingest_sources.py\n│   ├── nickel_pipeline.py\n│   ├── scenario_impact.py\n│   ├── visualize_concentration.py\n│   └── visualize_scenario.py\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── config.yaml\n│   ├── data-schema.yaml\n│   ├── output-json.md\n│   └── output-markdown.md\n└── workflows\n    ├── analyze.md\n    ├── ingest.md\n    ├── scenario-engine.md\n    └── validate-sources.md",
    "lastUpdated": "2026-01-16",
    "rating": 3,
    "testQuestions": [
      {
        "question": "分析全球鎳供給的國家集中度，特別是印尼的市佔率",
        "imagePath": "images/nickel-concentration-2026-01-16.png",
        "expectedResult": "全球鎳供給集中度分析報告\n\n分析日期: 2026-01-16\n數據口徑: Mined nickel content (礦場產量的鎳金屬含量)\n數據來源: USGS Mineral Commodity Summaries, INSG World Nickel Statistics\n\n---\n執行摘要\n\n全球鎳供給呈現極高集中度，印尼已成為絕對主導的供給國。2024年印尼鎳產量達到220萬噸(鎳金屬含量)，佔全球總產量的57.9%，市場集中度指標HHI達到3779，遠超2500的高集中門檻。這種極端集中的供給結構使全球鎳市場面臨顯著的政策風險與供給中斷風險。\n\n---\n關鍵發現\n┌──────────────┬────────────┬──────────────────────────────┐\n│     指標     │ 2024年數值 │             解讀             │\n├──────────────┼────────────┼──────────────────────────────┤\n│ 印尼市佔率   │ 57.9%      │ 單一國家主導全球供給         │\n├──────────────┼────────────┼──────────────────────────────┤\n│ CR1 (最大國) │ 57.9%      │ 極高單國集中度               │\n├──────────────┼────────────┼──────────────────────────────┤\n│ CR3 (前三國) │ 84.2%      │ 前三國控制絕大部分供給       │\n├──────────────┼────────────┼──────────────────────────────┤\n│ CR5 (前五國) │ 93.7%      │ 前五國幾乎壟斷全球產能       │\n├──────────────┼────────────┼──────────────────────────────┤\n│ HHI          │ 3779       │ 高集中 (Highly Concentrated) │\n└──────────────┴────────────┴──────────────────────────────┘\n風險評級: 🔴 極高風險\n\n---\n印尼市佔率時序趨勢 (2015-2024)\n┌──────┬──────────────────┬──────────────────┬────────────┬───────┬──────────┐\n│ 年份 │ 印尼產量 (kt Ni) │ 全球產量 (kt Ni) │ 印尼市佔率 │  HHI  │ 市場結構 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2015 │ 130              │ 2,566            │ 5.1%       │ 2,279 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2016 │ 170              │ 2,545            │ 6.7%       │ 2,250 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2017 │ 345              │ 2,635            │ 13.1%      │ 2,350 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2018 │ 560              │ 2,690            │ 20.8%      │ 2,194 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2019 │ 800              │ 3,090            │ 25.9%      │ 2,280 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2020 │ 760              │ 2,440            │ 31.1%      │ 1,999 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2021 │ 1,000            │ 2,690            │ 37.2%      │ 2,259 │ 中等集中 │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2022 │ 1,600            │ 3,170            │ 50.5%      │ 3,121 │ 高集中   │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2023 │ 1,900            │ 3,510            │ 54.1%      │ 3,434 │ 高集中   │\n├──────┼──────────────────┼──────────────────┼────────────┼───────┼──────────┤\n│ 2024 │ 2,200            │ 3,800            │ 57.9%      │ 3,779 │ 高集中   │\n└──────┴──────────────────┴──────────────────┴────────────┴───────┴──────────┘\n趨勢觀察:\n- 📈 印尼市佔率10年間增長11倍(5.1% → 57.9%)\n- 🔄 2020年礦石出口禁令實施後,市佔率從31.1%持續攀升\n- 🎯 2022年首次突破50%門檻,市場結構轉變為\"高集中\"\n- ⚡ 2020-2024年間,印尼產量增長189%(0.76 → 2.2 Mt)\n\n---\n國家份額分布 (2024)\n┌──────┬──────────────────┬──────────────┬───────┬──────────┐\n│ 排名 │       國家       │ 產量 (kt Ni) │ 份額  │ 累積份額 │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 1    │ 🇮🇩 Indonesia     │ 2,200        │ 57.9% │ 57.9%    │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 2    │ 🌍 Other         │ 600          │ 15.8% │ 73.7%    │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 3    │ 🇵🇭 Philippines   │ 400          │ 10.5% │ 84.2%    │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 4    │ 🇷🇺 Russia        │ 210          │ 5.5%  │ 89.7%    │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 5    │ 🇨🇦 Canada        │ 150          │ 3.9%  │ 93.7%    │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 6    │ 🇦🇺 Australia     │ 140          │ 3.7%  │ 97.4%    │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 7    │ 🇳🇨 New Caledonia │ 100          │ 2.6%  │ 100.0%   │\n├──────┼──────────────────┼──────────────┼───────┼──────────┤\n│ 總計 │                  │ 3,800        │ 100%  │          │\n└──────┴──────────────────┴──────────────┴───────┴──────────┘\n---\n印尼供給結構與成長驅動因素\n\n產品結構 (2024估計):\n- NPI (Nickel Pig Iron): ~70% - 主要用於不鏽鋼生產\n- Matte (鎳鋶): ~15% - Class 1 鎳(PT Vale Indonesia)\n- MHP (Mixed Hydroxide Precipitate): ~10% - 電池級鎳(HPAL工藝)\n- Ferronickel (鐵鎳合金): ~5%\n\n關鍵工業園區:\n- IMIP (Indonesia Morowali Industrial Park) - Central Sulawesi\n  - 全球最大鎳加工園區\n  - 主要產品: NPI, 不鏽鋼\n- IWIP (Indonesia Weda Bay Industrial Park) - North Maluku\n  - Eramet合資\n  - 產品: NPI, HPAL(電池級鎳)\n\n成長驅動因素:\n1. ✅ 2020年礦石出口禁令 → 強制在地加工\n2. ✅ 大規模NPI產能投資(主要來自中國資本)\n3. ✅ HPAL產能擴張(支援電動車電池需求)\n4. ✅ 政府產業政策支持\n\n---\n集中度風險矩陣\n\n根據HHI與CR1的雙重指標,全球鎳市場定位於極高風險區間:\n┌────────────┬────────────┬───────────────┬─────────────┐\n│            │ HHI < 1500 │ HHI 1500-2500 │ HHI > 2500  │\n├────────────┼────────────┼───────────────┼─────────────┤\n│ CR1 < 30%  │ 低風險     │ 中風險        │ 中高風險    │\n├────────────┼────────────┼───────────────┼─────────────┤\n│ CR1 30-50% │ 中風險     │ 中高風險      │ 高風險      │\n├────────────┼────────────┼───────────────┼─────────────┤\n│ CR1 > 50%  │ 中高風險   │ 高風險        │ 🔴 極高風險 │\n└────────────┴────────────┴───────────────┴─────────────┘\n2024鎳市場: CR1 = 57.9%, HHI = 3,779 → 極高風險\n\n---\n政策風險評估\n\nRKAB配額政策:\n- RKAB (Rencana Kerja Anggaran Biaya): 印尼年度礦石開採配額制度\n- 單位: Ore wet tonnes (礦石濕噸) - 非 nickel content\n- 傳聞: 2026年配額可能從2025年的379 Mt降至250 Mt (減少34%)\n\n政策槓桿計算 (假設印尼減產20%):\n- 受影響供給: 2.2 Mt × 20% = 440 kt Ni\n- 全球衝擊: 440 kt / 3.8 Mt = 11.6%\n- 相當於: 42天全球消費量\n- 風險等級: 🔴 極高風險\n\n---\n與S&P Global數據的比對\n\nS&P Global Market Intelligence公開引用數據:\n- 2024年印尼市佔率: 60.2%\n- 本分析計算結果: 57.9%\n- 差異: 2.3個百分點\n\n差異原因:\n1. 數據來源口徑微差(USGS vs S&P的統計範圍)\n2. S&P可能包含更多mine-level細節數據\n3. 估計值的假設差異\n\n結論: 兩個數據來源高度一致,均確認印尼已主導全球鎳供給\n\n---\n數據來源\n┌───────────────────────────────────────────┬──────┬────────┬──────────────────────┐\n│                   來源                    │ Tier │ 置信度 │         說明         │\n├───────────────────────────────────────────┼──────┼────────┼──────────────────────┤\n│ USGS Mineral Commodity Summaries (Nickel) │ 0    │ 0.95   │ 免費、穩定、口徑一致 │\n├───────────────────────────────────────────┼──────┼────────┼──────────────────────┤\n│ INSG World Nickel Statistics              │ 0    │ 0.90   │ 全球權威鎳業統計機構 │\n├───────────────────────────────────────────┼──────┼────────┼──────────────────────┤\n│ S&P Global Market Intelligence            │ 2    │ 0.90   │ 交叉驗證用(付費數據) │\n└───────────────────────────────────────────┴──────┴────────┴──────────────────────┘\n---\n口徑說明\n\n⚠️ 重要提醒:\n\n本分析使用 mined nickel content (礦場產量的鎳金屬含量) 口徑:\n- ✅ 鎳金屬含量 (metric tons Ni)\n- ❌ 非 ore wet tonnes (礦石濕噸)\n- ❌ 非 refined production (精煉產量)\n- ❌ 非 NPI product tonnes (NPI產品噸)\n\n單位轉換警示:\n- Ore wet tonnes → Ni content: 需考慮品位(~1.5%)和水分(~30%)\n- NPI product tonnes → Ni content: 需乘以 Ni% (約12-15%)\n- Matte tonnes → Ni content: 需乘以 Ni% (約75%)\n\n---\n結論與建議\n\n核心發現:\n1. 🎯 印尼已成為全球鎳供給的絕對主導者(57.9%市佔率)\n2. 📊 市場集中度極高(HHI = 3,779),遠超反壟斷警戒線\n3. ⚡ 集中度仍在持續上升中(2023: 54.1% → 2024: 57.9%)\n4. 🔴 單一國家政策變動可造成全球供給顯著衝擊\n\n風險提示:\n- 政策風險: RKAB配額、出口規則、環境法規變動\n- 地緣政治風險: 單一國家主導帶來的供給脆弱性\n- 基礎設施風險: 電力供應、物流瓶頸\n- ESG風險: 碳足跡、海洋排放爭議(歐盟CBAM)\n\n建議:\n1. 📡 密切監控印尼政策動態(RKAB配額、出口規則)\n2. 🔍 追蹤替代供給來源開發(菲律賓、澳洲、加拿大)\n3. 💼 考慮供給鏈多元化策略\n4. 📊 定期更新集中度指標監控\n\n所有圖表已保存在 output/ 目錄，檔名包含日期 20260116：\n┌─────┬─────────────────────┬───────────────────────────────────────────┬────────┐\n│  #  │        圖表         │                   檔名                    │  大小  │\n├─────┼─────────────────────┼───────────────────────────────────────────┼────────┤\n│ 1   │ 印尼市佔率與HHI趨勢 │ nickel_indonesia_share_trend_20260116.png │ 281 KB │\n├─────┼─────────────────────┼───────────────────────────────────────────┼────────┤\n│ 2   │ 國家份額餅圖        │ nickel_country_share_pie_20260116.png     │ 275 KB │\n├─────┼─────────────────────┼───────────────────────────────────────────┼────────┤\n│ 3   │ 集中度指標演進      │ nickel_concentration_metrics_20260116.png │ 206 KB │\n├─────┼─────────────────────┼───────────────────────────────────────────┼────────┤\n│ 4   │ 產量對比堆疊圖      │ nickel_production_volume_20260116.png     │ 182 KB │\n└─────┴─────────────────────┴───────────────────────────────────────────┴────────┘\n"
      },
      {
        "question": "如果印尼減產 20%，對全球供給會有什麼衝擊？",
        "imagePath": "images/nickel-scenario-2026-01-16.png",
        "expectedResult": "📊 印尼減產20%情境衝擊分析總結\n\n我為您生成了完整的情境報告和3張視覺化圖表。以下是關鍵發現：\n\n---\n🎯 三層情境分析結果\n┌──────────┬────────┬────────┬──────────┬──────────┬─────────────┐\n│   情境   │ 執行率 │ 減產量 │ 全球衝擊 │ 消費天數 │  風險等級   │\n├──────────┼────────┼────────┼──────────┼──────────┼─────────────┤\n│ 完全執行 │ 100%   │ 456 kt │ 12.1%    │ 44天     │ 🔴 極高風險 │\n├──────────┼────────┼────────┼──────────┼──────────┼─────────────┤\n│ 半成功   │ 50%    │ 228 kt │ 6.0%     │ 22天     │ 🟡 高風險   │\n├──────────┼────────┼────────┼──────────┼──────────┼─────────────┤\n│ 軟著陸   │ 25%    │ 114 kt │ 3.0%     │ 11天     │ 🟢 中等風險 │\n└──────────┴────────┴────────┴──────────┴──────────┴─────────────┘\n---\n🔴 最可能情境：半成功（50%執行）\n\n預期衝擊：\n- 減產量：228,000 噸鎳（相當於加拿大+澳洲總產量）\n- 全球供給缺口：6.0%\n- 相當於：22天全球消費量\n- 價格影響：預期LME鎳價上漲 20-40%\n\n為什麼是50%？\n1. 政治阻力：完全執行會嚴重衝擊印尼經濟\n2. 經濟考量：鎳產業是印尼重要外匯來源\n3. 歷史經驗：類似政策通常部分執行\n4. 豁免機制：大型園區可能獲得配額優待\n\n---\n⚠️ 關鍵警示：單位陷阱\n\n重要提醒：RKAB配額通常以「礦石濕噸」計算，非「鎳金屬含量」！\n\n實際風險可能更大：\n傳聞：2026年RKAB配額 250 Mt ore vs 2025年 379 Mt ore\n減少：-129 Mt ore (-34%)\n\n轉換為鎳金屬含量（假設1.5%品位）：\n實際減產 ≈ 1,350 kt Ni\n全球衝擊 ≈ 35.7% 🚨🚨🚨\n\n結論：若RKAB配額真的大幅削減，實際衝擊將是本分析的 3倍 以上！\n\n---\n📈 已生成的圖表\n\n位置：output/ 目錄\n\n1. ✅ 情境衝擊對比圖 (nickel_scenario_impact_20260116.png)\n  - 雙柱狀圖：減產量 vs 全球衝擊%\n  - 清晰展示三種情境的差異\n2. ✅ 敏感度分析圖 (nickel_scenario_sensitivity_20260116.png)\n  - 執行率 vs 全球衝擊曲線\n  - 標記關鍵閾值（40%進入高風險，80%進入極高風險）\n  - 風險區域著色\n3. ✅ 庫存時間線圖 (nickel_scenario_timeline_20260116.png)\n  - 示意不同情境下的庫存消耗速度\n  - 完全執行情境：13個月庫存耗盡\n\n---\n💡 核心發現\n\n1. 高槓桿效應：印尼單國20%減產 → 全球6-12%供給衝擊\n2. 缺乏緩衝：全球其他國家短期內無法補充這個缺口\n3. 價格敏感：供給衝擊將直接引發價格劇烈波動\n4. 連鎖反應：\n  - 下游產業（不銹鋼、電池）原料成本飆升\n  - 投機性囤貨加劇供給緊張\n  - 替代供給至少需要12-18個月才能釋放\n\n---\n🛡️ 對沖建議\n\n立即行動：\n1. 📡 建立印尼RKAB配額監控機制\n2. 📦 增加戰略庫存至3-6個月消費量\n3. 🤝 與菲律賓、加拿大、澳洲供應商簽訂框架協議\n\n金融對沖：\n4. 💰 LME鎳期貨買入套保\n5. 📈 期權組合策略（買入看漲期權）\n6. 🏦 鎖定長期供應合約價格\n\n供應鏈：\n7. 🔄 供應鏈多元化（降低對印尼依賴）\n8. ♻️ 提高回收鎳比例\n9. 🔬 研發低鎳/無鎳替代材料\n\n---\n📄 完整報告\n\n已生成詳細報告：\noutput/Indonesia_20pct_Cut_Scenario_Analysis_20260116.md        \n"
      },
      {
        "question": "驗證「印尼控制 60-70% 鎳供給」這個說法",
        "expectedResult": "驗證結果總結：「印尼控制 60-70% 鎳供給」\n\n---\n🎯 快速判定\n┌───────────────────────┬─────────┬──────────────────┐\n│         說法          │  判定   │     實際數值     │\n├───────────────────────┼─────────┼──────────────────┤\n│ \"印尼控制 60% 鎳供給\" │ ✅ 正確 │ 57.9% - 60.2%    │\n├───────────────────────┼─────────┼──────────────────┤\n│ \"印尼控制 70% 鎳供給\" │ ⚠️ 偏高 │ 高估約10個百分點 │\n└───────────────────────┴─────────┴──────────────────┘\n綜合判定: ⚠️ 部分正確 - \"60%\" 準確，\"70%\" 偏高\n\n---\n📊 交叉驗證結果\n\n數據來源對比：\n┌────────────┬────────────┬──────────┬──────────┬──────┬───────────┐\n│    來源    │ 2024市佔率 │ 印尼產量 │ 全球產量 │ Tier │  置信度   │\n├────────────┼────────────┼──────────┼──────────┼──────┼───────────┤\n│ USGS       │ 57.9%      │ 2,200 kt │ 3,800 kt │ 0    │ 0.90-0.95 │\n├────────────┼────────────┼──────────┼──────────┼──────┼───────────┤\n│ S&P Global │ 60.2%      │ 2,280 kt │ 3,787 kt │ 2    │ 0.90      │\n├────────────┼────────────┼──────────┼──────────┼──────┼───────────┤\n│ 平均值     │ ~59%       │ 2,240 kt │ 3,794 kt │ -    │ -         │\n└────────────┴────────────┴──────────┴──────────┴──────┴───────────┘\n結論：\n- ✅ 兩個獨立權威來源高度一致\n- ✅ 差異僅2.3個百分點（誤差範圍內）\n- ✅ 數據口徑統一：mined nickel content\n\n---\n⚠️ \"70%\" 說法可能來源\n\n可能產生誇大的3種情境：\n\n1️⃣ 混淆 NPI 產品\n\n- 印尼 NPI（鎳鐵）產量佔全球 70-80% ✅\n- 但 NPI ≠ 全部鎳供給（只是不鏽鋼用鎳）\n- 正確說法：\"印尼控制全球70-80%的NPI供給\"\n\n2️⃣ 混淆礦石噸數與鎳含量\n\n- RKAB配額新聞常用「礦石濕噸」\n- 數量級大70-100倍，易混淆\n- 陷阱：150 Mt ore ≠ 150 Mt Ni\n\n3️⃣ 混淆增量與存量\n\n- 2022-2024年新增產量中，印尼貢獻70%+\n- 陷阱：增量佔比 ≠ 總量佔比\n\n---\n📈 歷史趨勢證明\n\n印尼市佔率演進：\n\n2015:  5.1%  ▁\n2016:  6.7%  ▁\n2017: 13.1%  ▂\n2018: 20.8%  ▃\n2019: 25.9%  ▄\n2020: 31.1%  ▅  ← 礦石出口禁令\n2021: 37.2%  ▆\n2022: 50.5%  ▇  ← 首次突破50%\n2023: 54.1%  ▇\n2024: 57.9%  █  ← 接近60%\n\n關鍵發現：\n- 📊 10年增長 11.3倍\n- 🚀 2020年後加速增長\n- 📈 趨勢仍在上升中\n- 🎯 2025-2026可能突破65%\n\n---\n✅ 推薦正確表述\n\n最精確版本\n\n\"根據USGS和S&P Global數據，2024年印尼鎳產量（鎳金屬含量）佔全球 約60%（57.9%-60.2%），為全球最大單一供給國。\"\n\n簡潔版本\n\n\"印尼控制全球鎳供給的 約六成\"\n\n動態版本\n\n\"印尼市佔率從2020年的31%快速增長至2024年的 接近60%\"\n\n---\n❌ 避免使用\n\n- ❌ \"印尼壟斷了70%的全球鎳供給\"（高估）\n- ❌ \"印尼控制大部分鎳\"（不精確）\n- ❌ \"印尼控制60-70%\"（區間過寬）\n\n---\n🔍 數據口徑極其重要！\n\n同一個印尼，不同口徑差異巨大：\n┌──────────────────────┬────────────┬─────────────────────┐\n│         口徑         │ 印尼市佔率 │        說明         │\n├──────────────────────┼────────────┼─────────────────────┤\n│ Mined Ni content     │ ~60%       │ ✅ 標準口徑         │\n├──────────────────────┼────────────┼─────────────────────┤\n│ NPI product          │ ~70-80%    │ ⚠️ 只包含不鏽鋼用鎳 │\n├──────────────────────┼────────────┼─────────────────────┤\n│ Refined Ni (Class 1) │ ~15-20%    │ ⚠️ 低估印尼影響     │\n├──────────────────────┼────────────┼─────────────────────┤\n│ Ore wet tonnes       │ ~60%       │ ⚠️ 數量級放大70倍   │\n└──────────────────────┴────────────┴─────────────────────┘\n結論：必須明確說明是 \"mined nickel content\" 口徑！\n\n---\n📌 關鍵要點\n\n1. 60% 正確 ✅\n  - 與USGS（57.9%）和S&P（60.2%）數據吻合\n  - 口徑：mined nickel content\n2. 70% 偏高 ⚠️\n  - 高估約10個百分點\n  - 可能來自NPI產品口徑或未來預測\n3. 趨勢上升 📈\n  - 2024年已達60%\n  - 可能在2026-2027年接近65%\n  - 長期可能達到70%（但目前未達）\n4. 極端風險 🔴\n  - 60%已屬極高集中度\n  - 遠超反壟斷警戒線（40%）\n  - 單一國家政策可撬動全球供給\n\n---\n📄 完整驗證報告\n\n已生成詳細報告：\noutput/Indonesia_Market_Share_Validation_20260116.md\n\n內容包括：\n- ✅ 多來源交叉驗證\n- ✅ 歷史趨勢分析\n- ✅ 口徑陷阱檢查\n- ✅ 推薦/避免表述\n- ✅ 驗證方法論\n\n---\n最終結論：市場常說的 \"印尼控制60-70%鎳供給\" 中，\"60%\"是準確的，\"70%\"則是高估。正確表述應該是：\"印尼控制約60%的全球鎳供給（mined nickel content）\"。✅\n"
      }
    ],
    "qualityScore": {
      "overall": 70,
      "badge": "白銀",
      "metrics": {
        "architecture": 80,
        "maintainability": 75,
        "content": 85,
        "community": 20,
        "security": 80,
        "compliance": 75
      },
      "details": "**架構（80/100）**\n- Router pattern 正確分離職責\n- 多層數據來源設計完善\n\n**可維護性（75/100）**\n- 單位轉換邏輯需長期維護\n- 資料來源可能變動\n\n**內容（85/100）**\n- 完整的集中度指標定義\n- 清晰的數據口徑說明\n\n**社群（20/100）**\n- 新建技能，尚無社群回饋\n\n**安全（80/100）**\n- 無敏感資料處理\n- 外部 URL 需適當處理\n\n**合規（75/100）**\n- 需注意付費數據源授權\n"
    },
    "bestPractices": [
      {
        "title": "口徑先行",
        "description": "分析前務必先確認數據口徑（mined/refined/nickel content），避免將 ore wet tonnes 與鎳金屬含量混淆"
      },
      {
        "title": "數據分層",
        "description": "優先使用 Tier 0 免費數據源（USGS/INSG）建立 baseline，付費數據用於精度驗證"
      },
      {
        "title": "情境分析三層",
        "description": "政策情境分析輸出 Hard cut / Half success / Soft landing 三層，避免過度樂觀或悲觀"
      }
    ],
    "pitfalls": [
      {
        "title": "單位混淆",
        "description": "ore wet tonnes（濕噸）與 nickel content（鎳含量）混用",
        "consequence": "可能導致 10x 以上的數量級錯誤"
      },
      {
        "title": "口徑不一致",
        "description": "mined production 與 refined production 混合比較",
        "consequence": "集中度計算完全失真"
      },
      {
        "title": "過度依賴單一來源",
        "description": "只看 S&P 或只看社群貼文數字",
        "consequence": "無法驗證數據可靠度"
      }
    ],
    "faq": [
      {
        "question": "為什麼印尼市佔有 60% 和 70% 兩種說法？",
        "answer": "這通常是口徑差異：\n- 60.2%（S&P Global）: mined nickel content\n- 更高數字可能來自 ore production（濕噸）\n- 本 Skill 會強制標註口徑來源\n"
      },
      {
        "question": "如何確認數據可靠度？",
        "answer": "使用 validate-sources workflow：\n1. 交叉比對 USGS + INSG + S&P\n2. 檢查時間口徑（同一年度）\n3. 檢查單位口徑（同為 Ni content）\n4. 輸出 confidence score\n"
      },
      {
        "question": "mine-level 數據從哪裡取得？",
        "answer": "Tier 1 來源（免費但分散）：\n- Weda Bay Nickel 官網\n- Nickel Industries 年報\n- PT Vale Indonesia 財報\n- Eramet 股東報告\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 設計背景\n\n此技能源於對「印尼控制全球 60-70% 鎳供給」這類說法的驗證需求。\n市場上充斥著各種數字，但很少有人驗證口徑是否一致。\n\n## 關鍵洞察\n\n1. **口徑決定一切**: ore wet tonnes vs nickel content 可差 10x\n2. **政策不需完美執行**: 半成功也可能造成重大衝擊\n3. **集中度有上限**: HHI 和 CR5 的理論意義與實務解讀\n"
    },
    "methodology": "### 1. 供給集中度（Concentration）= 控制力的上限\r\n當某國家佔全球供給 **X%**，任何「對該國供給的變化」都能近似映射到全球供給衝擊：\r\n\r\n- **全球供給衝擊比例 ≈ X% × 該國供給變動比例**\r\n\r\n換句話說，若印尼佔全球鎳供給約 **60%**，印尼國內供給只要變動 **10%**，全球供給理論衝擊就可能達到 **~6%**（同口徑下）。\r\n\r\n> 這是「供給槓桿」的第一層：**國家份額越大，政策/供應變動的全球傳導越直接**。\r\n\r\n### 2. 「少數資產」可控性（Top mines / Industrial parks）= 槓桿的開關\r\n即使一國份額很高，真正能快速施力的常常不是「全國每個礦」，而是：\r\n\r\n- 產量極大、集中於少數礦山/園區\r\n- 許可與配額制度能鎖住上游（礦）或下游（冶煉/轉化）的擴張\r\n- 物流、環評、用電、港口等基礎設施形成瓶頸\r\n\r\n因此，分析上要做第二層拆解：\r\n\r\n- **Top N mines / Top N industrial parks 佔全球供給多少？**\r\n- 如果只「拴緊」這些關鍵節點，就可能快速造成可觀的供給缺口\r\n\r\n> 這是「供給槓桿」的第二層：**槓桿不只來自份額，也來自供給是否集中在少數可被管理的節點**。\r\n\r\n### 3. 市場定價（Consensus / Positioning）= 非對稱的來源\r\n供給槓桿不一定立刻導致行情，真正會引爆「非對稱」的是：\r\n\r\n- 市場長期看空、共識極度悲觀\r\n- 價格把「最壞情境」當成常態\r\n- 此時只要供給端出現「比預期少一點的利空」或「半成功的減產」，就可能造成**向上急拉**（short covering + re-pricing）\r\n\r\n> 這是「供給槓桿」的第三層：**供給衝擊 × 市場已定價程度 = 非對稱走勢的觸發條件**。\r\n\r\n用同一套工具，你也可以把它平移到其他商品（如鈀金、油、鋰、銅）去比較「誰才是真的單點槓桿」。",
    "downloadUrl": "downloads/nickel-concentration-risk-analyzer-0.1.1.zip"
  },
  {
    "id": "google-trends-ath-detector",
    "name": "google-trends-ath-detector",
    "displayName": "解讀 Google Trends 歷史新高",
    "description": "模擬真人操作瀏覽器抓取 Google Trends 數據，自動判定搜尋趨勢是否創下歷史新高（ATH）或出現異常飆升，並提供訊號分類。",
    "emoji": "📈",
    "version": "0.1.1",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "Google Trends",
      "ATH",
      "歷史新高",
      "情緒指標",
      "異常偵測",
      "搜尋趨勢",
      "訊號分型",
      "Selenium",
      "爬蟲"
    ],
    "category": "indicator-monitoring",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": false,
    "installCount": 0,
    "content": "<essential_principles>\r\n**Google Trends ATH Detector 核心原則**\r\n\r\n**1. 模擬真人瀏覽器行為抓取 Google Trends**\r\n\r\n本技能使用 Selenium 模擬真人瀏覽器：\r\n- 移除 `navigator.webdriver` 自動化標記\r\n- 隨機輪換 User-Agent（Chrome/Firefox/Safari）\r\n- 請求間隨機延遲（0.5-2 秒）\r\n- 先訪問首頁建立 session，再抓取數據\r\n\r\n**2. 訊號分型（Signal Typing）**\r\n\r\n搜尋趨勢飆升分為三種類型：\r\n\r\n| 類型               | 特徵                 | 解讀                         |\r\n|--------------------|----------------------|------------------------------|\r\n| Seasonal spike     | 每年固定月份重複     | 制度性週期（投保季、報稅季） |\r\n| Event-driven shock | 短期尖峰、z-score 高 | 新聞/政策/突發事件           |\r\n| Regime shift       | 趨勢線上移、持續高位 | 結構性關注上升               |\r\n\r\n**3. 分析公式**\r\n\r\n```\r\nATH 判定：latest_value >= max(history) * 0.98\r\n異常判定：zscore >= threshold (default: 2.5)\r\n訊號分型：based on (is_ath, is_anomaly, trend_direction)\r\n```\r\n\r\n**4. 描述性分析優先**\r\n\r\n本技能提供**客觀的數學分析結果**：\r\n- 輸出訊號類型、異常分數等量化指標\r\n- 提取 related queries 作為驅動因素參考\r\n- 由用戶根據專業知識自行解讀\r\n</essential_principles>\r\n\r\n<intake>\r\n**您想要執行什麼操作？**\r\n\r\n1. **Detect** - 快速偵測是否創下 ATH 或出現異常\r\n2. **Analyze** - 深度分析訊號類型與驅動因素\r\n3. **Compare** - 比較多個主題的趨勢共振\r\n\r\n**等待回應後再繼續。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                                  | Workflow             | Description         |\r\n|-------------------------------------------|----------------------|---------------------|\r\n| 1, \"detect\", \"ath\", \"check\", \"是否創新高\" | workflows/detect.md  | 快速偵測 ATH 與異常 |\r\n| 2, \"analyze\", \"deep\", \"分析\", \"訊號\"      | workflows/analyze.md | 深度分析與訊號分型  |\r\n| 3, \"compare\", \"對照\", \"共振\"              | workflows/compare.md | 多主題趨勢比較      |\r\n\r\n**讀取工作流程後，請完全遵循其步驟。**\r\n</routing>\r\n\r\n<reference_index>\r\n**參考文件** (`references/`)\r\n\r\n| 文件                 | 內容                                       |\r\n|----------------------|--------------------------------------------|\r\n| input-schema.md      | 完整輸入參數定義與預設值                   |\r\n| data-sources.md      | Google Trends 數據來源與 Selenium 爬取指南 |\r\n| signal-types.md      | 訊號分型定義與判定邏輯                     |\r\n| seasonality-guide.md | 季節性分解方法與解讀                       |\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow   | Purpose                      |\r\n|------------|------------------------------|\r\n| detect.md  | 快速偵測 ATH 與異常分數      |\r\n| analyze.md | 深度分析、訊號分型、驅動詞彙 |\r\n| compare.md | 多主題趨勢共振分析           |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose              |\r\n|--------------------|----------------------|\r\n| output-schema.yaml | 標準輸出 JSON schema |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script           | Purpose                           |\r\n|------------------|-----------------------------------|\r\n| trend_fetcher.py | 核心爬蟲與分析邏輯（Selenium 版） |\r\n</scripts_index>\r\n\r\n<examples_index>\r\n**範例輸出** (`examples/`)\r\n\r\n| 文件                        | 內容                          |\r\n|-----------------------------|-------------------------------|\r\n| health_insurance_ath.json   | Health Insurance ATH 偵測範例 |\r\n| seasonal_vs_anomaly.json    | 季節性 vs 異常判定範例        |\r\n| multi_topic_comparison.json | 多主題比較範例                |\r\n</examples_index>\r\n\r\n<quick_start>\r\n**快速開始：安裝依賴**\r\n\r\n```bash\r\npip install selenium webdriver-manager beautifulsoup4 lxml loguru\r\n```\r\n\r\n**Python API：**\r\n\r\n```python\r\nfrom scripts.trend_fetcher import fetch_trends, analyze_ath\r\n\r\n# 抓取數據（使用 Selenium 模擬瀏覽器）\r\ndata = fetch_trends(\r\n    topic=\"Health Insurance\",\r\n    geo=\"US\",\r\n    timeframe=\"2004-01-01 2025-12-31\"\r\n)\r\n\r\n# ATH 分析\r\nresult = analyze_ath(data, threshold=2.5)\r\n\r\nprint(f\"Is ATH: {result['analysis']['is_all_time_high']}\")\r\nprint(f\"Signal Type: {result['analysis']['signal_type']}\")\r\nprint(f\"Z-Score: {result['analysis']['zscore']}\")\r\n```\r\n\r\n**CLI 快速開始：**\r\n\r\n```bash\r\n# 基本分析\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --geo US \\\r\n  --output ./output/health_insurance.json\r\n\r\n# 比較多個主題\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --compare \"Unemployment,Inflation\" \\\r\n  --geo US \\\r\n  --output ./output/comparison.json\r\n\r\n# 跳過 related queries（更快、更少請求）\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --no-related \\\r\n  --output ./output/health_insurance.json\r\n\r\n# Debug 模式（顯示瀏覽器、保存 HTML）\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --debug \\\r\n  --no-headless\r\n\r\n# 登入模式（預設等待 120 秒供 2FA 驗證）\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --output ./output/health_insurance.json\r\n\r\n# 跳過登入等待（不需要登入時）\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --login-wait 0 \\\r\n  --output ./output/health_insurance.json\r\n\r\n# 從已下載的 CSV 檔案分析（跳過瀏覽器抓取）\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --csv ./downloads/multiTimeline.csv \\\r\n  --output ./output/health_insurance.json\r\n\r\n# 自動從 Downloads 目錄找最新 CSV\r\npython scripts/trend_fetcher.py \\\r\n  --topic \"Health Insurance\" \\\r\n  --csv auto \\\r\n  --output ./output/health_insurance.json\r\n```\r\n\r\n**CLI 參數說明：**\r\n\r\n| 參數            | 說明                           | 預設值                |\r\n|-----------------|--------------------------------|-----------------------|\r\n| `--topic`       | 搜尋主題（必要）               | -                     |\r\n| `--geo`         | 地區代碼                       | US                    |\r\n| `--timeframe`   | 時間範圍                       | 2004-01-01 2025-12-31 |\r\n| `--threshold`   | 異常 z-score 門檻              | 2.5                   |\r\n| `--compare`     | 比較主題（逗號分隔）           | -                     |\r\n| `--no-related`  | 跳過 related queries           | false                 |\r\n| `--no-headless` | 顯示瀏覽器視窗                 | false                 |\r\n| `--login`       | 強制啟用登入模式               | false                 |\r\n| `--login-wait`  | 登入等待秒數（0=互動式 Enter） | 120                   |\r\n| `--csv`         | CSV 檔案路徑或 'auto' 自動尋找 | -                     |\r\n| `--debug`       | 啟用調試模式                   | false                 |\r\n| `--output`      | 輸出 JSON 檔案路徑             | -                     |\r\n</quick_start>\r\n\r\n<success_criteria>\r\nSkill 成功執行時：\r\n- [ ] Selenium 成功啟動並模擬瀏覽器\r\n- [ ] 正確抓取 Google Trends 時間序列\r\n- [ ] 判定 ATH 狀態與異常分數\r\n- [ ] 識別訊號類型（seasonal/event/regime）\r\n- [ ] 提取 related queries 驅動詞彙（若啟用）\r\n- [ ] 輸出結構化 JSON 結果\r\n</success_criteria>\r\n\r\n<anti_detection_strategy>\r\n**防偵測策略摘要**\r\n\r\n本技能實現以下防偵測措施（基於 design-human-like-crawler.md）：\r\n\r\n| 策略                       | 效果               | 優先級  |\r\n|----------------------------|--------------------|---------|\r\n| 移除 `navigator.webdriver` | 核心，防止 JS 偵測 | 🔴 必要 |\r\n| 隨機 User-Agent            | 避免固定 UA 被識別 | 🔴 必要 |\r\n| 請求前隨機延遲             | 模擬人類行為       | 🔴 必要 |\r\n| 禁用自動化擴展             | 移除 Chrome 痕跡   | 🟡 建議 |\r\n| 先訪問首頁再 API           | 建立正常 session   | 🟡 建議 |\r\n\r\n**Chrome 選項配置：**\r\n\r\n```python\r\nchrome_options.add_argument('--disable-blink-features=AutomationControlled')\r\nchrome_options.add_experimental_option('excludeSwitches', ['enable-automation'])\r\nchrome_options.add_experimental_option('useAutomationExtension', False)\r\n```\r\n</anti_detection_strategy>",
    "path": "skills/google-trends-ath-detector/SKILL.md",
    "directoryStructure": "google-trends-ath-detector/\n├── examples\n│   ├── health_insurance_ath.json\n│   ├── multi_topic_comparison.json\n│   └── seasonal_vs_anomaly.json\n├── manifest.json\n├── references\n│   ├── data-sources.md\n│   ├── input-schema.md\n│   ├── seasonality-guide.md\n│   └── signal-types.md\n├── scripts\n│   └── trend_fetcher.py\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   └── output-schema.yaml\n└── workflows\n    ├── analyze.md\n    ├── compare.md\n    └── detect.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "分析 \"Health Insurance\" 在美國的搜尋趨勢是否創下歷史新高",
        "expectedResult": "此偵測器會：\n1. 使用 Selenium 模擬真人瀏覽器抓取 Google Trends 數據\n2. 抓取 2004-至今的時間序列\n3. 計算 z-score 異常分數\n4. 判定是否為 ATH\n5. 識別訊號類型 (seasonal_spike/event_driven_shock/regime_shift)\n6. 提取 related queries 作為驅動因素參考\n"
      },
      {
        "question": "比較 \"Unemployment\" 和 \"Health Insurance\" 的趨勢共振",
        "expectedResult": "分析兩個主題的相關性，判斷是「單點焦慮」還是「系統性焦慮」，\n並透過相關性分析輸出解讀。\n"
      }
    ],
    "qualityScore": {
      "overall": 85,
      "badge": "黃金",
      "metrics": {
        "architecture": 90,
        "maintainability": 85,
        "content": 90,
        "community": 30,
        "security": 95,
        "compliance": 90
      },
      "details": "**架構（90/100）**\n- Selenium 模擬真人瀏覽器行為\n- 多層防偵測策略（User-Agent 輪換、隨機延遲）\n- 清晰的訊號分型流程\n- 完整的爬蟲核心類設計\n\n**可維護性（85/100）**\n- 工作流程分離清晰\n- 參數定義完整\n- 專注單一數據源\n- 模組化爬蟲設計\n\n**內容（90/100）**\n- 完整的訊號分析框架\n- 詳細的參考文件\n- 實用的 CLI 工具\n\n**社區（30/100）**\n- 新技能，尚無社區貢獻\n\n**安全（95/100）**\n- 僅讀取公開 Google Trends 數據\n- 模擬正常瀏覽器行為\n\n**規範符合性（90/100）**\n- 遵循 Claude Code 規範\n- 完整的文件結構\n- 基於 design-human-like-crawler.md 設計\n"
    },
    "bestPractices": [
      {
        "title": "使用 Topic Entity 而非純關鍵字",
        "description": "Topic Entity 可避免同名歧義（如 \"Apple\" 公司 vs 水果）"
      },
      {
        "title": "關注去季節化後的殘差",
        "description": "單看絕對值可能被季節性誤導，殘差才是真正的「異常」"
      },
      {
        "title": "結合 related queries 識別驅動",
        "description": "Rising queries 能揭示「為什麼」搜尋量上升"
      },
      {
        "title": "不要只看是否 ATH",
        "description": "重要的是「是否異常」而非「是否最高」"
      },
      {
        "title": "區分訊號類型再做解讀",
        "description": "季節性尖峰、事件衝擊、結構轉變需要不同的解讀方式"
      },
      {
        "title": "適當控制請求頻率",
        "description": "使用隨機延遲避免被 Google 偵測為機器人"
      }
    ],
    "pitfalls": [
      {
        "title": "忽略季節性",
        "description": "很多搜尋有固定的年度週期（報稅季、投保季）",
        "consequence": "把正常季節性尖峰誤判為異常"
      },
      {
        "title": "過度解讀 Google Trends 指數",
        "description": "0-100 是相對指數，不是絕對搜尋量",
        "consequence": "錯誤比較不同主題或不同時間範圍"
      },
      {
        "title": "忽略數據延遲",
        "description": "Google Trends 有 2-3 天的數據延遲",
        "consequence": "誤以為「今天」的數據已更新"
      },
      {
        "title": "單一關鍵字偏差",
        "description": "只看一個關鍵字可能錯過更廣泛的趨勢",
        "consequence": "錯誤歸因（單點焦慮 vs 系統性焦慮）"
      },
      {
        "title": "請求過於頻繁",
        "description": "短時間內大量請求會被 Google 封鎖",
        "consequence": "返回 429 錯誤或被要求驗證碼"
      }
    ],
    "faq": [
      {
        "question": "Google Trends 的 0-100 指數代表什麼？",
        "answer": "這是相對指數，100 表示該時間範圍內的最高點。\n不同時間範圍或不同主題的 100 不能直接比較。\n"
      },
      {
        "question": "如何區分季節性尖峰和真正的異常？",
        "answer": "本技能透過訊號分型來區分：\n- seasonal_spike：每年重複的週期性高點\n- event_driven_shock：短期異常飆升\n- regime_shift：長期結構性上升\n"
      },
      {
        "question": "為什麼使用 Selenium 而非 requests/pytrends？",
        "answer": "本技能的 trend_fetcher.py 使用 Selenium 模擬真人瀏覽器行為：\n- **防偵測**：移除自動化標記、輪換 User-Agent、隨機延遲\n- **執行 JavaScript**：確保動態內容正確載入\n- **穩定性**：避免被 Google 封鎖\n- **維護 Session**：自動處理 cookies 和 tokens\n"
      },
      {
        "question": "被 Google 封鎖怎麼辦？",
        "answer": "如果遇到 429 錯誤或驗證碼：\n1. 等待 24 小時後重試\n2. 增加請求間隔（使用 --no-related 減少請求）\n3. 使用 VPN 更換 IP\n4. 降低爬取頻率\n"
      },
      {
        "question": "如何調試抓取問題？",
        "answer": "使用 debug 模式：\n```bash\npython scripts/trend_fetcher.py --topic \"test\" --debug --no-headless\n```\n這會：\n- 顯示瀏覽器視窗（非 headless）\n- 保存 debug_page.html 供檢查\n- 輸出詳細日誌到 trend_fetcher.log\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 數據來源\n\n**專注於 Google Trends**\n- 官網：https://trends.google.com\n- 數據範圍：2004 年至今\n- 更新頻率：接近即時（2-3 天延遲）\n\n## 技術架構\n\n基於 [design-human-like-crawler.md](thoughts/shared/guide/design-human-like-crawler.md) 設計：\n- Selenium + Chrome headless 模擬真人瀏覽器\n- BeautifulSoup 解析 HTML\n- 多層防偵測策略\n"
    },
    "downloadUrl": "downloads/google-trends-ath-detector-0.1.1.zip"
  },
  {
    "id": "wasde-ingestor",
    "name": "wasde-ingestor",
    "displayName": "下載與解析 WASDE 每月報告",
    "description": "抓取並解析 USDA（美國農業部）每月發布的 WASDE（世界農產品供需估計）報告，擷取所有主要商品（穀物、油籽、棉花、畜產品、糖）的供需平衡表。產出經標準化、具版本控管的資料集，作為即時預測的基準錨點。",
    "emoji": "🌾",
    "version": "0.2.0",
    "license": "MIT",
    "author": "macro-skills",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [],
    "category": "nowcasting",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": false,
    "installCount": 0,
    "content": "<essential_principles>\r\n**WASDE Ingestor 核心原則**\r\n\r\n**1. 商品範圍**\r\n\r\nWASDE 涵蓋三大類商品，每類有不同的表格結構與單位：\r\n\r\n| 類別      | 商品                                     | US 單位                   | World 單位           |\r\n|-----------|------------------------------------------|---------------------------|----------------------|\r\n| Grains    | Wheat, Corn, Rice, Barley, Sorghum, Oats | million bushels / cwt     | million metric tons  |\r\n| Oilseeds  | Soybeans, Soybean Oil, Soybean Meal      | million bushels / pounds  | million metric tons  |\r\n| Cotton    | Upland, Pima                             | million 480-lb bales      | million 480-lb bales |\r\n| Livestock | Beef, Pork, Poultry, Eggs, Dairy         | million lbs / dozen / lbs | - (US only)          |\r\n| Sugar     | Sugar                                    | 1,000 short tons          | - (US + Mexico only) |\r\n\r\n**2. 表格結構一致性**\r\n\r\n所有供需表遵循相同的平衡公式：\r\n```\r\nEnding Stocks = Beginning Stocks + Production + Imports - Total Use - Exports\r\n```\r\n\r\n**3. 版本控制**\r\n\r\n- 每月報告可能修正前期數據\r\n- 使用 `content_hash` 追蹤數據變化\r\n- 保留 `revision_flag` 標記修正值\r\n\r\n**4. 解析優先級**\r\n\r\n1. PDF 結構化解析（優先）\r\n2. HTML 表格解析（fallback）\r\n3. TXT 固定寬度解析（legacy）\r\n</essential_principles>\r\n\r\n<intake>\r\n**您想要執行什麼操作？**\r\n\r\n1. **Ingest** - 抓取並解析最新或指定月份的 WASDE 報告\r\n2. **Backfill** - 批量回補歷史 WASDE 數據\r\n3. **Validate** - 驗證現有數據與最新報告的一致性\r\n4. **Configure** - 配置商品範圍、輸出路徑等參數\r\n\r\n**等待回應後再繼續。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                                | Workflow               | Description         |\r\n|-----------------------------------------|------------------------|---------------------|\r\n| 1, \"ingest\", \"fetch\", \"parse\", \"latest\" | workflows/ingest.md    | 抓取解析 WASDE 報告 |\r\n| 2, \"backfill\", \"historical\", \"batch\"    | workflows/backfill.md  | 批量回補歷史數據    |\r\n| 3, \"validate\", \"check\", \"verify\"        | workflows/validate.md  | 驗證數據一致性      |\r\n| 4, \"configure\", \"config\", \"setup\"       | workflows/configure.md | 配置參數            |\r\n\r\n**讀取工作流程後，請完全遵循其步驟。**\r\n</routing>\r\n\r\n<reference_index>\r\n**商品參考文件** (`references/`)\r\n\r\n| 文件                    | 內容                                               |\r\n|-------------------------|----------------------------------------------------|\r\n| commodities-overview.md | 所有商品總覽與單位對照                             |\r\n| grains.md               | 穀物類（Wheat, Corn, Rice, Barley, Sorghum, Oats） |\r\n| oilseeds.md             | 油籽類（Soybeans, Soybean Oil, Soybean Meal）      |\r\n| cotton.md               | 棉花（US & World）                                 |\r\n| livestock.md            | 畜產品（Beef, Pork, Poultry, Eggs, Dairy）         |\r\n| sugar.md                | 糖（US & Mexico）                                  |\r\n| validation-rules.md     | 驗證規則與合理性檢查                               |\r\n| failure-modes.md        | 失敗模式與緩解策略                                 |\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow     | Purpose                       |\r\n|--------------|-------------------------------|\r\n| ingest.md    | 抓取解析單一或多個 WASDE 報告 |\r\n| backfill.md  | 批量回補歷史數據              |\r\n| validate.md  | 驗證數據一致性與修正追蹤      |\r\n| configure.md | 配置商品範圍與輸出設定        |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template                  | Purpose             |\r\n|---------------------------|---------------------|\r\n| config.yaml               | 標準配置文件模板    |\r\n| us-balance-schema.yaml    | US 供需表 schema    |\r\n| world-balance-schema.yaml | World 供需表 schema |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script               | Purpose                   |\r\n|----------------------|---------------------------|\r\n| discover_releases.py | 發現 WASDE 發布日期與 URL |\r\n| fetch_report.py      | 下載 PDF/HTML 報告        |\r\n| parse_tables.py      | 解析表格提取數據          |\r\n| validate_data.py     | 執行驗證檢查              |\r\n</scripts_index>\r\n\r\n<examples_index>\r\n**範例輸出** (`examples/`)\r\n\r\n| 文件                       | 內容                   |\r\n|----------------------------|------------------------|\r\n| corn_us_balance.json       | 美國玉米供需平衡表範例 |\r\n| wheat_world_balance.json   | 世界小麥供需平衡表範例 |\r\n| ingest_status_success.json | 成功執行的狀態報告範例 |\r\n| backfill_result.json       | 批量回補作業結果範例   |\r\n</examples_index>\r\n\r\n<quick_start>\r\n**CLI 快速開始：**\r\n\r\n```bash\r\n# 抓取最新報告的所有商品\r\nmacro-skills wasde ingest --commodities=all --out=./data\r\n\r\n# 只抓取穀物類\r\nmacro-skills wasde ingest --commodities=grains --out=./data\r\n\r\n# 回補過去 24 個月的大豆數據\r\nmacro-skills wasde backfill --commodity=soybeans --months=24 --out=./data\r\n\r\n# 驗證現有數據\r\nmacro-skills wasde validate --data-dir=./data\r\n```\r\n\r\n**Library 快速開始：**\r\n\r\n```python\r\nfrom macro_skills.wasde import WASDEIngestor\r\n\r\ningestor = WASDEIngestor(\r\n    commodities=[\"wheat\", \"corn\", \"soybeans\"],\r\n    scope=[\"us\", \"world\"],\r\n    output_dir=\"./data/wasde\"\r\n)\r\n\r\nresult = ingestor.ingest_latest()\r\nprint(result.status)\r\n```\r\n</quick_start>\r\n\r\n<success_criteria>\r\nSkill 成功執行時：\r\n- [ ] 正確識別商品類別與對應表格\r\n- [ ] 解析所有指定商品的供需數據\r\n- [ ] 單位正確轉換與標記\r\n- [ ] 通過平衡公式驗證\r\n- [ ] 輸出標準化 parquet 數據集\r\n- [ ] 生成 ingest_status 報告\r\n</success_criteria>\r\n\r\n<detailed_usage_examples>\r\n**詳細使用範例**\r\n\r\n**範例 1：抓取最新玉米與大豆數據**\r\n```\r\nUser: 幫我抓取最新 WASDE 的玉米和大豆供需數據\r\n\r\nAssistant 執行步驟:\r\n1. 讀取 workflows/ingest.md\r\n2. 呼叫 discover_releases.py 找到最新發布 (2025-01-10)\r\n3. 下載 PDF 報告\r\n4. 解析 corn_us, corn_world, soybeans_us, soybeans_world 表格\r\n5. 驗證平衡公式\r\n6. 輸出 parquet 檔案\r\n7. 回報 ingest_status\r\n\r\n預期輸出:\r\n- ./data/wasde/curated/corn_us_balance.parquet\r\n- ./data/wasde/curated/corn_world_balance.parquet\r\n- ./data/wasde/curated/soybeans_us_balance.parquet\r\n- ./data/wasde/curated/soybeans_world_balance.parquet\r\n```\r\n\r\n**範例 2：回補歷史小麥數據並追蹤修正**\r\n```\r\nUser: 回補過去 12 個月的小麥數據，我想追蹤 USDA 的修正歷程\r\n\r\nAssistant 執行步驟:\r\n1. 讀取 workflows/backfill.md\r\n2. 確定日期範圍 (2024-01 至 2024-12)\r\n3. 依序處理 12 期報告\r\n4. 比對每期數據，標記修正值\r\n5. 輸出包含 revision_flag 的完整歷史數據\r\n\r\n預期輸出:\r\n- 12 期小麥數據\r\n- 修正追蹤報告\r\n```\r\n\r\n**範例 3：驗證現有數據一致性**\r\n```\r\nUser: 檢查我現有的 WASDE 數據是否與最新報告一致\r\n\r\nAssistant 執行步驟:\r\n1. 讀取 workflows/validate.md\r\n2. 載入現有 parquet 檔案\r\n3. 抓取最新報告\r\n4. 逐欄位比對\r\n5. 標記差異與修正\r\n6. 輸出驗證報告\r\n\r\n預期輸出:\r\n- validation_report.json (差異列表)\r\n- 修正建議\r\n```\r\n</detailed_usage_examples>\r\n\r\n<data_pipeline_architecture>\r\n**數據流水線架構**\r\n\r\n```\r\n[USDA WASDE Website]\r\n         |\r\n         v\r\n+-------------------+\r\n| discover_releases |  --> 找到 PDF URL 與發布日期\r\n+-------------------+\r\n         |\r\n         v\r\n+-------------------+\r\n|   fetch_report    |  --> 下載 PDF (fallback: HTML)\r\n+-------------------+\r\n         |\r\n         v\r\n+-------------------+\r\n|   parse_tables    |  --> 提取供需表格數據\r\n+-------------------+\r\n         |\r\n         v\r\n+-------------------+\r\n|   normalize_data  |  --> 標準化欄位與單位\r\n+-------------------+\r\n         |\r\n         v\r\n+-------------------+\r\n|   validate_data   |  --> 平衡公式與範圍檢查\r\n+-------------------+\r\n         |\r\n         v\r\n+-------------------+\r\n|   write_output    |  --> Parquet / JSON\r\n+-------------------+\r\n         |\r\n         v\r\n[Curated Dataset]\r\n```\r\n\r\n**目錄結構：**\r\n```\r\ndata/wasde/\r\n├── raw/                    # 原始 PDF 檔案\r\n│   └── 2025-01-10/\r\n│       └── wasde0125.pdf\r\n├── intermediate/           # 中間解析結果\r\n│   └── 2025-01-10/\r\n│       ├── tables.json\r\n│       └── ingest_status.json\r\n└── curated/                # 最終標準化數據\r\n    ├── corn_us_balance.parquet\r\n    ├── corn_world_balance.parquet\r\n    ├── wheat_us_balance.parquet\r\n    └── ...\r\n```\r\n</data_pipeline_architecture>",
    "path": "skills/wasde-ingestor/SKILL.md",
    "directoryStructure": "wasde-ingestor/\n├── examples\n│   ├── backfill_result.json\n│   ├── corn_us_balance.json\n│   ├── ingest_status_success.json\n│   └── wheat_world_balance.json\n├── manifest.json\n├── references\n│   ├── commodities-overview.md\n│   ├── cotton.md\n│   ├── failure-modes.md\n│   ├── grains.md\n│   ├── livestock.md\n│   ├── oilseeds.md\n│   ├── sugar.md\n│   └── validation-rules.md\n├── scripts\n│   ├── discover_releases.py\n│   ├── fetch_report.py\n│   ├── parse_tables.py\n│   └── validate_data.py\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── config.yaml\n│   ├── us-balance-schema.yaml\n│   └── world-balance-schema.yaml\n└── workflows\n    ├── backfill.md\n    ├── configure.md\n    ├── ingest.md\n    └── validate.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "匯入最新一期 WASDE 報告中的所有穀物資料（小麥、玉米、稻米）",
        "expectedResult": "此匯入器會：\n1. 找出最新一期 WASDE 發布版本\n2. 下載 PDF 並解析穀物相關表格\n3. 擷取美國與全球的小麥、玉米、稻米供需平衡表\n4. 輸出標準化的 Parquet 資料集\n"
      },
      {
        "question": "回補過去 36 個月的 WASDE 玉米資料",
        "expectedResult": "此匯入器會處理 36 期每月發布版本，擷取玉米供需平衡表，\n並維持一致的 schema、內容雜湊（content hashes）與資料驗證檢查。\n"
      },
      {
        "question": "將既有 WASDE 資料與最新報告進行比對驗證",
        "expectedResult": "驗證器會將已儲存的資料與最新解析結果比對，標記任何修訂，\n並回報 schema 漂移或資料更正。\n"
      }
    ],
    "qualityScore": {
      "overall": 70,
      "badge": "白銀",
      "metrics": {
        "architecture": 80,
        "maintainability": 85,
        "content": 95,
        "community": 30,
        "security": 100,
        "compliance": 70
      },
      "details": "**架構（80/100）**\n- ✅ 模組化 router pattern 設計\n- ✅ 完整涵蓋所有 WASDE 商品類別\n- ⚠️ Alpha 階段，需更多實際使用驗證\n\n**可維護性（85/100）**\n- ✅ 清晰的工作流程分離\n- ✅ 商品參考文件獨立維護\n\n**內容（95/100）**\n- ✅ 涵蓋所有 WASDE 商品\n- ✅ 詳細的欄位映射與驗證規則\n\n**社區（30/100）**\n- ⚠️ 新技能，尚無社區貢獻\n\n**安全（100/100）**\n- ✅ 僅讀取公開 USDA 數據\n\n**規範符合性（70/100）**\n- ✅ 遵循 Claude Code 規範\n- ⚠️ Alpha 階段\n"
    },
    "bestPractices": [
      {
        "title": "等待 WASDE 正式發布",
        "description": "WASDE 通常在每月 10-12 日發布，確認官方發布後再執行 ingest"
      },
      {
        "title": "保留原始 PDF 備份",
        "description": "保存原始報告 PDF 以便在解析失敗時進行人工檢查"
      },
      {
        "title": "監控 schema drift",
        "description": "USDA 可能調整表格格式，定期檢查 schema_hash 變化"
      },
      {
        "title": "使用 content_hash 進行版本控制",
        "description": "利用 content_hash 確保數據冪等性"
      },
      {
        "title": "注意數據修正",
        "description": "WASDE 會在後續月份修正歷史數據，需追蹤修正值"
      }
    ],
    "pitfalls": [
      {
        "title": "忽略 PDF 佈局變化",
        "description": "USDA 可能在無預警情況下調整 PDF 格式",
        "consequence": "可能產生錯誤數據或完全無法解析"
      },
      {
        "title": "單位混淆",
        "description": "不同商品使用不同單位（bushels, cwt, metric tons 等）",
        "consequence": "供需計算完全錯誤"
      },
      {
        "title": "忽略行銷年度差異",
        "description": "不同商品的行銷年度起始月份不同",
        "consequence": "時間序列對齊錯誤"
      }
    ],
    "faq": [
      {
        "question": "WASDE 報告涵蓋哪些商品？",
        "answer": "WASDE 涵蓋以下商品類別：\n\n**穀物 (Grains)**\n- 小麥 (Wheat) - 包含 by-class 細分\n- 玉米 (Corn)\n- 稻米 (Rice) - 長粒/中短粒\n- 大麥 (Barley)\n- 高粱 (Sorghum)\n- 燕麥 (Oats)\n\n**油籽 (Oilseeds)**\n- 大豆 (Soybeans)\n- 豆油 (Soybean Oil)\n- 豆粕 (Soybean Meal)\n\n**棉花 (Cotton)**\n- 美國棉花供需\n- 世界棉花供需\n\n**畜產品 (Livestock) - 僅美國**\n- 牛肉 (Beef)\n- 豬肉 (Pork)\n- 禽肉 (Poultry)\n- 雞蛋 (Eggs)\n- 乳製品 (Dairy/Milk)\n\n**糖 (Sugar)**\n- 美國糖供需\n- 墨西哥糖供需\n"
      },
      {
        "question": "不同商品的行銷年度是什麼？",
        "answer": "| 商品 | 美國行銷年度 | 世界行銷年度 |\n|------|--------------|--------------\n| 小麥 | Jun-May      | Jul-Jun      |\n| 玉米 | Sep-Aug      | Oct-Sep      |\n| 大豆 | Sep-Aug      | Oct-Sep      |\n| 稻米 | Aug-Jul      | Jan-Dec      |\n| 棉花 | Aug-Jul      | Aug-Jul      |\n"
      },
      {
        "question": "數據來源與發布時間？",
        "answer": "- **官網**: https://www.usda.gov/oce/commodity/wasde\n- **發布日期**: 每月約 10-12 日\n- **發布時間**: 美東時間中午 12:00\n- **格式**: PDF, TXT\n- **歷史檔案**: https://esmis.nal.usda.gov/\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 數據來源\n\n所有數據來自 USDA 官方 WASDE 報告：\n- 官網：https://www.usda.gov/oce/commodity/wasde\n- 歷史檔案：https://esmis.nal.usda.gov/\n- 數據類型：公開、免費、無限制使用\n\n## 編製單位\n\nWASDE 由 World Agricultural Outlook Board (WAOB) 編製，\n整合以下機構資料：\n- Agricultural Marketing Service (AMS)\n- Economic Research Service (ERS)\n- Farm Service Agency (FSA)\n- Foreign Agricultural Service (FAS)\n- National Agricultural Statistics Service (NASS)\n"
    },
    "downloadUrl": "downloads/wasde-ingestor-0.2.0.zip"
  },
  {
    "id": "lithium-supply-demand-gap-radar",
    "name": "lithium-supply-demand-gap-radar",
    "displayName": "鋰產業鏈供需雷達",
    "description": "將鋰產業鏈（礦端 → 精煉化學品 → 電池與終端需求），整合為一套可運算的替代指標；再把這些指標映射到鋰主題 ETF（如 LIT）的成分暴露與長期價格走勢，形成可供決策的依據。 ",
    "emoji": "🔋",
    "version": "0.1.0",
    "license": "MIT",
    "author": "Ricky Wang",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [
      "鋰",
      "供需分析",
      "ETF",
      "LIT",
      "原物料",
      "電池",
      "電動車",
      "EV",
      "價格週期",
      "USGS",
      "IEA"
    ],
    "category": "commodity-sd",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": false,
    "installCount": 0,
    "content": "<essential_principles>\r\n**鋰產業鏈供需雷達 核心原則**\r\n\r\n<principle name=\"supply_chain_layers\">\r\n**供應鏈分層（Supply Chain Layers）**\r\n\r\n鋰產業鏈必須分層分析，不可混為一談：\r\n\r\n```\r\nMining → Processing → Battery\r\n(礦端)   (化學品)    (終端需求)\r\n```\r\n\r\n| 層級                 | 代表數據                 | 典型延遲  |\r\n|----------------------|--------------------------|-----------|\r\n| Upstream (礦端)      | 鋰礦產量、出口量         | 年度/季度 |\r\n| Midstream (化學品)   | 碳酸鋰/氫氧化鋰價格      | 週度/日度 |\r\n| Downstream (電池/EV) | EV 銷量、電池裝機量(GWh) | 月度      |\r\n\r\n**強制規則**：\r\n- 供給分析需指定層級（礦端 vs 精煉端）\r\n- 需求 proxy 需明確轉換假設（kWh → kg Li）\r\n- 價格分析需區分碳酸鋰 vs 氫氧化鋰\r\n</principle>\r\n\r\n<principle name=\"data_level_fallback\">\r\n**數據等級與備援策略（Data Level Fallback）**\r\n\r\n根據 `data_level` 參數自動選擇數據源：\r\n\r\n| data_level     | 價格數據             | 供需數據           | 可靠度 |\r\n|----------------|----------------------|--------------------|--------|\r\n| `free_nolimit` | CME 期貨/Proxy 指數  | USGS/IEA/澳洲政府  | 中     |\r\n| `free_limit`   | SMM/Fastmarkets 頁面 | + 公司財報         | 中高   |\r\n| `paid_low`     | SMM 完整序列         | + Benchmark 基本   | 高     |\r\n| `paid_high`    | Fastmarkets API      | + S&P/BNEF/WoodMac | 最高   |\r\n\r\n**強制規則**：\r\n- 價格數據不足時，使用 CME 合約或相關股籃子作為 proxy\r\n- 需在輸出中標註實際使用的數據等級\r\n</principle>\r\n\r\n<principle name=\"li_content_conversion\">\r\n**鋰含量轉換（Li Content Conversion）**\r\n\r\n電池需求到鋰需求的轉換必須明確假設：\r\n\r\n| 假設場景 | kg Li / kWh | 備註                |\r\n|----------|-------------|---------------------|\r\n| 保守估計 | 0.12        | 含 LFP 佔比上升假設 |\r\n| 中性估計 | 0.15        | 混合 NMC/LFP        |\r\n| 積極估計 | 0.18        | 高鎳 NMC 主導       |\r\n\r\n```python\r\nli_demand_kt = battery_gwh * kg_per_kwh * 1000  # 單位: kt LCE\r\n```\r\n\r\n**強制規則**：\r\n- 需求估計必須輸出三個情境（保守/中性/積極）\r\n- 輸出需包含 `kg_per_kwh_assumption` 欄位\r\n</principle>\r\n\r\n<principle name=\"regime_classification\">\r\n**價格型態分類（Price Regime Classification）**\r\n\r\n鋰價週期分為四個階段：\r\n\r\n| Regime      | 特徵                         | 交易含義           |\r\n|-------------|------------------------------|--------------------|\r\n| `downtrend` | 12-26 週動能 < 0, 斜率 < 0   | 空頭主導，避免做多 |\r\n| `bottoming` | 動能收斂，波動下降，均值回歸 | 觀望，等待確認     |\r\n| `uptrend`   | 動能 > 0, 斜率 > 0           | 做多視窗開啟       |\r\n| `overheat`  | 動能極端正值，波動放大       | 獲利了結風險       |\r\n\r\n**指標組合**：\r\n- 12 週 / 26 週動能（ROC）\r\n- 趨勢斜率（線性回歸）\r\n- 波動率（ATR / 標準差）\r\n- 均值回歸強度（距 MA 偏離度）\r\n</principle>\r\n\r\n<principle name=\"etf_transmission\">\r\n**ETF 傳導敏感度（ETF Transmission）**\r\n\r\nETF 對鋰價的敏感度受持股結構影響：\r\n\r\n| 持股類型          | 對鋰價 Beta | 波動特性            |\r\n|-------------------|-------------|---------------------|\r\n| Upstream (礦商)   | 1.5 - 2.5   | 高槓桿、高波動      |\r\n| Midstream (精煉)  | 0.8 - 1.2   | 跟隨但有加工費緩衝  |\r\n| Downstream (電池) | 0.3 - 0.8   | 受競爭/技術路線影響 |\r\n\r\n**計算公式**：\r\n```python\r\nETF_beta_li = Σ(weight_i * beta_i_to_lithium)\r\n```\r\n\r\n**強制規則**：\r\n- 需計算 rolling beta（建議 52 週滾動）\r\n- 傳導斷裂判斷：beta < 0.3 且持續 > 8 週\r\n</principle>\r\n</essential_principles>\r\n\r\n<intake>\r\n**您想要執行什麼操作？**\r\n\r\n1. **Full Analysis** - 完整供需×價格×傳導整合分析（生成完整報告）\r\n2. **Balance Nowcast** - 僅計算供需平衡即時估計（缺口擴大/縮小）\r\n3. **Price Regime** - 僅分析價格型態與週期位置\r\n4. **ETF Exposure** - 僅分析 ETF 持股結構與鋰價敏感度\r\n5. **Ingest Data** - 從各數據源擷取並標準化數據\r\n\r\n**等待回應後再繼續。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                                          | Workflow                     | Description                |\r\n|---------------------------------------------------|------------------------------|----------------------------|\r\n| 1, \"full\", \"analyze\", \"完整\", \"報告\", \"LIT\"       | workflows/full-analysis.md   | 完整供需×價格×傳導整合分析 |\r\n| 2, \"balance\", \"nowcast\", \"供需\", \"缺口\", \"gap\"    | workflows/balance-nowcast.md | 供需平衡即時估計           |\r\n| 3, \"price\", \"regime\", \"價格\", \"週期\", \"型態\"      | workflows/price-regime.md    | 價格型態與週期分析         |\r\n| 4, \"etf\", \"exposure\", \"holding\", \"傳導\", \"敏感度\" | workflows/etf-exposure.md    | ETF 暴露與傳導分析         |\r\n| 5, \"ingest\", \"data\", \"fetch\", \"抓取\", \"擷取\"      | workflows/ingest.md          | 數據擷取與標準化           |\r\n\r\n**讀取工作流程後，請完全遵循其步驟。**\r\n</routing>\r\n\r\n<reference_index>\r\n**參考文件** (`references/`)\r\n\r\n| 文件                      | 內容                               |\r\n|---------------------------|------------------------------------|\r\n| data-sources.md           | 所有數據來源詳細說明與 URL         |\r\n| unit-conversion.md        | 單位轉換規則（LCE/Li/GWh）         |\r\n| price-methodology.md      | 價格數據方法學（Fastmarkets/SMM）  |\r\n| etf-holdings-structure.md | LIT 持股結構與產業鏈分段           |\r\n| supply-chain-mapping.md   | 鋰供應鏈完整映射（礦→化學品→電池） |\r\n| failure-modes.md          | 失敗模式與緩解策略                 |\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow           | Purpose                    |\r\n|--------------------|----------------------------|\r\n| full-analysis.md   | 完整供需×價格×傳導整合分析 |\r\n| balance-nowcast.md | 供需平衡即時估計           |\r\n| price-regime.md    | 價格型態與週期分析         |\r\n| etf-exposure.md    | ETF 持股暴露與傳導分析     |\r\n| ingest.md          | 數據擷取與標準化           |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose           |\r\n|--------------------|-------------------|\r\n| output-json.md     | JSON 輸出結構模板 |\r\n| output-markdown.md | Markdown 報告模板 |\r\n| config.yaml        | 分析參數配置模板  |\r\n| data-schema.yaml   | 數據 Schema 定義  |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script                    | Purpose                    |\r\n|---------------------------|----------------------------|\r\n| lithium_pipeline.py       | 核心數據管線               |\r\n| ingest_sources.py         | 數據來源擷取               |\r\n| compute_balance.py        | 供需平衡計算               |\r\n| classify_regime.py        | 價格型態分類               |\r\n| compute_etf_beta.py       | ETF 傳導敏感度計算         |\r\n| visualize_analysis.py     | 分析結果綜合視覺化         |\r\n| inflection_point_chart.py | **拐點分析專用視覺化** ⭐ |\r\n</scripts_index>\r\n\r\n<quick_start>\r\n**CLI 快速開始：**\r\n\r\n```bash\r\n# 完整分析 LIT ETF（預設 10 年回看、週度頻率）\r\npython scripts/lithium_pipeline.py analyze --ticker=LIT --lookback=10 --freq=weekly\r\n\r\n# 僅計算供需平衡 Nowcast\r\npython scripts/lithium_pipeline.py balance --asof=2026-01-16\r\n\r\n# 分析價格型態（碳酸鋰 + 氫氧化鋰）\r\npython scripts/lithium_pipeline.py regime --chem=both\r\n\r\n# 計算 ETF 對鋰價的傳導敏感度\r\npython scripts/lithium_pipeline.py etf-beta --ticker=LIT --window=52\r\n\r\n# ✨ 生成視覺化圖表（完整儀表板）\r\npython scripts/visualize_analysis.py\r\n# 輸出：output/lithium_analysis_YYYY-MM-DD.png\r\n```\r\n\r\n**視覺化輸出**：\r\n- 📊 6合1 專業儀表板（18\" × 12\"，300 DPI）\r\n- 📁 自動保存至 `output/` 目錄\r\n- 📅 檔名包含當天日期\r\n- 🎨 完整中文支持\r\n\r\n**Library 快速開始：**\r\n\r\n```python\r\nfrom lithium_pipeline import LithiumSupplyDemandRadar\r\n\r\nradar = LithiumSupplyDemandRadar(\r\n    etf_ticker=\"LIT\",\r\n    lookback_years=10,\r\n    price_freq=\"weekly\",\r\n    chem_focus=\"both\",\r\n    data_level=\"free_nolimit\"\r\n)\r\n\r\n# 完整分析\r\nresult = radar.full_analysis()\r\nprint(f\"Balance Index: {result['balance_index']:.2f}\")\r\nprint(f\"Price Regime: {result['price_regime']}\")\r\nprint(f\"ETF Beta to Li: {result['etf_beta_li']:.2f}\")\r\nprint(f\"Thesis: {result['thesis']}\")\r\n```\r\n</quick_start>\r\n\r\n<success_criteria>\r\nSkill 成功執行時：\r\n- [ ] 正確識別數據等級並使用對應來源\r\n- [ ] 供需平衡指數計算正確（含三情境）\r\n- [ ] 價格型態分類明確（downtrend/bottoming/uptrend/overheat）\r\n- [ ] ETF 傳導敏感度計算正確（rolling beta）\r\n- [ ] 輸出包含完整的失效條件（invalidation）\r\n- [ ] 數據來源可追溯（source_id, data_level）\r\n- [ ] 單位轉換假設明確標註\r\n- [ ] **視覺化圖表已生成且符合規格**（300 DPI, PNG, 檔名含日期）\r\n- [ ] **報告與圖表在 output/ 目錄下一起輸出**\r\n</success_criteria>\r\n\r\n<input_schema>\r\n**輸入參數定義**\r\n\r\n```yaml\r\n# 必要參數\r\netf_ticker: string      # 目標 ETF（預設 LIT）\r\nlookback_years: int     # 回看年限（建議 10-15）\r\nprice_freq: string      # weekly | daily（建議 weekly）\r\n\r\n# 範圍參數\r\nregion_focus:           # 供應/需求重點區（選填）\r\n  - China\r\n  - Australia\r\n  - Chile\r\n  - Argentina\r\n  - US\r\n  - EU\r\n\r\nchem_focus: string      # carbonate | hydroxide | both（預設 both）\r\n\r\n# 數據等級\r\ndata_level: string      # free_nolimit | free_limit | paid_low | paid_high\r\n\r\n# 數據源開關\r\nsources:\r\n  usgs: boolean\r\n  iea_ev_outlook: boolean\r\n  australia_req: boolean\r\n  abs_exports: boolean\r\n  fastmarkets: boolean\r\n  smm: boolean\r\n  etf_holdings: boolean\r\n\r\n# 輸出格式\r\noutput_format: string   # markdown | json（預設 markdown）\r\n```\r\n</input_schema>\r\n\r\n<data_pipeline_architecture>\r\n**數據流水線架構**\r\n\r\n```\r\n[Data Sources]\r\n     |\r\n     v\r\n+--------------------+\r\n|   ingest_sources   |  --> USGS, IEA, Australia REQ/ABS\r\n+--------------------+      Fastmarkets/SMM (方法學/價格)\r\n     |                      Global X LIT factsheet\r\n     v\r\n+--------------------+\r\n|   normalize        |  --> 統一 schema + 單位標註\r\n+--------------------+\r\n     |\r\n     +-------------------+-------------------+\r\n     |                   |                   |\r\n     v                   v                   v\r\n+-----------+    +-----------+    +-----------+\r\n| supply_   |    | price_    |    | etf_      |\r\n| demand    |    | series    |    | holdings  |\r\n+-----------+    +-----------+    +-----------+\r\n     |                   |                   |\r\n     v                   v                   v\r\n+-----------+    +-----------+    +-----------+\r\n| balance_  |    | classify_ |    | compute_  |\r\n| nowcast   |    | regime    |    | etf_beta  |\r\n+-----------+    +-----------+    +-----------+\r\n     |                   |                   |\r\n     +-------------------+-------------------+\r\n                         |\r\n                         v\r\n              +--------------------+\r\n              |   generate_insight |  --> Thesis + Targets + Invalidation\r\n              +--------------------+\r\n                         |\r\n                         v\r\n              +--------------------+\r\n              |   format_output    |  --> JSON + Markdown\r\n              +--------------------+\r\n```\r\n\r\n**標準化欄位 Schema：**\r\n\r\n| 欄位        | 類型   | 說明                         |\r\n|-------------|--------|------------------------------|\r\n| date        | date   | 數據日期                     |\r\n| metric_type | string | supply/demand/price/etf      |\r\n| metric_name | string | 具體指標名稱                 |\r\n| value       | float  | 數值                         |\r\n| unit        | string | kt_LCE/USD_per_kg/GWh/pct    |\r\n| region      | string | 國家/區域                    |\r\n| source_id   | string | USGS/IEA/SMM/Fastmarkets/etc |\r\n| data_level  | string | 數據等級                     |\r\n| confidence  | float  | 來源品質評分 (0-1)           |\r\n</data_pipeline_architecture>",
    "path": "skills/lithium-supply-demand-gap-radar/SKILL.md",
    "directoryStructure": "lithium-supply-demand-gap-radar/\n├── examples\n├── manifest.json\n├── methodology.md\n├── references\n│   ├── data-sources.md\n│   ├── etf-holdings-structure.md\n│   ├── failure-modes.md\n│   ├── price-methodology.md\n│   ├── supply-chain-mapping.md\n│   └── unit-conversion.md\n├── scripts\n│   ├── classify_regime.py\n│   ├── compute_balance.py\n│   ├── compute_etf_beta.py\n│   ├── inflection_point_chart.py\n│   ├── ingest_sources.py\n│   ├── lithium_pipeline.py\n│   ├── visualize_analysis.py\n│   └── __pycache__\n│       └── visualize_analysis.cpython-312.pyc\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── config.yaml\n│   ├── data-schema.yaml\n│   ├── output-json.md\n│   └── output-markdown.md\n└── workflows\n    ├── balance-nowcast.md\n    ├── etf-exposure.md\n    ├── full-analysis.md\n    ├── ingest.md\n    └── price-regime.md",
    "lastUpdated": "2026-01-16",
    "rating": 3,
    "testQuestions": [
      {
        "question": "幫我做一份鋰主題 ETF 的整合評估",
        "imagePath": "images/lithium-analysis-2026-01-16.png",
        "expectedResult": "我已經完成了鋰主題 ETF（LIT）的完整整合評估報告。報告已保存至：\nLIT_ETF_整合評估_2026-01-16.md\n\n核心結論摘要\n\n📈 Bullish（看多）— 置信度 75%\n\n關鍵發現：\n\n1. 價格動能強勁\n  - LIT ETF：$70.62（過去一年 +74.32%）\n  - 碳酸鋰：$21,650/噸（兩年高點，較2025低點翻倍）\n2. 供需平衡收窄\n  - 2025盈餘：141,000噸 LCE\n  - 2026預計：109,000噸 LCE（收窄23%）\n  - 積極情境下可能轉為小幅赤字\n3. 供給約束顯現\n  - 澳洲2024減產4%\n  - 中國江西27個礦權被取消\n  - 寧德時代建小沃礦（6%全球供給）仍關閉\n4. 需求爆發\n  - EV占鋰需求近90%（vs 2020年64%）\n  - 儲能（ESS）成長最快（+40-50% YoY），2026年占31%\n  - 中國VAT退稅取消引發搶單潮\n5. 傳導機制健康\n  - ETF對鋰價 Beta：0.9（強傳導）\n  - 上游持股占35%（Rio Tinto 20.84%、Albemarle 7.05%、SQM 4.01%等）\n\n投資路徑\n\n當前 $70.62\n  ↓\n目標 1: $78-82（中軌，Q2-Q3）\n目標 2: $90-95（前高，Q3-Q4）\n上軌: $110-120（樂觀情境）\n\n關鍵支撐: $48（止損位）\n\n主要風險\n\n1. 🔴 中國產能擴張超預期（2026年可能超越澳洲）\n2. 🟡 全球經濟衰退壓制EV需求\n3. 🟡 技術替代（鈉離子電池、固態電池）\n4. 🟠 地緣政治（美中、南美）\n\n近期催化劑\n\n- 2026年4月：中國VAT退稅降至6%（搶單高峰）\n- 2026年4月：IEA Global EV Outlook 2026發布\n- 2026年Q2：供需數據驗證期\n\n報告包含完整的數據來源追溯、失效條件、催化劑地圖和風險評估，可作為投資決策參考。\n\n📊 生成了視覺化圖表\n\n- 檔案位置：output/lithium_analysis_2026-01-16.png\n- 檔案大小：554 KB（高解析度 300 DPI）\n- 內容：6合1專業儀表板，包含：\n  - 投資論述摘要（Bullish, 75%置信度）\n  - 供需平衡演變圖\n  - 三情境平衡指數\n  - 碳酸鋰價格走勢與制度分類\n  - ETF傳導敏感度（Beta分析）\n  - 目標路徑圖      \n"
      },
      {
        "question": "計算當前鋰的市場供需，並判斷缺口方向與拐點",
        "imagePath": "images/lithium-inflection-analysis-2026-01-16.png",
        "expectedResult": "🎯 鋰供需缺口方向與拐點判斷\n\n📍 當前缺口方向\n\n供給 > 需求 → 供給過剩（缺口為負）\nBalance Index = -1.53 標準差\n\n缺口狀態：\n- 方向: ⬇️ 供給過剩（負缺口）\n- 程度: -1.53σ（顯著過剩，超過1.5倍標準差）\n- 趨勢: 📉 Narrowing（縮小中，但仍為負）\n\n📊 缺口演變路徑（2020-2026）\n\n2020: 供需平衡 → 微過剩\n2021-2022: 缺口擴大（需求激增）→ 供不應求\n2023: 拐點出現 → 供給開始追上\n2024: 過剩形成 → 缺口轉負\n2025-2026: 過剩持續 → 但縮小中\n\n🔄 拐點判斷\n\n歷史拐點（已發生）\n\n- 2023年中: 從「供給短缺」→「供給過剩」的拐點\n  - 原因：澳洲硬岩產能大量釋放、中國精煉產能擴張\n  - 價格反應：碳酸鋰從 $70k/t 高峰跌至 $10k-15k/t\n\n未來拐點預測（待驗證）\n\n拐點時機估計：2026 Q3-Q4 至 2027 Q1\n\n觸發條件（需滿足至少2項）：\n\n1. 需求側加速 ✅ 機率：高（60%）\n  - IEA EV Outlook 2026 上調預測\n  - 儲能市場（ESS）裝機量超預期\n  - 北美/歐洲 EV 銷量反彈\n2. 供給側收縮 ⚠️ 機率：中（40%）\n  - 澳洲礦商減產（低價導致虧損）\n  - 智利政策限制產出\n  - 邊際成本生產商退出\n3. 庫存去化完成 ⚠️ 機率：中（45%）\n  - 中國碳酸鋰社會庫存降至歷史低位\n  - 產業鏈庫存週轉加速\n\n📈 三情境預測\n┌──────┬───────────────────┬────────────────────────┬──────┐\n│ 情境 │     拐點時間      │ Balance Index 轉正時間 │ 機率 │\n├──────┼───────────────────┼────────────────────────┼──────┤\n│ 樂觀 │ 2026 Q3           │ 2026 Q4                │ 25%  │\n├──────┼───────────────────┼────────────────────────┼──────┤\n│ 中性 │ 2026 Q4 - 2027 Q1 │ 2027 Q2                │ 50%  │\n├──────┼───────────────────┼────────────────────────┼──────┤\n│ 悲觀 │ 2027 Q2+          │ 2027 Q4+               │ 25%  │\n└──────┴───────────────────┴────────────────────────┴──────┘\n🚦 拐點確認指標（實時監控）\n\n需要同時觀察以下指標：\n\n1. Balance Index 回升\n\n- ✅ 目標：從 -1.53 回升至 -0.5 以上\n- 📊 當前：-1.53（仍顯著過剩）\n- ⏰ 監控頻率：月度\n\n2. 價格底部確認\n\n- ✅ 目標：碳酸鋰價格站穩 $15k/t 以上且 12週/26週動能皆轉正\n- 📊 當前：Uptrend（動能正向，但 Balance Index 矛盾）\n- ⏰ 監控頻率：週度\n\n3. 庫存數據\n\n- ✅ 目標：中國碳酸鋰庫存周轉天數 < 30 天\n- 📊 當前：無最新數據（需補充）\n- ⏰ 監控頻率：月度\n\n4. 產能利用率\n\n- ✅ 目標：全球鋰礦產能利用率 < 75%（供給收縮開始）\n- 📊 當前：估計 >85%（仍在擴張）\n- ⏰ 監控頻率：季度\n\n⚡ 即刻行動清單\n\n若要捕捉拐點，需要：\n\n1. 追蹤催化劑時間表\n  - 2026-04：IEA EV Outlook 發布\n  - 2026-Q1：澳洲 REQ 季報\n  - 2026-Q2：智利鋰政策明確化\n  - 每月：中國 SMM 庫存數據\n2. 設定警報條件\n  - Balance Index 回升至 -1.0 以上\n  - 碳酸鋰價格突破 $18k/t\n  - LIT ETF 突破 $56.20（前高阻力）\n  - 澳洲主要礦商宣布減產\n3. 風險管理\n  - 在 $38.50 設定止損（LIT ETF）\n  - Balance Index 若惡化至 -2.0，立即退出\n  - 價格型態轉為 Downtrend，停損離場\n\n---\n📌 結論\n\n缺口方向：當前為供給過剩（Balance Index = -1.53）\n\n拐點判斷：\n- ❌ 未發生（Balance Index 仍顯著為負）\n- ⏳ 預期時間：2026 Q3-Q4 至 2027 Q1\n- 🎯 關鍵確認：Balance Index 回升至 -0.5 以上 + 價格站穩 $15k/t + 庫存去化 + 產能利用率下降\n\n當前建議：謹慎觀望，等待多重確認訊號出現後再行動。基本面與技術面的背離需要密切監控。\n"
      },
      {
        "question": "分析鋰價目前處於什麼週期階段",
        "expectedResult": "🔄 鋰價週期階段分析\n\n分析日期: 2026-01-16\n數據來源: CME 鋰期貨 proxy + 歷史供需數據\n\n---\n📊 當前週期位置\n\n完整週期循環：\nDOWNTREND → BOTTOMING → [UPTREND] → OVERHEAT\n                            ↑\n                        當前位置\n\n判定: 🟢 UPTREND（上行趨勢期） - 早期階段\n\n---\n📈 價格技術指標\n\n碳酸鋰 (99.5% Battery Grade)\n┌────────────────┬─────────┬───────────────┬───────────────┐\n│      指標      │ 當前值  │     判讀      │     信號      │\n├────────────────┼─────────┼───────────────┼───────────────┤\n│ 12週動能 (ROC) │ +6.1%   │ 短期動能轉正  │ 🟢 做多訊號   │\n├────────────────┼─────────┼───────────────┼───────────────┤\n│ 26週動能 (ROC) │ +3.06%  │ 中期動能轉正  │ 🟢 趨勢確認   │\n├────────────────┼─────────┼───────────────┼───────────────┤\n│ 趨勢斜率       │ +0.0016 │ 穩定上升      │ 🟢 持續性佳   │\n├────────────────┼─────────┼───────────────┼───────────────┤\n│ 波動率 (ATR%)  │ 2.23%   │ 低波動        │ 🟡 盤整後突破 │\n├────────────────┼─────────┼───────────────┼───────────────┤\n│ 均值偏離度     │ +20.61% │ 高於200週均線 │ 🟢 強勢格局   │\n└────────────────┴─────────┴───────────────┴───────────────┘\n氫氧化鋰 (56.5% LiOH·H₂O)\n\n型態判定: 🟢 UPTREND（與碳酸鋰同步）\n\n價差狀態:\n- 當前價差：1,559 USD/t\n- 歷史分位：95%（異常寬）\n- 趨勢：Widening（持續擴大）\n- 同步狀態：Synchronized\n\n---\n🎯 週期階段特徵對照\n\n✅ 符合 UPTREND 的特徵\n\n1. 動能轉正 ✅\n  - 12週 ROC: +6.1% > 0\n  - 26週 ROC: +3.06% > 0\n  - 連續多週保持正值\n2. 趨勢斜率向上 ✅\n  - 線性回歸斜率: +0.0016\n  - 價格高點逐步抬升\n3. 均線支撐 ✅\n  - 價格高於 200 週均線 20.61%\n  - 中短期均線呈多頭排列\n4. 波動率特徵 ⚠️\n  - 當前波動率 2.23%（較低）\n  - 注意: 典型 Uptrend 波動率應逐步擴大\n  - 當前處於\"盤整後突破\"階段\n\n⚠️ 需要觀察的風險訊號\n\n1. 供需基本面矛盾 🔴\n  - Balance Index: -1.53（供給過剩）\n  - 價格上行但基本面不支持\n  - 風險: 可能是投機推動，非基本面驅動\n2. 波動率偏低 🟡\n  - 2.23% 屬於低波動\n  - 可能即將突破（放量上攻或下跌）\n3. 價差異常 🟡\n  - 氫氧化鋰 vs 碳酸鋰價差處於 95% 分位\n  - 可能反映供需結構失衡\n\n---\n📍 週期階段定位圖\n\n價格演變路徑：\n                                    當前\n                                    ↓\n$70k ★ 2022Q3 高峰 (OVERHEAT)\n      |\n$50k  |\n      |\n$30k  |         2023Q2 拐點\n      |           ↓\n$20k  |    ╱──────────╲\n      | ╱                ╲\n$15k  |                   ╲___     2024Q4 底部 → 2026Q1 反彈\n      |                       ╲___╱          (BOTTOMING → UPTREND)\n$10k  ★ 2024Q4 底部 (BOTTOMING)\n      |\n      └────────────────────────────────────────────▶\n      2022    2023    2024    2025    2026    時間\n\n關鍵位置:\n- 🔻 歷史底部：$10,500/t（2024Q4）\n- 🔵 當前價格：$11,500/t（2026Q1）\n- 🎯 短期目標：$15,000/t（關鍵阻力）\n- 🎯 中期目標：$18,000/t（2026Q4 預期拐點）\n\n---\n🔮 週期展望\n\n情境 1：持續 Uptrend（機率 60%）\n\n條件:\n- 供需 Balance Index 回升至 -1.0 以上\n- 價格突破 $15k/t 阻力\n- 波動率擴大至 4-5%\n\n目標:\n- 2026Q2：$15-18k/t\n- 2026Q4：$18-22k/t（拐點確認）\n\nLIT ETF 對應:\n- 當前：$70.62\n- 目標1：$80-95\n- 目標2：$110-120\n\n情境 2：假突破後回落（機率 25%）\n\n條件:\n- Balance Index 惡化至 -2.0 以下\n- 價格無法突破 $15k/t\n- 供給繼續大幅擴張\n\n目標:\n- 回測 $10k/t 支撐\n- LIT ETF 跌破 $48\n\n情境 3：震盪盤整（機率 15%）\n\n條件:\n- Balance Index 維持 -1.5 左右\n- 價格在 $11-15k/t 區間震盪\n- 等待基本面明朗\n\n目標:\n- 橫盤整理 3-6 個月\n- LIT ETF 在 $65-75 震盪\n\n---\n💡 交易含義\n\n當前建議：謹慎做多 🟢⚠️\n\n做多依據:\n1. ✅ 技術面明確 Uptrend\n2. ✅ 12週/26週動能皆轉正\n3. ✅ 價格高於長期均線\n\n風險提示:\n1. ⚠️ 基本面 Balance Index 仍為負\n2. ⚠️ 波動率偏低，可能即將變盤\n3. ⚠️ 價差異常寬，結構性問題\n\n操作策略\n\n保守策略（等待確認）:\n等待條件：\n1. Balance Index 回升至 -1.0 以上\n2. 價格站穩 $15k/t\n3. 波動率擴大至 4% 以上\n\n進場點：$15.5k/t 突破確認\n止損：$13k/t\n目標：$18-20k/t\n\n積極策略（提前布局）:\n當前就可小倉位試探：\n進場：$11-12k/t\n加碼：突破 $15k/t\n止損：$10k/t（跌破歷史低點）\n目標：$18-22k/t\n倉位：20-30%（不宜滿倉）\n\n防守策略（等待回調）:\n等待回調至：\n- $10.5k/t 附近（歷史底部）\n- Balance Index 回升確認\n\n優勢：安全邊際高\n劣勢：可能錯過一段漲幅\n\n---\n📅 關鍵監控時點\n\n2026年1-3月（當前階段）\n\n- 觀察: Balance Index 是否開始回升\n- 事件: 澳洲 REQ Q1 報告（3月）\n- 操作: 小倉位試探，止損 $10k\n\n2026年4-6月（確認期）\n\n- 觀察: IEA EV Outlook 2026（4月發布）\n- 事件: 中國 VAT 退稅調整（4月）\n- 操作: 若需求上調，加大倉位至 30%\n\n2026年7-9月（加速期）\n\n- 觀察: 價格是否突破 $15-18k/t\n- 事件: 供給側減產訊號\n- 操作: 突破確認後可加至 50%\n\n2026年10-12月（拐點驗證）\n\n- 觀察: Balance Index 是否轉正\n- 事件: 供需缺口重現\n- 操作: 拐點確認後可滿倉\n\n---\n🚨 失效條件\n\nUptrend 失效訊號（立即退出）:\n\n1. 價格跌破 $10k/t\n  - 跌破歷史低點\n  - 表示新低形成\n2. 12週動能轉負持續 4 週\n  - 短期動能反轉\n  - Uptrend 結束\n3. Balance Index 惡化至 -2.0 以下\n  - 供給過剩惡化\n  - 基本面壓力加大\n4. 波動率突然放大至 8% 以上\n  - 恐慌性拋售\n  - 可能進入 Downtrend\n\n---\n📊 結論\n\n週期階段: 🟢 UPTREND（早期階段）\n\n置信度: 75%（技術面強勁，但基本面存疑）\n\n操作建議:\n- 💡 謹慎做多，小倉位試探\n- 🎯 等待 $15k/t 突破確認後加碼\n- 🚨 嚴守 $10k/t 止損\n- 📅 密切監控 2026Q2-Q4 關鍵催化劑\n\n風險提示:\n當前技術面與基本面背離，需要密切監控供需 Balance Index 變化。若基本面持續惡化，Uptrend 可能是假突破。\n"
      }
    ],
    "qualityScore": {
      "overall": 65,
      "badge": "白銀",
      "metrics": {
        "architecture": 80,
        "maintainability": 70,
        "content": 80,
        "community": 20,
        "security": 80,
        "compliance": 70
      },
      "details": "**架構（80/100）**\n- Router pattern 正確分離職責\n- 三層中介數據設計完善\n\n**可維護性（70/100）**\n- 多數據源需長期維護\n- 價格數據 fallback 邏輯需定期驗證\n\n**內容（80/100）**\n- 完整的供需分析框架\n- 清晰的價格型態定義\n\n**社群（20/100）**\n- 新建技能，尚無社群回饋\n\n**安全（80/100）**\n- 無敏感資料處理\n- 外部 URL 需適當處理\n\n**合規（70/100）**\n- 付費數據源授權需注意\n- 價格數據抓取需遵守 ToS\n"
    },
    "bestPractices": [
      {
        "title": "數據等級先決",
        "description": "分析前確認 data_level 參數，決定使用哪些數據源和 fallback 策略"
      },
      {
        "title": "三層中介架構",
        "description": "Balance Nowcast + Price Regime + ETF Transmission 三層分開計算，最後整合判斷"
      },
      {
        "title": "失效條件明確",
        "description": "每個分析報告必須包含明確的失效條件（invalidation），支持決策追蹤"
      },
      {
        "title": "單位轉換透明",
        "description": "電池需求到鋰需求的轉換必須明確假設（kg/kWh），並輸出三情境"
      }
    ],
    "pitfalls": [
      {
        "title": "忽略數據延遲",
        "description": "不同數據源更新頻率不同（年度/季度/週度）",
        "consequence": "可能導致供需判斷滯後或混淆"
      },
      {
        "title": "價格數據不可得",
        "description": "免費等級無法取得完整價格序列",
        "consequence": "需使用 CME 期貨或股價 proxy，精度下降"
      },
      {
        "title": "ETF 持股變動",
        "description": "ETF 持股會定期調整",
        "consequence": "傳導敏感度計算可能失準"
      },
      {
        "title": "單位混淆",
        "description": "LCE（碳酸鋰當量）與純鋰金屬混用",
        "consequence": "數量級差異約 5.3 倍"
      }
    ],
    "faq": [
      {
        "question": "為什麼要區分碳酸鋰和氫氧化鋰？",
        "answer": "兩者用途不同：\n- 碳酸鋰：主要用於 LFP 電池\n- 氫氧化鋰：主要用於高鎳 NMC/NCA 電池\n價格可能出現分化，需分開追蹤\n"
      },
      {
        "question": "如何判斷價格型態是否已轉多？",
        "answer": "關鍵確認訊號：\n1. 12週動能轉正（ROC > 0）\n2. 波動率開始擴大\n3. 價格突破近期高點\n4. Balance Index 同步上行\n"
      },
      {
        "question": "為什麼 ETF 對鋰價的敏感度會變化？",
        "answer": "影響因素：\n1. 持股結構調整（上游 vs 下游比例）\n2. 個股特殊事件（併購、產能變動）\n3. 競爭格局變化（電池技術路線）\n4. 市場情緒與資金流向\n"
      },
      {
        "question": "免費數據等級夠用嗎？",
        "answer": "`free_nolimit` 可以完成基本分析：\n- USGS 提供年度供需基準\n- IEA 提供電池需求趨勢\n- 澳洲政府提供季度出口\n- CME 期貨提供價格 proxy\n\n但若需要更即時/更細緻的分析，建議升級到 `paid_low` 或以上\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 設計背景\n\n此技能源於「LIT 值不值得做多？」這個實際投資問題。\n市場上有大量關於鋰的敘事（供應過剩、結構成長），\n但很少有人把這些敘事轉化為可量化、可追蹤的框架。\n\n## 核心洞察\n\n1. **三層中介架構**: 供需平衡、價格型態、ETF傳導三者需同步判斷\n2. **數據等級決定精度**: 免費數據可用，但付費數據提供更即時的訊號\n3. **失效條件是關鍵**: 任何多空判斷都必須有明確的失效條件\n4. **傳導可能斷裂**: ETF 對鋰價的敏感度會隨市場結構變化\n"
    },
    "methodology": "這個技能原理分成四層，每一層都對應可取得的資料與可運算的指標：\r\n\r\n### 1. 供給需求：建立 **缺口指標** \r\n**原理**：鋰的價格中期走勢，往往由 **供需邊際變化** 主導。即使無法拿到完整、精準的全市場平衡表，也能用公開資料做出穩定的替代指標。\r\n\r\n- **供給替代指標（供給端）**：國別產量、出口、產能展望（例如：美國地質調查機構的年度基準資料 + 澳洲季度展望／出口資料）\r\n- **需求替代指標（需求端）**：電動車銷量／電池裝機（例如：國際能源總署的電動車展望報告中，電池需求的趨勢）\r\n\r\n把兩者標準化後做差，得到 **缺口指標** ：\r\n- **缺口指標 ≈ 標準化(需求替代指標 − 供給替代指標)**  \r\n  - 缺口指標上行：缺口擴大（市場更偏向供應偏緊）\r\n  - 缺口指標下行：寬鬆／過剩（市場更偏向供應偏鬆）\r\n\r\n> 重點：你不需要精準算到 **缺口幾萬噸** ，而是要能抓到 **缺口方向** 與 **拐點** 。\r\n\r\n### 2. 價格型態：確認市場是否開始為缺口定價\r\n**原理**：供需指標只是 **基本面** ，市場不一定立刻反應；因此要加一層 **價格型態** 判斷：鋰價是否已從下跌／築底，轉為上行趨勢。\r\n\r\n常用的型態分類：下行, 築底, 上行, 過熱，常用指標（以週線為主，更貼近產業節奏）：\r\n- 動能（例如 12–26 週）\r\n- 趨勢斜率（滾動斜率）\r\n- 波動型態（波動擴張）\r\n\r\n> 若 **缺口指標上行** 但鋰價仍處於下行型態，代表市場尚未認同，或仍在消化庫存與供給重啟的預期。\r\n\r\n### 3. 傳導速度：鋰價是否真的影響到股票與主題基金？\r\n**原理**：即使鋰價上漲，也可能因為公司成本、合約定價、庫存週期、或下游競爭而造成 **股價不跟** 。  \r\n所以必須檢驗 **鋰 → 公司 → 主題基金** 這條傳導鏈是否有效。\r\n\r\n做法：\r\n- 將主題基金的成分股分段：**上游（礦）／中游（精煉化學）／下游（電池材料與製造）**\r\n- 計算：\r\n  - **主題基金對鋰價因子的敏感度（滾動敏感度）**\r\n  - **各分段的主導貢獻（是誰在帶動主題基金上漲）**\r\n\r\n> 傳導有效的典型特徵：鋰價的型態轉為偏多後，主題基金對鋰價因子的敏感度回升，且上游／中游權重股開始領漲。\r\n\r\n### 4. 趨勢判斷：把結論落到 **交易／配置路徑** \r\n**原理**：你最後要回答的是 **能不能做多**  **何時可能走到哪**  **什麼情況算失效** 。  \r\n因此要把基本面與傳導結論，落到主題基金的長週期結構（例如：週線通道、前高、支撐區）。\r\n\r\n常見輸出：\r\n- **目標路徑**：中軌 → 前高 → 上軌（以區間而非精準點位）\r\n- **失效條件**：跌破關鍵週線支撐、或傳導敏感度轉弱、或缺口指標反轉\r\n\r\n## 這個技能為什麼實用\r\n- **把敘事變成可驗證條件**：不是聽到 **即將出現缺口** 就追，而是看缺口指標與價格型態是否真的轉向\r\n- **把主題投資拆成可追蹤的儀表板**：每週／每月更新一次，就能維持一致邏輯\r\n- **能清楚定義失效**：多頭觀點不是信仰，而是有明確的破局條件",
    "downloadUrl": "downloads/lithium-supply-demand-gap-radar-0.1.0.zip"
  },
  {
    "id": "cost-density-net-rr-calculator",
    "name": "cost-density-net-rr-calculator",
    "displayName": "計算成本密度淨風報比",
    "description": "計算非線性交易成本對風險報酬比的影響。將固定手續費與買賣價差整合為統一的成本密度（Cost Density）指標，揭示停損幅度與策略效率之間呈現雙曲線式的關係。",
    "emoji": "🧮",
    "version": "0.1.0",
    "license": "MIT",
    "author": "macro-skills",
    "authorUrl": "https://github.com/fatfingererr/macro-skills",
    "tags": [],
    "category": "indicator-monitoring",
    "dataLevel": "free-nolimit",
    "tools": [
      "claude-code"
    ],
    "featured": false,
    "installCount": 0,
    "content": "<essential_principles>\r\n**成本密度模型核心原則**\r\n\r\n**1. 核心公式**\r\n\r\n所有計算基於以下關係：\r\n\r\n```\r\nCost Density = (c/V + s)           # 成本密度（pips 等效）\r\nx = Cost Density / P               # 負載係數\r\nRR_net = (RR_g - x) / (1 + x)      # 淨風險報酬比\r\nWR_min = (1 + x) / (1 + RR_g)      # 最低勝率\r\nP_critical = CostDensity × (RR_g + 2) / RR_g  # 效率減半點\r\n```\r\n\r\n**2. 參數定義**\r\n\r\n| 參數 | 定義                      | 單位         |\r\n|------|---------------------------|--------------|\r\n| RR_g | 毛風險報酬比（目標/停損） | 無單位       |\r\n| P    | 停損大小                  | pips/points  |\r\n| c    | 來回佣金（每手）          | 帳戶貨幣     |\r\n| s    | 來回點差                  | pips/points  |\r\n| V    | 每 pip 價值（每手）       | 帳戶貨幣/pip |\r\n| R    | 固定風險（可選，會抵消）  | 帳戶貨幣     |\r\n\r\n**3. 關鍵洞察**\r\n\r\n- **雙曲線衰減**: P → 0 時，x → ∞，RR_net → -1\r\n- **R 無關性**: RR_net 不依賴固定風險 R\r\n- **剪刀效應**: 短時間框架同時增加成本負擔與降低訊號品質\r\n\r\n**4. 單位一致性規則**\r\n\r\n- P 和 s 必須使用相同基準（都是 pips 或都是 points）\r\n- c 必須是 round-turn（來回）佣金\r\n- V 必須是每 pip 每手的價值\r\n</essential_principles>\r\n\r\n<intake>\r\n**您想要執行什麼操作？**\r\n\r\n1. **Compute** - 計算單一參數組合的成本密度與效率指標\r\n2. **Sweep** - 掃描停損範圍，生成 RR_net/WR_min 曲線表\r\n3. **Analyze** - 解讀結果，提供策略建議\r\n\r\n**等待回應後再繼續。**\r\n</intake>\r\n\r\n<routing>\r\n| Response                             | Workflow             | Description          |\r\n|--------------------------------------|----------------------|----------------------|\r\n| 1, \"compute\", \"calculate\", \"single\"  | workflows/compute.md | 單次計算成本密度指標 |\r\n| 2, \"sweep\", \"grid\", \"curve\", \"range\" | workflows/sweep.md   | 網格掃描與閾值搜尋   |\r\n| 3, \"analyze\", \"interpret\", \"explain\" | workflows/analyze.md | 結果解讀與策略建議   |\r\n\r\n**讀取工作流程後，請完全遵循其步驟。**\r\n</routing>\r\n\r\n<reference_index>\r\n**參考文件** (`references/`)\r\n\r\n| 文件        | 內容                     |\r\n|-------------|--------------------------|\r\n| formulas.md | 完整公式推導與數學證明   |\r\n| theory.md   | 市場微結構理論背景與文獻 |\r\n</reference_index>\r\n\r\n<workflows_index>\r\n| Workflow   | Purpose                    |\r\n|------------|----------------------------|\r\n| compute.md | 單次計算成本密度與效率指標 |\r\n| sweep.md   | 網格掃描與閾值搜尋         |\r\n| analyze.md | 結果解讀與策略建議         |\r\n</workflows_index>\r\n\r\n<templates_index>\r\n| Template           | Purpose          |\r\n|--------------------|------------------|\r\n| output-schema.yaml | 輸出 JSON schema |\r\n| input-schema.yaml  | 輸入參數 schema  |\r\n</templates_index>\r\n\r\n<scripts_index>\r\n| Script          | Purpose             |\r\n|-----------------|---------------------|\r\n| cost_density.py | Python 計算實作     |\r\n| cost_density.ts | TypeScript 計算實作 |\r\n</scripts_index>\r\n\r\n<quick_start>\r\n**快速計算（XAU/USD 範例）：**\r\n\r\n輸入：\r\n```json\r\n{\r\n  \"RR_g\": 3.0,\r\n  \"c\": 7.0,\r\n  \"s\": 1.5,\r\n  \"V\": 10.0,\r\n  \"P\": 20\r\n}\r\n```\r\n\r\n計算：\r\n```python\r\ncost_density = 7.0/10.0 + 1.5  # = 2.2 pips\r\nx = 2.2 / 20                    # = 0.11\r\nRR_net = (3.0 - 0.11) / (1 + 0.11)  # = 2.60\r\nWR_min = (1 + 0.11) / (1 + 3.0)     # = 27.7%\r\nP_critical = 2.2 * (3.0 + 2) / 3.0  # = 3.67 pips\r\n```\r\n\r\n輸出：\r\n```json\r\n{\r\n  \"cost_density\": 2.2,\r\n  \"x\": 0.11,\r\n  \"RR_net\": 2.60,\r\n  \"WR_min\": 0.277,\r\n  \"P_critical\": 3.67,\r\n  \"Loss_RR\": 0.133\r\n}\r\n```\r\n</quick_start>\r\n\r\n<success_criteria>\r\nSkill 成功執行時：\r\n- [ ] 輸入參數通過驗證（單位一致性）\r\n- [ ] 正確計算 cost_density、x、RR_net、WR_min\r\n- [ ] 識別是否處於高摩擦區（P < P_critical）\r\n- [ ] 輸出符合 outputs_schema\r\n- [ ] 提供 zh-TW 解釋說明\r\n</success_criteria>",
    "path": "skills/cost-density-net-rr-calculator/SKILL.md",
    "directoryStructure": "cost-density-net-rr-calculator/\n├── examples\n│   ├── eurusd_low_cost.json\n│   ├── high_frequency_warning.json\n│   └── xauusd_default.json\n├── manifest.json\n├── references\n│   ├── formulas.md\n│   └── theory.md\n├── scripts\n│   ├── cost_density.py\n│   └── cost_density.ts\n├── SKILL.md\n├── skill.yaml\n├── templates\n│   ├── input-schema.yaml\n│   └── output-schema.yaml\n└── workflows\n    ├── analyze.md\n    ├── compute.md\n    └── sweep.md",
    "lastUpdated": "2026-01-15",
    "rating": 3,
    "testQuestions": [
      {
        "question": "計算 XAU/USD 在停損 20 pips 時的淨風險報酬比（佣金 $7，點差 1.5 pips）",
        "expectedResult": "此技能會：\n1. 計算成本密度 = (7/10 + 1.5) = 2.2 pips\n2. 計算負載係數 x = 2.2/20 = 0.11\n3. 計算 RR_net = (3.0 - 0.11)/(1 + 0.11) = 2.60\n4. 計算 WR_min = (1 + 0.11)/(1 + 3.0) = 27.7%\n"
      },
      {
        "question": "掃描停損從 5 到 50 pips，找出 RR_net 下降 20% 的臨界點",
        "expectedResult": "此技能會產生 P vs RR_net 表格，標記：\n- RR_net > 0 的最小 P\n- Loss_RR 達到 20%、40% 的 P 值\n- P_critical（效率減半點）\n"
      },
      {
        "question": "分析為何微型時間框架策略難以獲利",
        "expectedResult": "此技能會解釋：\n- 縮小停損導致成本雙曲線增長\n- 精確度需求與訊號品質的「剪刀效應」\n- 建議在回測中用 RR_net 替代 RR_g\n"
      }
    ],
    "qualityScore": {
      "overall": 75,
      "badge": "白銀",
      "metrics": {
        "architecture": 85,
        "maintainability": 80,
        "content": 90,
        "community": 30,
        "security": 100,
        "compliance": 80
      },
      "details": "**架構（85/100）**\n- ✅ 模組化 router pattern 設計\n- ✅ 清晰的公式與理論分離\n- ⚠️ Alpha 階段\n\n**可維護性（80/100）**\n- ✅ 工作流程分離（計算/掃描/分析）\n- ✅ 公式參考文件獨立\n\n**內容（90/100）**\n- ✅ 完整的數學推導\n- ✅ 實際案例（XAU/USD）\n\n**社區（30/100）**\n- ⚠️ 新技能，尚無社區貢獻\n\n**安全（100/100）**\n- ✅ 純計算，無外部數據依賴\n\n**規範符合性（80/100）**\n- ✅ 遵循 Claude Code 規範\n"
    },
    "bestPractices": [
      {
        "title": "確保單位一致性",
        "description": "P（停損）和 s（點差）必須使用相同的 pip/point 基準"
      },
      {
        "title": "使用 RR_net 進行回測",
        "description": "微型時間框架回測應使用 RR_net 而非 RR_g"
      },
      {
        "title": "監控 P_critical 閾值",
        "description": "停損低於 P_critical 時，策略進入高摩擦區"
      },
      {
        "title": "考慮滑點影響",
        "description": "此模型假設理想執行，實際交易需額外考慮滑點"
      }
    ],
    "pitfalls": [
      {
        "title": "單位混淆",
        "description": "P 使用 pips 但 s 使用 points，或 c 不是 round-turn",
        "consequence": "計算結果完全錯誤"
      },
      {
        "title": "忽略 R 的無關性",
        "description": "誤以為改變固定風險 R 會影響 RR_net",
        "consequence": "錯誤的部位規模決策"
      },
      {
        "title": "線性外推",
        "description": "假設縮小停損會線性降低效率",
        "consequence": "低估微型時間框架的成本衝擊"
      }
    ],
    "faq": [
      {
        "question": "為什麼 RR_net 與 R（固定風險）無關？",
        "answer": "在固定風險框架中，部位規模 = R / (P × V)。\n當推導 RR_net 時，R 在分子分母同時出現並抵消，\n證明效率衰減與帳戶規模無關，僅取決於 RR_g、P 和成本密度。\n"
      },
      {
        "question": "什麼是「獲利事件視界」？",
        "answer": "當停損縮小到某個臨界值以下，無論預測準確度多高，\n正期望值都變得統計上不可能達成。這個閾值稱為「事件視界」，\n類似於黑洞的概念——一旦越過，就無法逃脫負期望值。\n"
      },
      {
        "question": "P_critical 如何計算？",
        "answer": "P_critical = CostDensity × (RR_g + 2) / RR_g\n\n這是策略效率減半（RR_net = 0.5 × RR_g）時的停損大小。\n低於此值進入高摩擦區，效率急劇下降。\n"
      }
    ],
    "about": {
      "repository": "https://github.com/fatfingererr/macro-skills",
      "branch": "main",
      "additionalInfo": "## 理論來源\n\n基於 Sergei Sukhov 的論文：\n\"Geometry of Advantage Decay: A Quantitative Model for Risk-Reward\nDegradation in High-Friction Trading Environments\"\n\n## 相關文獻\n\n- Kyle (1985): Continuous Auctions and Insider Trading\n- Glosten & Milgrom (1985): Bid-ask spread models\n- Easley & O'Hara (1987): Price, trade size, and information\n"
    },
    "downloadUrl": "downloads/cost-density-net-rr-calculator-0.1.0.zip"
  }
]