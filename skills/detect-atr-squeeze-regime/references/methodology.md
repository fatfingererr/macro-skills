# 波動擠壓行情偵測方法論

## 概念來源

本方法論基於 Saxo Bank 商品策略主管 Ole Hansen 對白銀市場的分析觀點。

**核心洞察**：當資產的波動率（以 14 日 ATR% 衡量）顯著超過歷史常態時，市場進入「波動主導的擠壓行情」，此時：

- 技術位（支撐/壓力）的可靠度下降
- 停損容易被「噪音」掃掉
- 價格運動更多反映「被迫流」而非基本面

## ATR 百分比（ATR%）

### 為何使用百分比？

傳統 ATR 是絕對值（以價格單位計算），無法：
- 跨資產比較（$30 的白銀 vs $2000 的黃金）
- 建立「常態」基準
- 判斷波動是否「異常」

**解決方案**：將 ATR 轉換為收盤價的百分比

```
ATR% = ATR / Close * 100
```

例如：
- 白銀 ATR = $2.17，Close = $30.00 → ATR% = 7.23%
- 黃金 ATR = $57.00，Close = $2000.00 → ATR% = 2.85%

### ATR 計算方法

**True Range（真實波幅）**：

```
TR = max(High - Low, |High - Prev_Close|, |Low - Prev_Close|)
```

**14 日 EMA 平滑**：

```python
# EMA 平滑（預設）
ATR = TR.ewm(span=14, adjust=False).mean()

# Wilder 平滑（替代）
ATR = TR.ewm(alpha=1/14, adjust=False).mean()
```

## 基準期選擇

### 為何選擇 3 年（756 交易日）？

- **涵蓋週期**：3 年足以涵蓋多數資產的波動週期
- **統計穩定**：樣本量足夠計算有意義的均值
- **實用性**：不會因太長而對當前市場失去敏感度

### 基準計算

```python
baseline_atr_pct = atr_pct.rolling(756).mean()
ratio = current_atr_pct / baseline_atr_pct
```

## 三行情分類

### 1. 秩序市場（Orderly Market）

**條件**：ratio < 1.2

**特徵**：
- 波動在歷史常態範圍內
- 技術分析有效
- 停損可精準設置
- 趨勢追蹤策略可靠

**建議**：
- 正常交易策略
- 標準停損（1.0-1.5 ATR）
- 任意時間框架

### 2. 波動偏高趨勢（Elevated Volatility Trend）

**條件**：1.2 <= ratio < 2.0

**特徵**：
- 波動高於常態但仍有結構
- 技術位有效性下降
- 方向性仍可辨識
- 需要適應性調整

**建議**：
- 適度放寬停損（1.5-2.0 ATR）
- 降低倉位規模
- 偏向較長時間框架

### 3. 波動主導的擠壓行情（Volatility-Dominated Squeeze）

**條件**：ratio >= 2.0 AND atr_pct >= 6.0%

**特徵**：
- 波動遠超常態
- 技術位失靈
- 「被迫流」主導價格
- 停損頻繁被掃

**建議**：
- 大幅放寬停損（2.0-3.0 ATR）
- 顯著降低倉位
- 切換到週線以上
- 使用期權/價差結構

## 反身性機制

### 什麼是「被迫流」？

在擠壓行情下，價格運動不再主要反映：
- 基本面變化
- 技術面突破
- 市場共識改變

而是被以下「被迫流」主導：

1. **保證金調整**
   - 波動上升 → 保證金要求提高
   - 無法追加保證金的部位被強制平倉

2. **槓桿去化**
   - 高槓桿投機者被迫減倉
   - 連鎖反應放大波動

3. **期權避險**
   - Delta/Gamma 避險需求
   - 價格接近執行價時避險量激增
   - 正反饋循環

4. **空頭回補**
   - 空頭停損觸發
   - 「軋空」放大上漲

5. **被動再平衡**
   - 風險平價/目標波動率策略
   - 波動上升時自動減倉
   - 加劇賣壓

### 為何技術位失靈？

技術分析的前提是：
> 支撐/壓力位反映市場參與者的共識

但在擠壓行情下：
> 價格突破更多是流動性事件的結果，而非共識改變

例如：
- 白銀跌破 $28 支撐
- 不是因為市場轉空
- 而是因為大量停損單在該位置被觸發
- 價格可能在數小時內收回

## 技術位可靠度評分

### 計算公式

```python
def calculate_reliability_score(regime: str, ratio: float) -> int:
    if regime == "volatility_dominated_squeeze":
        # 2.0x -> 50分, 4.5x -> 0分
        score = max(0, int(50 - (ratio - 2.0) * 20))
    elif regime == "elevated_volatility_trend":
        # 1.2x -> 100分, 2.0x -> 50分
        score = int(50 + (2.0 - ratio) * 50 / 0.8)
    else:
        # 0.8x -> 100分, 1.2x -> 90分
        score = int(100 - (ratio - 0.8) * 25)

    return max(0, min(100, score))
```

### 解讀

| 分數   | 等級 | 意義                 |
|--------|------|----------------------|
| 80-100 | 高   | 技術分析高度可靠     |
| 50-79  | 中   | 需謹慎使用，放寬容忍 |
| 20-49  | 低   | 技術位參考價值有限   |
| 0-19   | 極低 | 視技術位為噪音       |

## 實際案例

### 白銀 2020 年 3 月（COVID-19）

- ATR% 峰值：12.45%
- Ratio 峰值：4.15x
- 持續：37 天
- 特徵：恐慌性拋售 + 流動性枯竭

### 白銀 2024 年 8 月（日圓套利平倉）

- ATR% 峰值：8.92%
- Ratio 峰值：2.97x
- 持續：37 天
- 特徵：跨資產去槓桿連鎖反應

## 局限性

1. **滯後性**：ATR 是滯後指標，擠壓開始時才會偵測到
2. **閾值敏感**：2.0x 和 6.0% 的門檻是經驗值，非普適
3. **基準污染**：若基準期本身包含異常期間，判定會失準
4. **資產差異**：不同資產的「正常」波動水平不同

## 參考資料

- Ole Hansen, Saxo Bank Commodity Strategy
- True Range: J. Welles Wilder, "New Concepts in Technical Trading Systems" (1978)
- 反身性理論: George Soros, "The Alchemy of Finance" (1987)
