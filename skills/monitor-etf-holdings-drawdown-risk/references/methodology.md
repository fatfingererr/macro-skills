### 什麼是「價格-庫存背離」？

在正常市場中，商品價格與對應 ETF 持倉應該**同向變動**：
- 價格上漲 → 投資人買入 ETF → ETF 購買實物 → 持倉增加
- 價格下跌 → 投資人賣出 ETF → ETF 賣出實物 → 持倉減少

當出現**逆向變動**時（價格上漲但持倉下降），稱為「背離」（Divergence）。

### 背離的兩種解釋

**解釋 A：實物供給緊張（Physical Tightness）**
- 實物需求強勁，交易所/金庫存量被提取
- ETF 無法及時補充持倉
- 可能預示供需失衡

**解釋 B：ETF 資金流/贖回（ETF Flow）**
- 投資人資金外流，贖回 ETF 份額
- ETF 被迫賣出實物
- 不代表整體市場實物短缺

**重要**：不能只看 ETF 持倉就下結論，需要交叉驗證。

## 偵測邏輯

### 背離事件定義

```
Divergence Event = True
  IF price_return >= min_price_return_pct (如 +15%)
  AND inventory_change <= -min_inventory_drawdown_pct (如 -10%)
  WITHIN divergence_window_days (如 180 天)
```

### 視窗期選擇

| 視窗長度 | 特性         | 適用場景           |
|----------|--------------|--------------------|
| 30 天    | 短期波動敏感 | 日常監控           |
| 90 天    | 季度視角     | 趨勢確認           |
| 180 天   | 半年視角     | 結構性判斷（推薦） |
| 365 天   | 年度視角     | 長期結構           |

### 門檻參數

| 參數                       | 預設值 | 說明                         |
|----------------------------|--------|------------------------------|
| min_price_return_pct       | 15%    | 價格需上漲多少才算「上漲期」 |
| min_inventory_drawdown_pct | 10%    | 庫存需下滑多少才算「被抽走」 |

門檻過低會產生太多假訊號，過高可能錯過真實背離。

## 嚴重度評估

### 十年低點判定

```python
inventory_decade_low = inventory <= rolling_min(inventory, 3650 days) × 1.001
```

當庫存處於十年最低區間時，背離訊號更具意義。

### 庫存/價格比值 Z 分數

```python
ratio = inventory / price
ratio_z = (ratio - rolling_mean(ratio, 3650)) / rolling_std(ratio, 3650)
```

| ratio_z | 解讀                       |
|---------|----------------------------|
| > 2     | 極高：庫存相對價格非常充裕 |
| 0 附近  | 正常                       |
| < -2    | 極低：庫存相對價格非常緊張 |

### 壓力分數計算

```python
stress_score = 100 × min(1.0,
    0.6 × divergence_severity +      # 背離嚴重度 = price_return × (-inventory_change)
    0.2 × decade_low_bonus +         # 1.0 if decade_low else 0.0
    0.2 × ratio_extreme_bonus        # 1.0 if ratio_z < -2 else 0.0
)
```

| 分數區間 | 等級 | 建議行動           |
|----------|------|--------------------|
| 0-30     | 正常 | 無需特別關注       |
| 30-60    | 輕度 | 保持監控           |
| 60-80    | 中度 | 建議交叉驗證       |
| 80-100   | 重度 | 高度警戒，深入分析 |

## 雙重假設驗證框架

### Physical Tightness 假設

**支持條件**：
- COMEX registered/eligible 庫存同步下降
- 期貨曲線從 contango 轉為 backwardation
- 白銀/黃金 lease rates 上升
- 零售銀條/銀幣溢價擴大
- LBMA 金庫存量下降

**如果多數條件成立**：較支持「實物緊張」解釋

### ETF Flow 假設

**支持條件**：
- COMEX 庫存穩定或上升
- 期貨曲線維持 contango
- 零售溢價平穩
- ETF 資金流數據顯示淨流出
- 其他 ETF（如 PSLV）持倉不降

**如果多數條件成立**：較支持「資金流動」解釋

### 驗證矩陣

| 指標        | Physical Tightness | ETF Flow    |
|-------------|--------------------|-------------|
| COMEX 庫存  | 下降 ↓             | 穩定/上升 ↑ |
| 期貨曲線    | Backwardation      | Contango    |
| Lease rates | 上升 ↑             | 穩定        |
| 零售溢價    | 擴大 ↑             | 穩定        |
| 其他 ETF    | 同步下降           | 不同步      |

## 歷史案例

### 2020-2021 白銀背離事件

**背景**：
- 2020 年 COVID 導致礦山停產，實物供給收縮
- 2021 年 WallStreetBets 發起「白銀擠壓」運動

**觀察**：
- SLV 持倉在 2021 初大幅增加後，於下半年持續下滑
- 同期銀價維持高位震盪
- COMEX 庫存同步下降
- 零售溢價一度飆升至 20%+

**結論**：同時存在 Physical Tightness 和 ETF Flow 因素

### 2022-2023 黃金背離事件

**背景**：
- 央行大量購金（尤其中國、俄羅斯）
- 但西方 ETF 持續流出

**觀察**：
- GLD 持倉持續下滑
- 金價在央行購買支撐下上漲
- COMEX 庫存相對穩定

**結論**：主要是 ETF Flow（西方資金流出），非實物短缺

## 限制與注意事項

### 數據品質

1. **ETF 持倉延遲**：通常有 1-2 天延遲
2. **庫存口徑差異**：不同來源的庫存定義可能不同
3. **選擇器失效**：網站改版可能導致爬蟲失敗

### 解讀偏誤

1. **敘事先行**：不要先有結論再找數據
2. **單一指標**：不要只看 ETF 持倉就下結論
3. **過度解讀**：正常波動不等於「危機」

### 模型限制

1. **線性假設**：壓力分數的加權可能過度簡化
2. **歷史依賴**：十年視窗假設歷史模式會重複
3. **缺乏因果**：只能識別相關性，無法證明因果

## 建議工作流程

1. **初步篩選**：執行快速檢查，看是否有背離
2. **嚴重度評估**：計算壓力分數，判斷是否需要關注
3. **交叉驗證**：使用多指標驗證背離真實性
4. **雙重假設**：同時考慮兩種解釋，不預設立場
5. **持續監控**：設定警報，追蹤趨勢變化
