displayName: 評估行情與指數趨勢偏離程度
emoji: "\U0001F4C8"
authorUrl: https://github.com/fatfingererr/macro-skills

tools:
  - claude-code

featured: false
installCount: 0

testQuestions:
  - question: '黃金目前的指數趨勢偏離度是多少？是否已超過 2011 年峰值？'
    imagePath: images/gold-deviation-analysis-2026-01-15.png
    expectedResult: |
      黃金指數趨勢偏離度分析結果

      當前狀態（截至 2025 年 12 月）
      ┌────────────┬───────────┐
      │    指標    │   數值    │
      ├────────────┼───────────┤
      │ 當前金價   │ $4,318.59 │
      ├────────────┼───────────┤
      │ 趨勢線價格 │ $2,161.81 │
      ├────────────┼───────────┤
      │ 當前偏離度 │ 99.8%     │
      ├────────────┼───────────┤
      │ 歷史分位數 │ 94.8%     │
      └────────────┴───────────┘
      歷史峰值比較
      ┌──────────────┬────────┬──────────────────────┐
      │   峰值時期   │ 偏離度 │      與當前差距      │
      ├──────────────┼────────┼──────────────────────┤
      │ 1980 年 1 月 │ 288.5% │ -188.7 ppt（未超過） │
      ├──────────────┼────────┼──────────────────────┤
      │ 2011 年 8 月 │ 83.1%  │ +16.7 ppt（已超過）  │
      └──────────────┴────────┴──────────────────────┘
      ---
      結論

      是的，黃金已超越 2011 年峰值偏離度。
      當前黃金偏離指數趨勢線 99.8%，超過 2011 年峰值（83.1%）約 16.7 個百分點。這意味著以趨勢偏離度衡量，黃金的「泡沫程度」已超過 2011 年那波行情。
      然而，與 1980 年那種 blow-off 式的峰值（288.5%）相比，當前偏離度仍有相當距離。若行情體質類似 1970 年代（高通膨、負實質利率），理論上仍有延伸空間。

  - question: '分析 S&P 500 的指數趨勢偏離度'
    imagePath: images/sp500-trend-deviation-2026-01-15.png
    expectedResult: |
      S&P 500 指數趨勢偏離度分析報告

      分析日期: 2026-01-15
      數據範圍: 1950-01-31 至 2026-01-31（76 年，913 個月）

      ---
      趨勢擬合參數
      ┌────────────┬────────────────────────────────────┐
      │    參數    │                數值                │
      ├────────────┼────────────────────────────────────┤
      │ 年化成長率 │ 7.34%                              │
      ├────────────┼────────────────────────────────────┤
      │ 趨勢公式   │ trend = exp(3.0619 + 0.005899 × t) │
      └────────────┴────────────────────────────────────┘
      ---
      當前狀態
      ┌────────────┬──────────┬────────────────────────────────────────┐
      │    指標    │   數值   │                  解讀                  │
      ├────────────┼──────────┼────────────────────────────────────────┤
      │ 當前價格   │ 6,926.60 │ -                                      │
      ├────────────┼──────────┼────────────────────────────────────────┤
      │ 趨勢價值   │ 4,637.36 │ 長期指數趨勢的「公允值」               │
      ├────────────┼──────────┼────────────────────────────────────────┤
      │ 偏離度     │ +49.4%   │ 價格高於趨勢近 50%                     │
      ├────────────┼──────────┼────────────────────────────────────────┤
      │ 歷史分位數 │ 94.9%    │ 在 76 年歷史中僅有 5% 時間比現在更偏離 │
      └────────────┴──────────┴────────────────────────────────────────┘
      ---
      歷史分布統計
      ┌───────────────┬───────────────────┐
      │    分位數     │      偏離度       │
      ├───────────────┼───────────────────┤
      │ 25%           │ -16.0%            │
      ├───────────────┼───────────────────┤
      │ 50%（中位數） │ -0.4%             │
      ├───────────────┼───────────────────┤
      │ 75%           │ +23.2%            │
      ├───────────────┼───────────────────┤
      │ 90%           │ +38.8%            │
      ├───────────────┼───────────────────┤
      │ 95%           │ +49.4% ← 當前位置 │
      ├───────────────┼───────────────────┤
      │ 99%           │ +88.5%            │
      └───────────────┴───────────────────┘
      ---
      歷史極端值對照
      ┌─────────────────────┬────────────┬─────────┬────────────────┐
      │        事件         │    日期    │ 偏離度  │   與當前比較   │
      ├─────────────────────┼────────────┼─────────┼────────────────┤
      │ 2000 年網路泡沫頂點 │ 2000-03-31 │ +101.2% │ 當前僅達其 49% │
      ├─────────────────────┼────────────┼─────────┼────────────────┤
      │ 1982 年沃克緊縮谷底 │ 1982-07-31 │ -49.8%  │ 歷史最悲觀時刻 │
      └─────────────────────┴────────────┴─────────┴────────────────┘
      ---
      關鍵洞察

      1. 極端但未達歷史峰值
      當前 +49.4% 的偏離度位於歷史第 95 分位，屬於「偏高但非極端」區間。2000 年網路泡沫時偏離度達 +101.2%，是當前的兩倍。
      2. 長期趨勢穩健
      S&P 500 在 76 年間維持約 7.3% 的年化複合成長率，這反映了美國經濟與企業盈利的長期成長。
      3. 當前定價隱含樂觀預期
      價格高於趨勢 49%，暗示市場正在計入：
        - AI 革命帶來的生產力躍升
        - 企業盈利持續超預期成長
        - 流動性環境相對寬鬆
      4. 風險提示
      歷史上當偏離度超過 +40% 後，未來 3-5 年的回報率通常低於長期平均。這不是「崩盤訊號」，而是「預期回報降低」的警示。

      ---
      結論

      S&P 500 當前處於 歷史高偏離區間（95 分位），但距離 2000 年的泡沫極端值仍有相當距離。這表明市場定價偏向樂觀，但尚未進入「非理性繁榮」的極端狀態。

      ---
      圖表說明：

      上圖 - 價格與趨勢線
      - 藍線：S&P 500 實際價格（對數尺度）
      - 紅色虛線：長期指數趨勢線（年化 7.3%）
      - 可見價格圍繞趨勢線上下波動，目前明顯高於趨勢

      下圖 - 偏離度
      - 紅色區域：高於趨勢的時期
      - 綠色區域：低於趨勢的時期
      - 紅色虛線：95 分位（約 +50%）
      - 綠色虛線：5 分位（約 -40%）

      關鍵觀察：
      1. 2000 年網路泡沫 創下 +101.2% 的歷史最高偏離度
      2. 1982 年 是歷史最悲觀時刻（-49.8%）
      3. 當前 +49.4% 正好位於 95 分位線上，偏離度較高但遠未達到泡沫極端

qualityScore:
  overall: 63
  badge: 中高級
  evaluatedAt: "2026-01-23"

  metrics:
    problemFit: 72
    correctness: 65
    dataGovernance: 60
    robustness: 58
    maintainability: 62
    usability: 61

  metricDetails:
    problemFit:
      score: 72
      strengths:
        - 清晰的指數趨勢擬合方法論
        - 歷史對照機制完整
        - 適用多種資產類別
      improvements:
        - 宏觀因子分析僅針對黃金設計
        - 可增加結構性變化處理

    correctness:
      score: 65
      strengths:
        - 方法論有理論依據
        - testQuestions 有 expectedResult
        - 歷史峰值對照清楚
      improvements:
        - 趨勢擬合區間選擇影響結果
        - 可增加敏感度分析

    dataGovernance:
      score: 60
      strengths:
        - 使用 Yahoo Finance 免費數據
        - 有 Stooq 替代來源
      improvements:
        - 缺少 data-sources.md 完整文檔
        - FRED 宏觀數據整合需說明

    robustness:
      score: 58
      strengths:
        - pitfalls 詳列擬合風險
        - bestPractices 有數據長度建議
      improvements:
        - 缺少 failure-modes.md
        - 結構性變化偵測需加強

    maintainability:
      score: 62
      strengths:
        - 參數定義完整
        - 多數據來源支援
      improvements:
        - 可增加 manifest.json 版本控制
        - 宏觀因子需定期更新

    usability:
      score: 61
      strengths:
        - FAQ 解答偏離度概念
        - 輸出有歷史對照圖表
      improvements:
        - 可增加 historical-episodes.md
        - 可增加更多資產範例

  details: |
    **任務適配度（72/100）**
    - 指數趨勢擬合方法論清晰
    - 待改進：宏觀因子擴展

    **正確性（65/100）**
    - 方法論有理論依據
    - 待改進：敏感度分析

    **資料治理（60/100）**
    - 使用免費數據
    - 待改進：增加 data-sources.md

    **穩健性（58/100）**
    - pitfalls 詳列風險
    - 待改進：增加 failure-modes.md

    **可維護性（62/100）**
    - 參數定義完整
    - 待改進：增加版本控制

    **輸出可用性（61/100）**
    - FAQ 解答核心概念
    - 待改進：增加資產範例

  upgradeNotes:
    targetBadge: 高級
    requirements:
      - metric: robustness
        currentScore: 58
        targetScore: 80
        suggestion: 增加 failure-modes.md 與結構變化處理
      - metric: dataGovernance
        currentScore: 60
        targetScore: 80
        suggestion: 增加 data-sources.md
      - metric: correctness
        currentScore: 65
        targetScore: 80
        suggestion: 增加敏感度分析與驗證

bestPractices:
  - title: 使用足夠長的歷史數據
    description: 建議至少 10-20 年歷史數據，以捕捉完整的週期。不同資產需要不同的起始日期
  - title: 月頻數據降低噪音
    description: 長期趨勢分析建議使用月頻數據，日頻噪音太大。腳本會自動轉換
  - title: 不預設歷史峰值
    description: 讓系統自動識別歷史極端值，或由使用者根據資產特性指定有意義的參考日期
  - title: 理解偏離度的含義
    description: 偏離度是風險評估工具，不是交易訊號。高偏離可能持續很久，也可能快速回歸

pitfalls:
  - title: 把偏離度當作交易訊號
    description: 偏離度是風險評估工具，不是做多做空訊號
    consequence: 過早逆勢操作可能遭遇趨勢延續的虧損
  - title: 使用固定的歷史參考點
    description: 不同資產有不同的週期特性，不應套用其他資產的歷史峰值
    consequence: 參考點失去意義，誤導決策
  - title: 趨勢線擬合區間選擇不當
    description: 若只用近期數據擬合，趨勢斜率會被近期行情扭曲
    consequence: 偏離度計算失真
  - title: 忽略結構性變化
    description: 資產的長期成長率可能因市場結構、制度變化而改變
    consequence: 簡單的全樣本擬合可能不適用於有結構性轉折的資產

faq:
  - question: 什麼是「指數趨勢偏離度」？
    answer: |
      指數趨勢偏離度衡量當前價格與長期指數成長趨勢線的距離，以百分比表示。

      計算方式：
      1. 對歷史價格取對數：y = log(price)
      2. 對時間做線性回歸：y = a + b*t
      3. 趨勢價格：trend = exp(a + b*t)
      4. 偏離度：(price / trend - 1) × 100%

      正偏離表示價格高於趨勢，負偏離表示低於趨勢。

  - question: 這個工具適用於哪些資產？
    answer: |
      適用於具有長期指數成長特性的資產：

      **商品**：黃金、白銀、原油、銅等
      **股票指數**：S&P 500、納斯達克、全球指數等
      **加密貨幣**：比特幣、以太坊等（需注意歷史較短）
      **ETF**：各類 ETF
      **房地產指數**：房價指數、REIT 等

      核心要求：有足夠長的歷史數據（建議 ≥ 10 年）

  - question: 如何選擇歷史參考日期？
    answer: |
      有兩種方式：

      **1. 自動識別**（推薦）：
      - 讓系統自動找出歷史最大偏離度
      - 不需要預先知道資產的歷史

      **2. 手動指定**：
      - 根據資產特性指定有意義的歷史峰值/谷值
      - 例如：黃金可參考 1980、2011；股市可參考 2000、2008、2020

      **黃金範例**：`--compare-peaks "2011-09-06,1980-01-21"`
      **股市範例**：`--compare-peaks "2000-03-24,2007-10-09,2020-02-19"`

  - question: 宏觀因子分析支援哪些資產？
    answer: |
      目前宏觀因子分析主要針對黃金設計（1970s-like vs 2000s-like 體質）。

      其他資產的宏觀分析需要自定義因子和判定規則。

      若不使用 `--include-macro` 參數，工具會純粹計算偏離度，
      適用於所有資產。

about:
  repository: https://github.com/fatfingererr/macro-skills
  branch: main
  additionalInfo: |
    ## 參考來源

    - 靈感來自 Twitter/X 上關於「% distance from exponential growth trendline」的討論
    - 適用於多種資產類別的指數趨勢偏離度分析

    ## 數據來源

    **Yahoo Finance（免費，無需 API key）**
    - 支援：股票、期貨、ETF、指數、加密貨幣等
    - 使用 yfinance 套件抓取

    **FRED（免費，無需 API key，選用）**
    - 宏觀因子：實質利率、通膨預期、美元指數等
    - 使用 pandas-datareader 套件抓取

    **Stooq（替代來源）**
    - 各類資產歷史數據
    - CSV 下載

    ## 適用場景

    - 長期投資配置決策
    - 評估資產是否處於歷史極端區間
    - 風險管理與倉位調整
    - 多資產比較分析

    ## 黃金專用功能

    針對黃金，可使用 `--include-macro` 參數進行：
    - 1970s-like vs 2000s-like 行情體質判定
    - 基於實質利率、通膨、地緣風險、美元的多因子分析

    參考範例：`examples/gold-deviation-2026.json`
