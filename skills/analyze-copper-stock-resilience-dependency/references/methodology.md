本技能的邏輯來自對研究報告中「銅要漲得動，股市得繼續漲」這類定性敘述的量化轉譯。

### 原始研究報告邏輯

```
研究報告圖表通常顯示：
- 銅價（LME Copper futures）
- 全球股市市值（Bloomberg World Exchange Market Cap USD）
- 中國 10Y 公債殖利率

隱含推理：
「銅價接近 13,000 關卡，若要突破需要股市維持強勢；
 否則可能出現 back-and-fill 回到 10,000 附近支撐。」
```

### 量化轉譯

本技能將上述定性敘述轉化為可計算的指標：

| 定性描述          | 量化指標                       |
|-------------------|--------------------------------|
| 「銅接近關卡」    | near_resistance / near_support |
| 「股市維持強勢」  | equity_resilience_score        |
| 「back-and-fill」 | backfill_probability           |
| 「依賴股市」      | rolling_beta_equity            |

---

## 核心模型

### 1. 趨勢狀態判定

使用移動平均線與斜率定義趨勢：

```
copper_trend = {
    "up":    close > SMA(60) AND SMA_slope > 0
    "down":  close < SMA(60) AND SMA_slope < 0
    "range": otherwise
}
```

**為何用 60 期（月）？**
- 對應研究報告圖中的長期均線
- 過濾短期雜訊，聚焦中長期趨勢

### 2. 關卡判定

心理整數位（round levels）是市場參與者普遍關注的價位：

```python
threshold = 0.05  # 5% 容忍範圍

near_resistance = price 接近但低於關卡
near_support = price 接近但高於關卡
```

預設關卡：
- **10,000 USD/ton**：重要支撐
- **13,000 USD/ton**：重要阻力

### 3. 股市韌性評分

將「股市強勢」這個模糊概念量化為 0-100 分：

| 因子     | 權重 | 計算方式                  | 邏輯         |
|----------|------|---------------------------|--------------|
| 12m 動能 | 40%  | 12 個月報酬率的歷史分位數 | 動能代表方向 |
| 均線位置 | 40%  | 是否站上 12 月均線        | 趨勢確認     |
| 近期回撤 | 20%  | 近 3 個月最大回撤（反向） | 穩定性       |

**評分解讀：**
- 70-100：高韌性，股市處於強勢
- 30-70：中性，需觀察其他因子
- 0-30：低韌性，股市偏弱

### 4. 滾動迴歸（依賴強度量化）

透過滾動 OLS 迴歸量化銅對股市與利率的敏感度：

```
Δcopper_t = α + β1 × Δequity_t + β2 × Δyield_t + ε_t
```

- **β1（股市貝塔）**：銅對全球股市的敏感度
  - β1 > 0 且顯著：銅與股市正相關（風險資產特徵）
  - β1 越大：銅越依賴股市
  - **β1 < 0（負相關）**：銅與股市呈反向關係，這是重要的結構性訊號
    - 可能原因：避險需求（銅作為實物資產）、供給衝擊、能源轉型獨立敘事
    - 當 β1 位於歷史極端低位（如 <10% 分位）時，表示銅正脫離傳統風險資產模式

- **β2（殖利率貝塔）**：銅對中國利率的敏感度
  - β2 > 0：殖利率上升利好銅（可能是通膨敘事）
  - β2 < 0：殖利率上升不利銅（可能是緊縮敘事）

**視窗選擇：**
- 預設 24 個月，平衡穩定性與反應性
- 可依需求調整（12-36 個月）

### 5. 回補機率估計

統計歷史上「觸及高關卡後回補到低關卡」的頻率：

**事件定義：**
```python
觸及事件 = 銅價 >= 13,000 × 0.98  # 接近或觸及 13,000
回補事件 = 未來 12 個月內最低價 <= 10,000 × 1.02  # 回到 10,000 附近
```

**分組統計：**
```
overall_backfill_rate = 所有事件的回補率
high_resilience_rate  = 韌性 >= 70 的事件回補率
low_resilience_rate   = 韌性 <= 30 的事件回補率
```

**核心洞察：**
高韌性情境下的回補率通常顯著低於低韌性情境。

---

## 情境判讀邏輯

### 條件式輸出（非單一因果）

本技能使用條件式判讀，而非硬性結論：

**問題 1：續航還是回補？**
```
IF copper_trend == "up" AND near_resistance AND resilience >= 70:
    → "續航機率較高"
ELIF copper_trend == "up" AND near_resistance AND resilience < 50:
    → "回補風險上升"
ELSE:
    → "需持續觀察"
```

**問題 2：依賴股市有多強？**
```
IF beta_equity 位於歷史 75+ 分位:
    → "高依賴：市場正把銅當風險資產交易"
ELIF beta_equity 位於歷史 50-75 分位:
    → "中度依賴"
ELSE:
    → "低依賴：銅有自身邏輯"
```

**問題 3：中國殖利率角色？**
```
IF yield_change < 0 AND resilience < 50:
    → "殖利率下行 + 股市不強 → 風險/成長壓力敘事（對銅不利）"
ELIF yield_change < 0 AND resilience >= 70:
    → "殖利率下行 + 股市強勢 → 寬鬆/流動性敘事（未必對銅不利）"
ELSE:
    → "中性，需觀察"
```

---

## 模型限制與注意事項

### 限制

1. **歷史不等於未來**：回補機率是歷史統計，不保證未來重演
2. **代理變數偏差**：ACWI 不等於彭博全球市值，可能有追蹤誤差
3. **數據頻率限制**：月頻數據無法捕捉日內波動
4. **模型簡化**：三因子模型可能遺漏其他重要驅動因素

### 注意事項

1. **單位換算**：HG=F 為 $/lb，必須轉換為 $/ton
2. **時區對齊**：確保三條序列使用相同的月底日期
3. **快取管理**：爬蟲數據建議快取 12 小時
4. **結合基本面**：本模型為技術面 + 跨資產分析，建議結合銅的基本面供需

---

## 參考文獻

- 原始研究報告圖表概念
- Merrill Lynch Investment Clock 模型
- 跨資產相關性分析方法
