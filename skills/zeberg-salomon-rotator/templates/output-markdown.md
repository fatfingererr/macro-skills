# Markdown 報告模板 (Output Markdown Template)

## 報告結構

```markdown
# Zeberg-Salomon 景氣輪動報告

**報告日期**: {as_of}
**回測期間**: {start_date} - {end_date}
**資料新鮮度**: 宏觀 {macro_freshness} / 價格 {price_freshness}

---

## 當前狀態

| 指標 | 數值 |
|------|------|
| **狀態** | {state} |
| **進入狀態日期** | {since} |
| **已持續** | {months_in_state} 個月 |

### 最新指標

| 指標 | 數值 | 變化 | 距門檻 |
|------|------|------|--------|
| LeadingIndex | {L} | {dL} | {dist_iceberg} |
| CoincidentIndex | {C} | {dC} | {dist_sinking} |

### 事件狀態

- 冰山事件 (Iceberg): {iceberg_emoji} {iceberg_status}
- 下沉事件 (Sinking): {sinking_emoji} {sinking_status}

---

## 回測績效

### 策略績效

| 指標 | 數值 |
|------|------|
| 累積報酬 | {cumulative_return} |
| CAGR | {cagr} |
| 年化波動 | {volatility} |
| Sharpe | {sharpe} |
| Max Drawdown | {max_dd} |
| Calmar | {calmar} |

### 與 Benchmark 比較

| 策略 | CAGR | MaxDD | Sharpe |
|------|------|-------|--------|
| **Zeberg-Salomon** | {strategy_cagr} | {strategy_dd} | {strategy_sharpe} |
| Equity Buy & Hold | {equity_cagr} | {equity_dd} | {equity_sharpe} |
| 60/40 Portfolio | {6040_cagr} | {6040_dd} | {6040_sharpe} |
| Bond Buy & Hold | {bond_cagr} | {bond_dd} | {bond_sharpe} |

### 相對表現

- vs 股票買入持有：超額 CAGR {excess_vs_equity}，減少回撤 {dd_reduction_equity}
- vs 60/40 組合：超額 CAGR {excess_vs_6040}，減少回撤 {dd_reduction_6040}

---

## 切換歷史

總切換次數: {total_switches} 次
平均持有期: {avg_holding_period} 個月

### 最近 5 次切換

| 日期 | 動作 | 原狀態 | 新狀態 | 原因 |
|------|------|--------|--------|------|
| {date1} | {action1} | {from1} | {to1} | {reason1} |
| {date2} | {action2} | {from2} | {to2} | {reason2} |
| ... | ... | ... | ... | ... |

---

## 指標歸因

### 領先指標成分

| 序列 | 最新值 | Z-Score | 貢獻 | 方向 |
|------|--------|---------|------|------|
| T10Y3M | {val} | {z} | {contrib} | {dir} |
| T10Y2Y | {val} | {z} | {contrib} | {dir} |
| PERMIT | {val} | {z} | {contrib} | {dir} |
| ACDGNO | {val} | {z} | {contrib} | {dir} |
| UMCSENT | {val} | {z} | {contrib} | {dir} |

### 同時指標成分

| 序列 | 最新值 | Z-Score | 貢獻 | 方向 |
|------|--------|---------|------|------|
| PAYEMS | {val} | {z} | {contrib} | {dir} |
| INDPRO | {val} | {z} | {contrib} | {dir} |
| W875RX1 | {val} | {z} | {contrib} | {dir} |
| CMRMTSPL | {val} | {z} | {contrib} | {dir} |

### 主要貢獻者

**正向**:
1. {top1_series}: +{top1_contrib}
2. {top2_series}: +{top2_contrib}

**負向**:
1. {bot1_series}: {bot1_contrib}
2. {bot2_series}: {bot2_contrib}

---

## 濾鏡狀態

### 亢奮濾鏡 (Euphoria)

| 類型 | 觸發 | 數值 |
|------|------|------|
| Credit Spread Reversal | {triggered} | {value} |
| VIX Turn Up | {triggered} | {value} |

### 復甦懷疑濾鏡 (Recovery Doubt)

| 類型 | 觸發 | 數值 |
|------|------|------|
| Leading Momentum | {triggered} | {value} |

---

## 回測假設

| 假設 | 設定值 |
|------|--------|
| 執行時點 | {rebalance_on} |
| 單邊交易成本 | {cost_bps} bps |
| 單邊滑價 | {slippage_bps} bps |
| 總交易成本 | {total_costs} bps |

---

## 注意事項

1. 本模型使用公開 FRED 數據近似 Zeberg 原版，具體數值可能有差異
2. TLT 數據從 2002-07 開始，之前使用合成債券報酬
3. 宏觀數據有 1-2 個月發布延遲，實際訊號會滯後
4. 報酬使用調整後收盤價計算（含配息再投資）

---

## 參考

- Zeberg Letter: https://swissblock.net/products/reports/zeberg-letter
- @SystematicPeter: https://x.com/SystematicPeter/status/2011460563096760388

---

*Generated by zeberg-salomon-rotator v{version} at {generated_at}*
```

## 使用方式

在腳本中使用模板：

```python
from string import Template

def generate_markdown_report(result):
    template_path = "templates/output-markdown.md"
    with open(template_path, "r", encoding="utf-8") as f:
        template = Template(f.read())

    # 準備替換變數
    vars = {
        "as_of": result["as_of"],
        "state": result["current_state"]["state"],
        # ... 其他變數
    }

    return template.safe_substitute(vars)
```

## 狀態圖示

| 狀態 | 圖示 |
|------|------|
| RISK_ON | `[ON]` 或 綠色標籤 |
| RISK_OFF | `[OFF]` 或 紅色標籤 |
| 冰山事件觸發 | `[!]` 警告 |
| 下沉事件觸發 | `[!!]` 嚴重警告 |
| 無事件 | `[-]` 正常 |
